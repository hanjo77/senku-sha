<html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"> <style>
	.KEYW {color: #933;}
	.COMM {color: #bbb; font-style: italic;}
	.NUMB {color: #393;}
	.STRN {color: #393;}
	.REGX {color: #339;}
	.line {border-right: 1px dotted #666; color: #666; font-style: normal;}
	</style></head><body><pre><span class='line'>  1</span> <span class="PUNC">!</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">,</span><span class="NAME">t</span><span class="PUNC">,</span><span class="NAME">n</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">(</span><span class="NAME">n</span><span class="PUNC">,</span><span class="NAME">s</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">t</span><span class="PUNC">[</span><span class="NAME">n</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">e</span><span class="PUNC">[</span><span class="NAME">n</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">o</span><span class="PUNC">=</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">require</span><span class="PUNC">==</span><span class="STRN">"function"</span><span class="PUNC">&&</span><span class="NAME">require</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">s</span><span class="PUNC">&&</span><span class="NAME">o</span><span class="PUNC">)</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">o</span><span class="PUNC">(</span><span class="NAME">n</span><span class="PUNC">,</span><span class="PUNC">!</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">r</span><span class="PUNC">)</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">r</span><span class="PUNC">(</span><span class="NAME">n</span><span class="PUNC">,</span><span class="PUNC">!</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">throw</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Error</span><span class="PUNC">(</span><span class="STRN">"Cannot find module '"</span><span class="PUNC">+</span><span class="NAME">n</span><span class="PUNC">+</span><span class="STRN">"'"</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">u</span><span class="PUNC">=</span><span class="NAME">t</span><span class="PUNC">[</span><span class="NAME">n</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="NAME">exports</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">e</span><span class="PUNC">[</span><span class="NAME">n</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">call</span><span class="PUNC">(</span><span class="NAME">u.exports</span><span class="PUNC">,</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">t</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">r</span><span class="PUNC">=</span><span class="NAME">e</span><span class="PUNC">[</span><span class="NAME">n</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">t</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">(</span><span class="NAME">r</span><span class="PUNC">?</span><span class="NAME">r</span><span class="PUNC">:</span><span class="NAME">t</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">u</span><span class="PUNC">,</span><span class="NAME">u.exports</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">t</span><span class="PUNC">[</span><span class="NAME">n</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">exports</span><span class="PUNC">}</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">r</span><span class="PUNC">=</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">require</span><span class="PUNC">==</span><span class="STRN">"function"</span><span class="PUNC">&&</span><span class="NAME">require</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">s</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">s</span><span class="PUNC">&lt;</span><span class="NAME">n.length</span><span class="PUNC">;</span><span class="NAME">s</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="NAME">i</span><span class="PUNC">(</span><span class="NAME">n</span><span class="PUNC">[</span><span class="NAME">s</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">}</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="NUMB">1</span><span class="PUNC">:</span><span class="PUNC">[</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">require</span><span class="PUNC">,</span><span class="NAME">module</span><span class="PUNC">,</span><span class="NAME">exports</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">chooseProtocol</span><span class="PUNC">=</span><span class="NAME">require</span><span class="PUNC">(</span><span class="STRN">"./protocol"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">chooseProtocol</span><span class="PUNC">,</span><span class="NAME">EventEmitter</span><span class="PUNC">=</span><span class="NAME">require</span><span class="PUNC">(</span><span class="STRN">"events"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">EventEmitter</span><span class="PUNC">,</span><span class="NAME">_</span><span class="PUNC">=</span><span class="NAME">require</span><span class="PUNC">(</span><span class="STRN">"underscore"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">BaseConnection</span><span class="PUNC">=</span><span class="NAME">module.exports</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">opts</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.opts</span><span class="PUNC">=</span><span class="NAME">_.defaults</span><span class="PUNC">(</span><span class="NAME">opts</span><span class="PUNC">||</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">host</span><span class="PUNC">:</span><span class="STRN">"127.0.0.1"</span><span class="PUNC">,</span><span class="NAME">enableGestures</span><span class="PUNC">:</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="NAME">port</span><span class="PUNC">:</span><span class="NUMB">6437</span><span class="PUNC">,</span><span class="NAME">enableHeartbeat</span><span class="PUNC">:</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="NAME">heartbeatInterval</span><span class="PUNC">:</span><span class="NUMB">100</span><span class="PUNC">,</span><span class="NAME">requestProtocolVersion</span><span class="PUNC">:</span><span class="NUMB">3</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.host</span><span class="PUNC">=</span><span class="NAME">opts.host</span><span class="PUNC">;</span><span class="NAME">this.port</span><span class="PUNC">=</span><span class="NAME">opts.port</span><span class="PUNC">;</span><span class="NAME">this.on</span><span class="PUNC">(</span><span class="STRN">"ready"</span><span class="PUNC">,</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.enableGestures</span><span class="PUNC">(</span><span class="NAME">this.opts.enableGestures</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.opts.enableHeartbeat</span><span class="PUNC">)</span><span class="NAME">this.startHeartbeat</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.on</span><span class="PUNC">(</span><span class="STRN">"disconnect"</span><span class="PUNC">,</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.opts.enableHeartbeat</span><span class="PUNC">)</span><span class="NAME">this.stopHeartbeat</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.heartbeatTimer</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">BaseConnection.prototype.getUrl</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="STRN">"ws://"</span><span class="PUNC">+</span><span class="NAME">this.host</span><span class="PUNC">+</span><span class="STRN">":"</span><span class="PUNC">+</span><span class="NAME">this.port</span><span class="PUNC">+</span><span class="STRN">"/v"</span><span class="PUNC">+</span><span class="NAME">this.opts.requestProtocolVersion</span><span class="PUNC">+</span><span class="STRN">".json"</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">BaseConnection.prototype.sendHeartbeat</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.protocol</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.setHeartbeatState</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.protocol.sendHeartbeat</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">BaseConnection.prototype.handleOpen</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.emit</span><span class="PUNC">(</span><span class="STRN">"connect"</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">BaseConnection.prototype.enableGestures</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">enabled</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.gesturesEnabled</span><span class="PUNC">=</span><span class="NAME">enabled</span><span class="PUNC">?</span><span class="KEYW">true</span><span class="PUNC">:</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="NAME">this.send</span><span class="PUNC">(</span><span class="NAME">this.protocol.encode</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="NAME">enableGestures</span><span class="PUNC">:</span><span class="NAME">this.gesturesEnabled</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">BaseConnection.prototype.handleClose</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.disconnect</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.startReconnection</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">BaseConnection.prototype.startReconnection</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">connection</span><span class="PUNC">=</span><span class="KEYW">this</span><span class="PUNC">;</span><span class="NAME">setTimeout</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">connection.connect</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="NAME">e3</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">BaseConnection.prototype.disconnect</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.socket</span><span class="PUNC">)</span><span class="KEYW">return</span><span class="PUNC">;</span><span class="NAME">this.socket.close</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">delete</span><span class="WHIT"> </span><span class="NAME">this.socket</span><span class="PUNC">;</span><span class="KEYW">delete</span><span class="WHIT"> </span><span class="NAME">this.protocol</span><span class="PUNC">;</span><span class="NAME">this.emit</span><span class="PUNC">(</span><span class="STRN">"disconnect"</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">BaseConnection.prototype.handleData</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">data</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">message</span><span class="PUNC">=</span><span class="NAME">JSON.parse</span><span class="PUNC">(</span><span class="NAME">data</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">messageEvent</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.protocol</span><span class="PUNC">===</span><span class="NAME">undefined</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">messageEvent</span><span class="PUNC">=</span><span class="NAME">this.protocol</span><span class="PUNC">=</span><span class="NAME">chooseProtocol</span><span class="PUNC">(</span><span class="NAME">message</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.emit</span><span class="PUNC">(</span><span class="STRN">"ready"</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">messageEvent</span><span class="PUNC">=</span><span class="NAME">this.protocol</span><span class="PUNC">(</span><span class="NAME">message</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="NAME">this.emit</span><span class="PUNC">(</span><span class="NAME">messageEvent.type</span><span class="PUNC">,</span><span class="NAME">messageEvent</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">BaseConnection.prototype.connect</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.socket</span><span class="PUNC">)</span><span class="KEYW">return</span><span class="PUNC">;</span><span class="NAME">this.socket</span><span class="PUNC">=</span><span class="NAME">this.setupSocket</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">BaseConnection.prototype.send</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">data</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.socket.send</span><span class="PUNC">(</span><span class="NAME">data</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">BaseConnection.prototype.stopHeartbeat</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.heartbeatTimer</span><span class="PUNC">)</span><span class="KEYW">return</span><span class="PUNC">;</span><span class="NAME">clearInterval</span><span class="PUNC">(</span><span class="NAME">this.heartbeatTimer</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">delete</span><span class="WHIT"> </span><span class="NAME">this.heartbeatTimer</span><span class="PUNC">;</span><span class="NAME">this.setHeartbeatState</span><span class="PUNC">(</span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">BaseConnection.prototype.setHeartbeatState</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">state</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.heartbeatState</span><span class="PUNC">===</span><span class="NAME">state</span><span class="PUNC">)</span><span class="KEYW">return</span><span class="PUNC">;</span><span class="NAME">this.heartbeatState</span><span class="PUNC">=</span><span class="NAME">state</span><span class="PUNC">;</span><span class="NAME">this.emit</span><span class="PUNC">(</span><span class="NAME">this.heartbeatState</span><span class="PUNC">?</span><span class="STRN">"focus"</span><span class="PUNC">:</span><span class="STRN">"blur"</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">_.extend</span><span class="PUNC">(</span><span class="NAME">BaseConnection.prototype</span><span class="PUNC">,</span><span class="NAME">EventEmitter.prototype</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="STRN">"./protocol"</span><span class="PUNC">:</span><span class="NUMB">12</span><span class="PUNC">,</span><span class="NAME">events</span><span class="PUNC">:</span><span class="NUMB">17</span><span class="PUNC">,</span><span class="NAME">underscore</span><span class="PUNC">:</span><span class="NUMB">20</span><span class="PUNC">}</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NUMB">2</span><span class="PUNC">:</span><span class="PUNC">[</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">require</span><span class="PUNC">,</span><span class="NAME">module</span><span class="PUNC">,</span><span class="NAME">exports</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">CircularBuffer</span><span class="PUNC">=</span><span class="NAME">module.exports</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">size</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.pos</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">this._buf</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">this.size</span><span class="PUNC">=</span><span class="NAME">size</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">CircularBuffer.prototype.get</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">==</span><span class="NAME">undefined</span><span class="PUNC">)</span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">>=</span><span class="NAME">this.size</span><span class="PUNC">)</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">undefined</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">>=</span><span class="NAME">this._buf.length</span><span class="PUNC">)</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">undefined</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this._buf</span><span class="PUNC">[</span><span class="PUNC">(</span><span class="NAME">this.pos</span><span class="PUNC">-</span><span class="NAME">i</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">%</span><span class="NAME">this.size</span><span class="PUNC">]</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">CircularBuffer.prototype.push</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">o</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this._buf</span><span class="PUNC">[</span><span class="NAME">this.pos</span><span class="PUNC">%</span><span class="NAME">this.size</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">o</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.pos</span><span class="PUNC">++</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NUMB">3</span><span class="PUNC">:</span><span class="PUNC">[</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">require</span><span class="PUNC">,</span><span class="NAME">module</span><span class="PUNC">,</span><span class="NAME">exports</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">Connection</span><span class="PUNC">=</span><span class="NAME">module.exports</span><span class="PUNC">=</span><span class="NAME">require</span><span class="PUNC">(</span><span class="STRN">"./base_connection"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">Connection.prototype.setupSocket</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">connection</span><span class="PUNC">=</span><span class="KEYW">this</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">socket</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">WebSocket</span><span class="PUNC">(</span><span class="NAME">this.getUrl</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">socket.onopen</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">connection.handleOpen</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">socket.onmessage</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">message</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">connection.handleData</span><span class="PUNC">(</span><span class="NAME">message.data</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">socket.onclose</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">connection.handleClose</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">socket</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">Connection.prototype.startHeartbeat</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.protocol.sendHeartbeat</span><span class="PUNC">||</span><span class="NAME">this.heartbeatTimer</span><span class="PUNC">)</span><span class="KEYW">return</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">connection</span><span class="PUNC">=</span><span class="KEYW">this</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">propertyName</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">document.hidden</span><span class="PUNC">!==</span><span class="STRN">"undefined"</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">propertyName</span><span class="PUNC">=</span><span class="STRN">"hidden"</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">document.mozHidden</span><span class="PUNC">!==</span><span class="STRN">"undefined"</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">propertyName</span><span class="PUNC">=</span><span class="STRN">"mozHidden"</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">document.msHidden</span><span class="PUNC">!==</span><span class="STRN">"undefined"</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">propertyName</span><span class="PUNC">=</span><span class="STRN">"msHidden"</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">document.webkitHidden</span><span class="PUNC">!==</span><span class="STRN">"undefined"</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">propertyName</span><span class="PUNC">=</span><span class="STRN">"webkitHidden"</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">propertyName</span><span class="PUNC">=</span><span class="NAME">undefined</span><span class="PUNC">}</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">windowVisible</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">focusListener</span><span class="PUNC">=</span><span class="NAME">window.addEventListener</span><span class="PUNC">(</span><span class="STRN">"focus"</span><span class="PUNC">,</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">windowVisible</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">blurListener</span><span class="PUNC">=</span><span class="NAME">window.addEventListener</span><span class="PUNC">(</span><span class="STRN">"blur"</span><span class="PUNC">,</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">windowVisible</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.on</span><span class="PUNC">(</span><span class="STRN">"disconnect"</span><span class="PUNC">,</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">connection.heartbeatTimer</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">clearTimeout</span><span class="PUNC">(</span><span class="NAME">connection.heartbeatTimer</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">delete</span><span class="WHIT"> </span><span class="NAME">connection.heartbeatTimer</span><span class="PUNC">}</span><span class="NAME">window.removeEventListener</span><span class="PUNC">(</span><span class="NAME">focusListener</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">window.removeEventListener</span><span class="PUNC">(</span><span class="NAME">blurListener</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.heartbeatTimer</span><span class="PUNC">=</span><span class="NAME">setInterval</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">isVisible</span><span class="PUNC">=</span><span class="NAME">propertyName</span><span class="PUNC">===</span><span class="NAME">undefined</span><span class="PUNC">?</span><span class="KEYW">true</span><span class="PUNC">:</span><span class="NAME">document</span><span class="PUNC">[</span><span class="NAME">propertyName</span><span class="PUNC">]</span><span class="PUNC">===</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">isVisible</span><span class="PUNC">&&</span><span class="NAME">windowVisible</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">connection.sendHeartbeat</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">connection.setHeartbeatState</span><span class="PUNC">(</span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">this.opts.heartbeatInterval</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="STRN">"./base_connection"</span><span class="PUNC">:</span><span class="NUMB">1</span><span class="PUNC">}</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NUMB">4</span><span class="PUNC">:</span><span class="PUNC">[</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">require</span><span class="PUNC">,</span><span class="NAME">module</span><span class="PUNC">,</span><span class="NAME">exports</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="PUNC">!</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">process</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">Frame</span><span class="PUNC">=</span><span class="NAME">require</span><span class="PUNC">(</span><span class="STRN">"./frame"</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">CircularBuffer</span><span class="PUNC">=</span><span class="NAME">require</span><span class="PUNC">(</span><span class="STRN">"./circular_buffer"</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">Pipeline</span><span class="PUNC">=</span><span class="NAME">require</span><span class="PUNC">(</span><span class="STRN">"./pipeline"</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">EventEmitter</span><span class="PUNC">=</span><span class="NAME">require</span><span class="PUNC">(</span><span class="STRN">"events"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">EventEmitter</span><span class="PUNC">,</span><span class="NAME">gestureListener</span><span class="PUNC">=</span><span class="NAME">require</span><span class="PUNC">(</span><span class="STRN">"./gesture"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">gestureListener</span><span class="PUNC">,</span><span class="NAME">_</span><span class="PUNC">=</span><span class="NAME">require</span><span class="PUNC">(</span><span class="STRN">"underscore"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">Controller</span><span class="PUNC">=</span><span class="NAME">module.exports</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">opts</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">inNode</span><span class="PUNC">=</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">process</span><span class="PUNC">!==</span><span class="STRN">"undefined"</span><span class="PUNC">&&</span><span class="NAME">process.title</span><span class="PUNC">===</span><span class="STRN">"node"</span><span class="PUNC">;</span><span class="NAME">opts</span><span class="PUNC">=</span><span class="NAME">_.defaults</span><span class="PUNC">(</span><span class="NAME">opts</span><span class="PUNC">||</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">inNode</span><span class="PUNC">:</span><span class="NAME">inNode</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.inNode</span><span class="PUNC">=</span><span class="NAME">opts.inNode</span><span class="PUNC">;</span><span class="NAME">opts</span><span class="PUNC">=</span><span class="NAME">_.defaults</span><span class="PUNC">(</span><span class="NAME">opts</span><span class="PUNC">||</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">frameEventName</span><span class="PUNC">:</span><span class="NAME">this.useAnimationLoop</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="STRN">"animationFrame"</span><span class="PUNC">:</span><span class="STRN">"deviceFrame"</span><span class="PUNC">,</span><span class="NAME">supressAnimationLoop</span><span class="PUNC">:</span><span class="KEYW">false</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.supressAnimationLoop</span><span class="PUNC">=</span><span class="NAME">opts.supressAnimationLoop</span><span class="PUNC">;</span><span class="NAME">this.frameEventName</span><span class="PUNC">=</span><span class="NAME">opts.frameEventName</span><span class="PUNC">;</span><span class="NAME">this.history</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">CircularBuffer</span><span class="PUNC">(</span><span class="NUMB">200</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.lastFrame</span><span class="PUNC">=</span><span class="NAME">Frame.Invalid</span><span class="PUNC">;</span><span class="NAME">this.lastValidFrame</span><span class="PUNC">=</span><span class="NAME">Frame.Invalid</span><span class="PUNC">;</span><span class="NAME">this.lastConnectionFrame</span><span class="PUNC">=</span><span class="NAME">Frame.Invalid</span><span class="PUNC">;</span><span class="NAME">this.accumulatedGestures</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">opts.connectionType</span><span class="PUNC">===</span><span class="NAME">undefined</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.connectionType</span><span class="PUNC">=</span><span class="NAME">this.inBrowser</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="NAME">require</span><span class="PUNC">(</span><span class="STRN">"./connection"</span><span class="PUNC">)</span><span class="PUNC">:</span><span class="NAME">require</span><span class="PUNC">(</span><span class="STRN">"./node_connection"</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">this.connectionType</span><span class="PUNC">=</span><span class="NAME">opts.connectionType</span><span class="PUNC">}</span><span class="NAME">this.connection</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">this.connectionType</span><span class="PUNC">(</span><span class="NAME">opts</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.setupConnectionEvents</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">Controller.prototype.gesture</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">type</span><span class="PUNC">,</span><span class="NAME">cb</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">creator</span><span class="PUNC">=</span><span class="NAME">gestureListener</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">type</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">cb</span><span class="PUNC">!==</span><span class="NAME">undefined</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">creator.stop</span><span class="PUNC">(</span><span class="NAME">cb</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">creator</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">Controller.prototype.inBrowser</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="PUNC">!</span><span class="NAME">this.inNode</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">Controller.prototype.useAnimationLoop</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.inBrowser</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">chrome</span><span class="PUNC">===</span><span class="STRN">"undefined"</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">Controller.prototype.connect</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">controller</span><span class="PUNC">=</span><span class="KEYW">this</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.connection.connect</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="NAME">this.inBrowser</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="PUNC">!</span><span class="NAME">controller.supressAnimationLoop</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">callback</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">controller.emit</span><span class="PUNC">(</span><span class="STRN">"animationFrame"</span><span class="PUNC">,</span><span class="NAME">controller.lastConnectionFrame</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">window.requestAnimFrame</span><span class="PUNC">(</span><span class="NAME">callback</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">window.requestAnimFrame</span><span class="PUNC">(</span><span class="NAME">callback</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">Controller.prototype.disconnect</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.connection.disconnect</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">Controller.prototype.frame</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">num</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.history.get</span><span class="PUNC">(</span><span class="NAME">num</span><span class="PUNC">)</span><span class="PUNC">||</span><span class="NAME">Frame.Invalid</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">Controller.prototype.loop</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">callback</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">switch</span><span class="PUNC">(</span><span class="NAME">callback.length</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">:</span><span class="NAME">this.on</span><span class="PUNC">(</span><span class="NAME">this.frameEventName</span><span class="PUNC">,</span><span class="NAME">callback</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">:</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">controller</span><span class="PUNC">=</span><span class="KEYW">this</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">scheduler</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">immediateRunnerCallback</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">frame</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">callback</span><span class="PUNC">(</span><span class="NAME">frame</span><span class="PUNC">,</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">controller.lastFrame</span><span class="PUNC">!=</span><span class="NAME">frame</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">immediateRunnerCallback</span><span class="PUNC">(</span><span class="NAME">controller.lastFrame</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">controller.once</span><span class="PUNC">(</span><span class="NAME">controller.frameEventName</span><span class="PUNC">,</span><span class="NAME">immediateRunnerCallback</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">this.once</span><span class="PUNC">(</span><span class="NAME">this.frameEventName</span><span class="PUNC">,</span><span class="NAME">immediateRunnerCallback</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">break</span><span class="PUNC">}</span><span class="NAME">this.connect</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">Controller.prototype.addStep</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">step</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.pipeline</span><span class="PUNC">)</span><span class="NAME">this.pipeline</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Pipeline</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.pipeline.addStep</span><span class="PUNC">(</span><span class="NAME">step</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">Controller.prototype.processFrame</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">frame</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">frame.gestures</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.accumulatedGestures</span><span class="PUNC">=</span><span class="NAME">this.accumulatedGestures.concat</span><span class="PUNC">(</span><span class="NAME">frame.gestures</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.pipeline</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">frame</span><span class="PUNC">=</span><span class="NAME">this.pipeline.run</span><span class="PUNC">(</span><span class="NAME">frame</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">frame</span><span class="PUNC">)</span><span class="NAME">frame</span><span class="PUNC">=</span><span class="NAME">Frame.Invalid</span><span class="PUNC">}</span><span class="NAME">this.lastConnectionFrame</span><span class="PUNC">=</span><span class="NAME">frame</span><span class="PUNC">;</span><span class="NAME">this.emit</span><span class="PUNC">(</span><span class="STRN">"deviceFrame"</span><span class="PUNC">,</span><span class="NAME">frame</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">Controller.prototype.processFinishedFrame</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">frame</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.lastFrame</span><span class="PUNC">=</span><span class="NAME">frame</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">frame.valid</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.lastValidFrame</span><span class="PUNC">=</span><span class="NAME">frame</span><span class="PUNC">}</span><span class="NAME">frame.controller</span><span class="PUNC">=</span><span class="KEYW">this</span><span class="PUNC">;</span><span class="NAME">frame.historyIdx</span><span class="PUNC">=</span><span class="NAME">this.history.push</span><span class="PUNC">(</span><span class="NAME">frame</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">frame.gestures</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">frame.gestures</span><span class="PUNC">=</span><span class="NAME">this.accumulatedGestures</span><span class="PUNC">;</span><span class="NAME">this.accumulatedGestures</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">gestureIdx</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">gestureIdx</span><span class="PUNC">!=</span><span class="NAME">frame.gestures.length</span><span class="PUNC">;</span><span class="NAME">gestureIdx</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.emit</span><span class="PUNC">(</span><span class="STRN">"gesture"</span><span class="PUNC">,</span><span class="NAME">frame.gestures</span><span class="PUNC">[</span><span class="NAME">gestureIdx</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">frame</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="NAME">this.emit</span><span class="PUNC">(</span><span class="STRN">"frame"</span><span class="PUNC">,</span><span class="NAME">frame</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">Controller.prototype.setupConnectionEvents</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">controller</span><span class="PUNC">=</span><span class="KEYW">this</span><span class="PUNC">;</span><span class="NAME">this.connection.on</span><span class="PUNC">(</span><span class="STRN">"frame"</span><span class="PUNC">,</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">frame</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">controller.processFrame</span><span class="PUNC">(</span><span class="NAME">frame</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.on</span><span class="PUNC">(</span><span class="NAME">this.frameEventName</span><span class="PUNC">,</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">frame</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">controller.processFinishedFrame</span><span class="PUNC">(</span><span class="NAME">frame</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.connection.on</span><span class="PUNC">(</span><span class="STRN">"disconnect"</span><span class="PUNC">,</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">controller.emit</span><span class="PUNC">(</span><span class="STRN">"disconnect"</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.connection.on</span><span class="PUNC">(</span><span class="STRN">"ready"</span><span class="PUNC">,</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">controller.emit</span><span class="PUNC">(</span><span class="STRN">"ready"</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.connection.on</span><span class="PUNC">(</span><span class="STRN">"connect"</span><span class="PUNC">,</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">controller.emit</span><span class="PUNC">(</span><span class="STRN">"connect"</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.connection.on</span><span class="PUNC">(</span><span class="STRN">"focus"</span><span class="PUNC">,</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">controller.emit</span><span class="PUNC">(</span><span class="STRN">"focus"</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.connection.on</span><span class="PUNC">(</span><span class="STRN">"blur"</span><span class="PUNC">,</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">controller.emit</span><span class="PUNC">(</span><span class="STRN">"blur"</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.connection.on</span><span class="PUNC">(</span><span class="STRN">"protocol"</span><span class="PUNC">,</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">protocol</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">controller.emit</span><span class="PUNC">(</span><span class="STRN">"protocol"</span><span class="PUNC">,</span><span class="NAME">protocol</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.connection.on</span><span class="PUNC">(</span><span class="STRN">"deviceConnect"</span><span class="PUNC">,</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">controller.emit</span><span class="PUNC">(</span><span class="NAME">evt.state</span><span class="PUNC">?</span><span class="STRN">"deviceConnected"</span><span class="PUNC">:</span><span class="STRN">"deviceDisconnected"</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">_.extend</span><span class="PUNC">(</span><span class="NAME">Controller.prototype</span><span class="PUNC">,</span><span class="NAME">EventEmitter.prototype</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">(</span><span class="NAME">require</span><span class="PUNC">(</span><span class="STRN">"__browserify_process"</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="STRN">"./circular_buffer"</span><span class="PUNC">:</span><span class="NUMB">2</span><span class="PUNC">,</span><span class="STRN">"./connection"</span><span class="PUNC">:</span><span class="NUMB">3</span><span class="PUNC">,</span><span class="STRN">"./frame"</span><span class="PUNC">:</span><span class="NUMB">5</span><span class="PUNC">,</span><span class="STRN">"./gesture"</span><span class="PUNC">:</span><span class="NUMB">6</span><span class="PUNC">,</span><span class="STRN">"./node_connection"</span><span class="PUNC">:</span><span class="NUMB">16</span><span class="PUNC">,</span><span class="STRN">"./pipeline"</span><span class="PUNC">:</span><span class="NUMB">10</span><span class="PUNC">,</span><span class="NAME">__browserify_process</span><span class="PUNC">:</span><span class="NUMB">18</span><span class="PUNC">,</span><span class="NAME">events</span><span class="PUNC">:</span><span class="NUMB">17</span><span class="PUNC">,</span><span class="NAME">underscore</span><span class="PUNC">:</span><span class="NUMB">20</span><span class="PUNC">}</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NUMB">5</span><span class="PUNC">:</span><span class="PUNC">[</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">require</span><span class="PUNC">,</span><span class="NAME">module</span><span class="PUNC">,</span><span class="NAME">exports</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">Hand</span><span class="PUNC">=</span><span class="NAME">require</span><span class="PUNC">(</span><span class="STRN">"./hand"</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">Pointable</span><span class="PUNC">=</span><span class="NAME">require</span><span class="PUNC">(</span><span class="STRN">"./pointable"</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">createGesture</span><span class="PUNC">=</span><span class="NAME">require</span><span class="PUNC">(</span><span class="STRN">"./gesture"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">createGesture</span><span class="PUNC">,</span><span class="NAME">glMatrix</span><span class="PUNC">=</span><span class="NAME">require</span><span class="PUNC">(</span><span class="STRN">"gl-matrix"</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">mat3</span><span class="PUNC">=</span><span class="NAME">glMatrix.mat3</span><span class="PUNC">,</span><span class="NAME">vec3</span><span class="PUNC">=</span><span class="NAME">glMatrix.vec3</span><span class="PUNC">,</span><span class="NAME">InteractionBox</span><span class="PUNC">=</span><span class="NAME">require</span><span class="PUNC">(</span><span class="STRN">"./interaction_box"</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">_</span><span class="PUNC">=</span><span class="NAME">require</span><span class="PUNC">(</span><span class="STRN">"underscore"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">Frame</span><span class="PUNC">=</span><span class="NAME">module.exports</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">data</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.valid</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="NAME">this.id</span><span class="PUNC">=</span><span class="NAME">data.id</span><span class="PUNC">;</span><span class="NAME">this.timestamp</span><span class="PUNC">=</span><span class="NAME">data.timestamp</span><span class="PUNC">;</span><span class="NAME">this.hands</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">this.handsMap</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">this.pointables</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">this.tools</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">this.fingers</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">data.interactionBox</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.interactionBox</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">InteractionBox</span><span class="PUNC">(</span><span class="NAME">data.interactionBox</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="NAME">this.gestures</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">this.pointablesMap</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">this._translation</span><span class="PUNC">=</span><span class="NAME">data.t</span><span class="PUNC">;</span><span class="NAME">this._rotation</span><span class="PUNC">=</span><span class="NAME">_.flatten</span><span class="PUNC">(</span><span class="NAME">data.r</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this._scaleFactor</span><span class="PUNC">=</span><span class="NAME">data.s</span><span class="PUNC">;</span><span class="NAME">this.data</span><span class="PUNC">=</span><span class="NAME">data</span><span class="PUNC">;</span><span class="NAME">this.type</span><span class="PUNC">=</span><span class="STRN">"frame"</span><span class="PUNC">;</span><span class="NAME">this.currentFrameRate</span><span class="PUNC">=</span><span class="NAME">data.currentFrameRate</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">handMap</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">handIdx</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">handCount</span><span class="PUNC">=</span><span class="NAME">data.hands.length</span><span class="PUNC">;</span><span class="NAME">handIdx</span><span class="PUNC">!=</span><span class="NAME">handCount</span><span class="PUNC">;</span><span class="NAME">handIdx</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">hand</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Hand</span><span class="PUNC">(</span><span class="NAME">data.hands</span><span class="PUNC">[</span><span class="NAME">handIdx</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">hand.frame</span><span class="PUNC">=</span><span class="KEYW">this</span><span class="PUNC">;</span><span class="NAME">this.hands.push</span><span class="PUNC">(</span><span class="NAME">hand</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.handsMap</span><span class="PUNC">[</span><span class="NAME">hand.id</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">hand</span><span class="PUNC">;</span><span class="NAME">handMap</span><span class="PUNC">[</span><span class="NAME">hand.id</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">handIdx</span><span class="PUNC">}</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">pointableIdx</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">pointableCount</span><span class="PUNC">=</span><span class="NAME">data.pointables.length</span><span class="PUNC">;</span><span class="NAME">pointableIdx</span><span class="PUNC">!=</span><span class="NAME">pointableCount</span><span class="PUNC">;</span><span class="NAME">pointableIdx</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">pointable</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Pointable</span><span class="PUNC">(</span><span class="NAME">data.pointables</span><span class="PUNC">[</span><span class="NAME">pointableIdx</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">pointable.frame</span><span class="PUNC">=</span><span class="KEYW">this</span><span class="PUNC">;</span><span class="NAME">this.pointables.push</span><span class="PUNC">(</span><span class="NAME">pointable</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.pointablesMap</span><span class="PUNC">[</span><span class="NAME">pointable.id</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">pointable</span><span class="PUNC">;</span><span class="PUNC">(</span><span class="NAME">pointable.tool</span><span class="PUNC">?</span><span class="NAME">this.tools</span><span class="PUNC">:</span><span class="NAME">this.fingers</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">push</span><span class="PUNC">(</span><span class="NAME">pointable</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">pointable.handId</span><span class="PUNC">!==</span><span class="NAME">undefined</span><span class="PUNC">&&</span><span class="NAME">handMap.hasOwnProperty</span><span class="PUNC">(</span><span class="NAME">pointable.handId</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">hand</span><span class="PUNC">=</span><span class="NAME">this.hands</span><span class="PUNC">[</span><span class="NAME">handMap</span><span class="PUNC">[</span><span class="NAME">pointable.handId</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">hand.pointables.push</span><span class="PUNC">(</span><span class="NAME">pointable</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">(</span><span class="NAME">pointable.tool</span><span class="PUNC">?</span><span class="NAME">hand.tools</span><span class="PUNC">:</span><span class="NAME">hand.fingers</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">push</span><span class="PUNC">(</span><span class="NAME">pointable</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">data.gestures</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">gestureIdx</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">gestureCount</span><span class="PUNC">=</span><span class="NAME">data.gestures.length</span><span class="PUNC">;</span><span class="NAME">gestureIdx</span><span class="PUNC">!=</span><span class="NAME">gestureCount</span><span class="PUNC">;</span><span class="NAME">gestureIdx</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.gestures.push</span><span class="PUNC">(</span><span class="NAME">createGesture</span><span class="PUNC">(</span><span class="NAME">data.gestures</span><span class="PUNC">[</span><span class="NAME">gestureIdx</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">Frame.prototype.tool</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">id</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">pointable</span><span class="PUNC">=</span><span class="NAME">this.pointable</span><span class="PUNC">(</span><span class="NAME">id</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">pointable.tool</span><span class="PUNC">?</span><span class="NAME">pointable</span><span class="PUNC">:</span><span class="NAME">Pointable.Invalid</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">Frame.prototype.pointable</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">id</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.pointablesMap</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">||</span><span class="NAME">Pointable.Invalid</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">Frame.prototype.finger</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">id</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">pointable</span><span class="PUNC">=</span><span class="NAME">this.pointable</span><span class="PUNC">(</span><span class="NAME">id</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="PUNC">!</span><span class="NAME">pointable.tool</span><span class="PUNC">?</span><span class="NAME">pointable</span><span class="PUNC">:</span><span class="NAME">Pointable.Invalid</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">Frame.prototype.hand</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">id</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.handsMap</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">||</span><span class="NAME">Hand.Invalid</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">Frame.prototype.rotationAngle</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">sinceFrame</span><span class="PUNC">,</span><span class="NAME">axis</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.valid</span><span class="PUNC">||</span><span class="PUNC">!</span><span class="NAME">sinceFrame.valid</span><span class="PUNC">)</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">rot</span><span class="PUNC">=</span><span class="NAME">this.rotationMatrix</span><span class="PUNC">(</span><span class="NAME">sinceFrame</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">cs</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">rot</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">+</span><span class="NAME">rot</span><span class="PUNC">[</span><span class="NUMB">4</span><span class="PUNC">]</span><span class="PUNC">+</span><span class="NAME">rot</span><span class="PUNC">[</span><span class="NUMB">8</span><span class="PUNC">]</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="PUNC">.</span><span class="NUMB">5</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">angle</span><span class="PUNC">=</span><span class="NAME">Math.acos</span><span class="PUNC">(</span><span class="NAME">cs</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">angle</span><span class="PUNC">=</span><span class="NAME">isNaN</span><span class="PUNC">(</span><span class="NAME">angle</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="NUMB">0</span><span class="PUNC">:</span><span class="NAME">angle</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">axis</span><span class="PUNC">!==</span><span class="NAME">undefined</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">rotAxis</span><span class="PUNC">=</span><span class="NAME">this.rotationAxis</span><span class="PUNC">(</span><span class="NAME">sinceFrame</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">angle</span><span class="PUNC">*</span><span class="PUNC">=</span><span class="NAME">vec3.dot</span><span class="PUNC">(</span><span class="NAME">rotAxis</span><span class="PUNC">,</span><span class="NAME">vec3.normalize</span><span class="PUNC">(</span><span class="NAME">vec3.create</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">axis</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">angle</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">Frame.prototype.rotationAxis</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">sinceFrame</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.valid</span><span class="PUNC">||</span><span class="PUNC">!</span><span class="NAME">sinceFrame.valid</span><span class="PUNC">)</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">vec3.create</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">vec3.normalize</span><span class="PUNC">(</span><span class="NAME">vec3.create</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="PUNC">[</span><span class="NAME">this._rotation</span><span class="PUNC">[</span><span class="NUMB">7</span><span class="PUNC">]</span><span class="PUNC">-</span><span class="NAME">sinceFrame._rotation</span><span class="PUNC">[</span><span class="NUMB">5</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">this._rotation</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">-</span><span class="NAME">sinceFrame._rotation</span><span class="PUNC">[</span><span class="NUMB">6</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">this._rotation</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">-</span><span class="NAME">sinceFrame._rotation</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">Frame.prototype.rotationMatrix</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">sinceFrame</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.valid</span><span class="PUNC">||</span><span class="PUNC">!</span><span class="NAME">sinceFrame.valid</span><span class="PUNC">)</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">mat3.create</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">transpose</span><span class="PUNC">=</span><span class="NAME">mat3.transpose</span><span class="PUNC">(</span><span class="NAME">mat3.create</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">this._rotation</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">mat3.multiply</span><span class="PUNC">(</span><span class="NAME">mat3.create</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">sinceFrame._rotation</span><span class="PUNC">,</span><span class="NAME">transpose</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">Frame.prototype.scaleFactor</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">sinceFrame</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.valid</span><span class="PUNC">||</span><span class="PUNC">!</span><span class="NAME">sinceFrame.valid</span><span class="PUNC">)</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">Math.exp</span><span class="PUNC">(</span><span class="NAME">this._scaleFactor</span><span class="PUNC">-</span><span class="NAME">sinceFrame._scaleFactor</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">Frame.prototype.translation</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">sinceFrame</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.valid</span><span class="PUNC">||</span><span class="PUNC">!</span><span class="NAME">sinceFrame.valid</span><span class="PUNC">)</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">vec3.create</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">vec3.subtract</span><span class="PUNC">(</span><span class="NAME">vec3.create</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">this._translation</span><span class="PUNC">,</span><span class="NAME">sinceFrame._translation</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">Frame.prototype.toString</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">str</span><span class="PUNC">=</span><span class="STRN">"Frame [ id:"</span><span class="PUNC">+</span><span class="NAME">this.id</span><span class="PUNC">+</span><span class="STRN">" | timestamp:"</span><span class="PUNC">+</span><span class="NAME">this.timestamp</span><span class="PUNC">+</span><span class="STRN">" | Hand count:("</span><span class="PUNC">+</span><span class="NAME">this.hands.length</span><span class="PUNC">+</span><span class="STRN">") | Pointable count:("</span><span class="PUNC">+</span><span class="NAME">this.pointables.length</span><span class="PUNC">+</span><span class="STRN">")"</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.gestures</span><span class="PUNC">)</span><span class="NAME">str</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="STRN">" | Gesture count:("</span><span class="PUNC">+</span><span class="NAME">this.gestures.length</span><span class="PUNC">+</span><span class="STRN">")"</span><span class="PUNC">;</span><span class="NAME">str</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="STRN">" ]"</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">str</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">Frame.prototype.dump</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">out</span><span class="PUNC">=</span><span class="STRN">""</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="STRN">"Frame Info:&lt;br/>"</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="NAME">this.toString</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="STRN">"&lt;br/>&lt;br/>Hands:&lt;br/>"</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">handIdx</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">handCount</span><span class="PUNC">=</span><span class="NAME">this.hands.length</span><span class="PUNC">;</span><span class="NAME">handIdx</span><span class="PUNC">!=</span><span class="NAME">handCount</span><span class="PUNC">;</span><span class="NAME">handIdx</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">out</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="STRN">"  "</span><span class="PUNC">+</span><span class="NAME">this.hands</span><span class="PUNC">[</span><span class="NAME">handIdx</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">toString</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="STRN">"&lt;br/>"</span><span class="PUNC">}</span><span class="NAME">out</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="STRN">"&lt;br/>&lt;br/>Pointables:&lt;br/>"</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">pointableIdx</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">pointableCount</span><span class="PUNC">=</span><span class="NAME">this.pointables.length</span><span class="PUNC">;</span><span class="NAME">pointableIdx</span><span class="PUNC">!=</span><span class="NAME">pointableCount</span><span class="PUNC">;</span><span class="NAME">pointableIdx</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">out</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="STRN">"  "</span><span class="PUNC">+</span><span class="NAME">this.pointables</span><span class="PUNC">[</span><span class="NAME">pointableIdx</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">toString</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="STRN">"&lt;br/>"</span><span class="PUNC">}</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.gestures</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">out</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="STRN">"&lt;br/>&lt;br/>Gestures:&lt;br/>"</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">gestureIdx</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">gestureCount</span><span class="PUNC">=</span><span class="NAME">this.gestures.length</span><span class="PUNC">;</span><span class="NAME">gestureIdx</span><span class="PUNC">!=</span><span class="NAME">gestureCount</span><span class="PUNC">;</span><span class="NAME">gestureIdx</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">out</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="STRN">"  "</span><span class="PUNC">+</span><span class="NAME">this.gestures</span><span class="PUNC">[</span><span class="NAME">gestureIdx</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">toString</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="STRN">"&lt;br/>"</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="NAME">out</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="STRN">"&lt;br/>&lt;br/>Raw JSON:&lt;br/>"</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="NAME">JSON.stringify</span><span class="PUNC">(</span><span class="NAME">this.data</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">out</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">Frame.Invalid</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="NAME">valid</span><span class="PUNC">:</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="NAME">hands</span><span class="PUNC">:</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">fingers</span><span class="PUNC">:</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">tools</span><span class="PUNC">:</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">gestures</span><span class="PUNC">:</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">pointables</span><span class="PUNC">:</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">pointable</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">Pointable.Invalid</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">finger</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">Pointable.Invalid</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">hand</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">Hand.Invalid</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">toString</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="STRN">"invalid frame"</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">dump</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.toString</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">rotationAngle</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">rotationMatrix</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">mat3.create</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">rotationAxis</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">vec3.create</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">scaleFactor</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">translation</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">vec3.create</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="STRN">"./gesture"</span><span class="PUNC">:</span><span class="NUMB">6</span><span class="PUNC">,</span><span class="STRN">"./hand"</span><span class="PUNC">:</span><span class="NUMB">7</span><span class="PUNC">,</span><span class="STRN">"./interaction_box"</span><span class="PUNC">:</span><span class="NUMB">9</span><span class="PUNC">,</span><span class="STRN">"./pointable"</span><span class="PUNC">:</span><span class="NUMB">11</span><span class="PUNC">,</span><span class="STRN">"gl-matrix"</span><span class="PUNC">:</span><span class="NUMB">19</span><span class="PUNC">,</span><span class="NAME">underscore</span><span class="PUNC">:</span><span class="NUMB">20</span><span class="PUNC">}</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NUMB">6</span><span class="PUNC">:</span><span class="PUNC">[</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">require</span><span class="PUNC">,</span><span class="NAME">module</span><span class="PUNC">,</span><span class="NAME">exports</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">glMatrix</span><span class="PUNC">=</span><span class="NAME">require</span><span class="PUNC">(</span><span class="STRN">"gl-matrix"</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">vec3</span><span class="PUNC">=</span><span class="NAME">glMatrix.vec3</span><span class="PUNC">,</span><span class="NAME">EventEmitter</span><span class="PUNC">=</span><span class="NAME">require</span><span class="PUNC">(</span><span class="STRN">"events"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">EventEmitter</span><span class="PUNC">,</span><span class="NAME">_</span><span class="PUNC">=</span><span class="NAME">require</span><span class="PUNC">(</span><span class="STRN">"underscore"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">createGesture</span><span class="PUNC">=</span><span class="NAME">exports.createGesture</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">data</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">gesture</span><span class="PUNC">;</span><span class="KEYW">switch</span><span class="PUNC">(</span><span class="NAME">data.type</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">case</span><span class="STRN">"circle"</span><span class="PUNC">:</span><span class="NAME">gesture</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">CircleGesture</span><span class="PUNC">(</span><span class="NAME">data</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="KEYW">case</span><span class="STRN">"swipe"</span><span class="PUNC">:</span><span class="NAME">gesture</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">SwipeGesture</span><span class="PUNC">(</span><span class="NAME">data</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="KEYW">case</span><span class="STRN">"screenTap"</span><span class="PUNC">:</span><span class="NAME">gesture</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">ScreenTapGesture</span><span class="PUNC">(</span><span class="NAME">data</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="KEYW">case</span><span class="STRN">"keyTap"</span><span class="PUNC">:</span><span class="NAME">gesture</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">KeyTapGesture</span><span class="PUNC">(</span><span class="NAME">data</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="KEYW">default</span><span class="PUNC">:</span><span class="KEYW">throw</span><span class="STRN">"unkown gesture type"</span><span class="PUNC">}</span><span class="NAME">gesture.id</span><span class="PUNC">=</span><span class="NAME">data.id</span><span class="PUNC">;</span><span class="NAME">gesture.handIds</span><span class="PUNC">=</span><span class="NAME">data.handIds</span><span class="PUNC">;</span><span class="NAME">gesture.pointableIds</span><span class="PUNC">=</span><span class="NAME">data.pointableIds</span><span class="PUNC">;</span><span class="NAME">gesture.duration</span><span class="PUNC">=</span><span class="NAME">data.duration</span><span class="PUNC">;</span><span class="NAME">gesture.state</span><span class="PUNC">=</span><span class="NAME">data.state</span><span class="PUNC">;</span><span class="NAME">gesture.type</span><span class="PUNC">=</span><span class="NAME">data.type</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">gesture</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">gestureListener</span><span class="PUNC">=</span><span class="NAME">exports.gestureListener</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">controller</span><span class="PUNC">,</span><span class="NAME">type</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">handlers</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">gestureMap</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">gestureCreator</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">candidateGesture</span><span class="PUNC">=</span><span class="NAME">gestureMap</span><span class="PUNC">[</span><span class="NAME">gesture.id</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">candidateGesture</span><span class="PUNC">!==</span><span class="NAME">undefined</span><span class="PUNC">)</span><span class="NAME">gesture.update</span><span class="PUNC">(</span><span class="NAME">gesture</span><span class="PUNC">,</span><span class="NAME">frame</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">gesture.state</span><span class="PUNC">==</span><span class="STRN">"start"</span><span class="PUNC">||</span><span class="NAME">gesture.state</span><span class="PUNC">==</span><span class="STRN">"stop"</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">type</span><span class="PUNC">==</span><span class="NAME">gesture.type</span><span class="PUNC">&&</span><span class="NAME">gestureMap</span><span class="PUNC">[</span><span class="NAME">gesture.id</span><span class="PUNC">]</span><span class="PUNC">===</span><span class="NAME">undefined</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">gestureMap</span><span class="PUNC">[</span><span class="NAME">gesture.id</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Gesture</span><span class="PUNC">(</span><span class="NAME">gesture</span><span class="PUNC">,</span><span class="NAME">frame</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">gesture.update</span><span class="PUNC">(</span><span class="NAME">gesture</span><span class="PUNC">,</span><span class="NAME">frame</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">gesture.state</span><span class="PUNC">==</span><span class="STRN">"stop"</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">delete</span><span class="WHIT"> </span><span class="NAME">gestureMap</span><span class="PUNC">[</span><span class="NAME">gesture.id</span><span class="PUNC">]</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">controller.on</span><span class="PUNC">(</span><span class="STRN">"gesture"</span><span class="PUNC">,</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">gesture</span><span class="PUNC">,</span><span class="NAME">frame</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">gesture.type</span><span class="PUNC">==</span><span class="NAME">type</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">gesture.state</span><span class="PUNC">==</span><span class="STRN">"start"</span><span class="PUNC">||</span><span class="NAME">gesture.state</span><span class="PUNC">==</span><span class="STRN">"stop"</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">gestureMap</span><span class="PUNC">[</span><span class="NAME">gesture.id</span><span class="PUNC">]</span><span class="PUNC">===</span><span class="NAME">undefined</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">gestureTracker</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Gesture</span><span class="PUNC">(</span><span class="NAME">gesture</span><span class="PUNC">,</span><span class="NAME">frame</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">gestureMap</span><span class="PUNC">[</span><span class="NAME">gesture.id</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">gestureTracker</span><span class="PUNC">;</span><span class="NAME">_.each</span><span class="PUNC">(</span><span class="NAME">handlers</span><span class="PUNC">,</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">cb</span><span class="PUNC">,</span><span class="NAME">name</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">gestureTracker.on</span><span class="PUNC">(</span><span class="NAME">name</span><span class="PUNC">,</span><span class="NAME">cb</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="NAME">gestureMap</span><span class="PUNC">[</span><span class="NAME">gesture.id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">update</span><span class="PUNC">(</span><span class="NAME">gesture</span><span class="PUNC">,</span><span class="NAME">frame</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">gesture.state</span><span class="PUNC">==</span><span class="STRN">"stop"</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">delete</span><span class="WHIT"> </span><span class="NAME">gestureMap</span><span class="PUNC">[</span><span class="NAME">gesture.id</span><span class="PUNC">]</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">builder</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="NAME">start</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">cb</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">handlers</span><span class="PUNC">[</span><span class="STRN">"start"</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">cb</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">builder</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">stop</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">cb</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">handlers</span><span class="PUNC">[</span><span class="STRN">"stop"</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">cb</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">builder</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">complete</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">cb</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">handlers</span><span class="PUNC">[</span><span class="STRN">"stop"</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">cb</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">builder</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">update</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">cb</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">handlers</span><span class="PUNC">[</span><span class="STRN">"update"</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">cb</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">builder</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">builder</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">Gesture</span><span class="PUNC">=</span><span class="NAME">exports.Gesture</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">gesture</span><span class="PUNC">,</span><span class="NAME">frame</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.gestures</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="NAME">gesture</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">this.frames</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="NAME">frame</span><span class="PUNC">]</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">Gesture.prototype.update</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">gesture</span><span class="PUNC">,</span><span class="NAME">frame</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.gestures.push</span><span class="PUNC">(</span><span class="NAME">gesture</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.frames.push</span><span class="PUNC">(</span><span class="NAME">frame</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.emit</span><span class="PUNC">(</span><span class="NAME">gesture.state</span><span class="PUNC">,</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">_.extend</span><span class="PUNC">(</span><span class="NAME">Gesture.prototype</span><span class="PUNC">,</span><span class="NAME">EventEmitter.prototype</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">CircleGesture</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">data</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.center</span><span class="PUNC">=</span><span class="NAME">data.center</span><span class="PUNC">;</span><span class="NAME">this.normal</span><span class="PUNC">=</span><span class="NAME">data.normal</span><span class="PUNC">;</span><span class="NAME">this.progress</span><span class="PUNC">=</span><span class="NAME">data.progress</span><span class="PUNC">;</span><span class="NAME">this.radius</span><span class="PUNC">=</span><span class="NAME">data.radius</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">CircleGesture.prototype.toString</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="STRN">"CircleGesture ["</span><span class="PUNC">+</span><span class="NAME">JSON.stringify</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="STRN">"]"</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">SwipeGesture</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">data</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.startPosition</span><span class="PUNC">=</span><span class="NAME">data.startPosition</span><span class="PUNC">;</span><span class="NAME">this.position</span><span class="PUNC">=</span><span class="NAME">data.position</span><span class="PUNC">;</span><span class="NAME">this.direction</span><span class="PUNC">=</span><span class="NAME">data.direction</span><span class="PUNC">;</span><span class="NAME">this.speed</span><span class="PUNC">=</span><span class="NAME">data.speed</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">SwipeGesture.prototype.toString</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="STRN">"SwipeGesture ["</span><span class="PUNC">+</span><span class="NAME">JSON.stringify</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="STRN">"]"</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ScreenTapGesture</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">data</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.position</span><span class="PUNC">=</span><span class="NAME">data.position</span><span class="PUNC">;</span><span class="NAME">this.direction</span><span class="PUNC">=</span><span class="NAME">data.direction</span><span class="PUNC">;</span><span class="NAME">this.progress</span><span class="PUNC">=</span><span class="NAME">data.progress</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">ScreenTapGesture.prototype.toString</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="STRN">"ScreenTapGesture ["</span><span class="PUNC">+</span><span class="NAME">JSON.stringify</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="STRN">"]"</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">KeyTapGesture</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">data</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.position</span><span class="PUNC">=</span><span class="NAME">data.position</span><span class="PUNC">;</span><span class="NAME">this.direction</span><span class="PUNC">=</span><span class="NAME">data.direction</span><span class="PUNC">;</span><span class="NAME">this.progress</span><span class="PUNC">=</span><span class="NAME">data.progress</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">KeyTapGesture.prototype.toString</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="STRN">"KeyTapGesture ["</span><span class="PUNC">+</span><span class="NAME">JSON.stringify</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="STRN">"]"</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">events</span><span class="PUNC">:</span><span class="NUMB">17</span><span class="PUNC">,</span><span class="STRN">"gl-matrix"</span><span class="PUNC">:</span><span class="NUMB">19</span><span class="PUNC">,</span><span class="NAME">underscore</span><span class="PUNC">:</span><span class="NUMB">20</span><span class="PUNC">}</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NUMB">7</span><span class="PUNC">:</span><span class="PUNC">[</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">require</span><span class="PUNC">,</span><span class="NAME">module</span><span class="PUNC">,</span><span class="NAME">exports</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">Pointable</span><span class="PUNC">=</span><span class="NAME">require</span><span class="PUNC">(</span><span class="STRN">"./pointable"</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">glMatrix</span><span class="PUNC">=</span><span class="NAME">require</span><span class="PUNC">(</span><span class="STRN">"gl-matrix"</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">mat3</span><span class="PUNC">=</span><span class="NAME">glMatrix.mat3</span><span class="PUNC">,</span><span class="NAME">vec3</span><span class="PUNC">=</span><span class="NAME">glMatrix.vec3</span><span class="PUNC">,</span><span class="NAME">_</span><span class="PUNC">=</span><span class="NAME">require</span><span class="PUNC">(</span><span class="STRN">"underscore"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">Hand</span><span class="PUNC">=</span><span class="NAME">module.exports</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">data</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.id</span><span class="PUNC">=</span><span class="NAME">data.id</span><span class="PUNC">;</span><span class="NAME">this.palmPosition</span><span class="PUNC">=</span><span class="NAME">data.palmPosition</span><span class="PUNC">;</span><span class="NAME">this.direction</span><span class="PUNC">=</span><span class="NAME">data.direction</span><span class="PUNC">;</span><span class="NAME">this.palmVelocity</span><span class="PUNC">=</span><span class="NAME">data.palmVelocity</span><span class="PUNC">;</span><span class="NAME">this.palmNormal</span><span class="PUNC">=</span><span class="NAME">data.palmNormal</span><span class="PUNC">;</span><span class="NAME">this.sphereCenter</span><span class="PUNC">=</span><span class="NAME">data.sphereCenter</span><span class="PUNC">;</span><span class="NAME">this.sphereRadius</span><span class="PUNC">=</span><span class="NAME">data.sphereRadius</span><span class="PUNC">;</span><span class="NAME">this.valid</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="NAME">this.pointables</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">this.fingers</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">this.tools</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">this._translation</span><span class="PUNC">=</span><span class="NAME">data.t</span><span class="PUNC">;</span><span class="NAME">this._rotation</span><span class="PUNC">=</span><span class="NAME">_.flatten</span><span class="PUNC">(</span><span class="NAME">data.r</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this._scaleFactor</span><span class="PUNC">=</span><span class="NAME">data.s</span><span class="PUNC">;</span><span class="NAME">this.timeVisible</span><span class="PUNC">=</span><span class="NAME">data.timeVisible</span><span class="PUNC">;</span><span class="NAME">this.stabilizedPalmPosition</span><span class="PUNC">=</span><span class="NAME">data.stabilizedPalmPosition</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">Hand.prototype.finger</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">id</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">finger</span><span class="PUNC">=</span><span class="NAME">this.frame.finger</span><span class="PUNC">(</span><span class="NAME">id</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">finger</span><span class="PUNC">&&</span><span class="NAME">finger.handId</span><span class="PUNC">==</span><span class="NAME">this.id</span><span class="PUNC">?</span><span class="NAME">finger</span><span class="PUNC">:</span><span class="NAME">Pointable.Invalid</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">Hand.prototype.rotationAngle</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">sinceFrame</span><span class="PUNC">,</span><span class="NAME">axis</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.valid</span><span class="PUNC">||</span><span class="PUNC">!</span><span class="NAME">sinceFrame.valid</span><span class="PUNC">)</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">sinceHand</span><span class="PUNC">=</span><span class="NAME">sinceFrame.hand</span><span class="PUNC">(</span><span class="NAME">this.id</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">sinceHand.valid</span><span class="PUNC">)</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">rot</span><span class="PUNC">=</span><span class="NAME">this.rotationMatrix</span><span class="PUNC">(</span><span class="NAME">sinceFrame</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">cs</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">rot</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">+</span><span class="NAME">rot</span><span class="PUNC">[</span><span class="NUMB">4</span><span class="PUNC">]</span><span class="PUNC">+</span><span class="NAME">rot</span><span class="PUNC">[</span><span class="NUMB">8</span><span class="PUNC">]</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="PUNC">.</span><span class="NUMB">5</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">angle</span><span class="PUNC">=</span><span class="NAME">Math.acos</span><span class="PUNC">(</span><span class="NAME">cs</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">angle</span><span class="PUNC">=</span><span class="NAME">isNaN</span><span class="PUNC">(</span><span class="NAME">angle</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="NUMB">0</span><span class="PUNC">:</span><span class="NAME">angle</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">axis</span><span class="PUNC">!==</span><span class="NAME">undefined</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">rotAxis</span><span class="PUNC">=</span><span class="NAME">this.rotationAxis</span><span class="PUNC">(</span><span class="NAME">sinceFrame</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">angle</span><span class="PUNC">*</span><span class="PUNC">=</span><span class="NAME">vec3.dot</span><span class="PUNC">(</span><span class="NAME">rotAxis</span><span class="PUNC">,</span><span class="NAME">vec3.normalize</span><span class="PUNC">(</span><span class="NAME">vec3.create</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">axis</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">angle</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">Hand.prototype.rotationAxis</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">sinceFrame</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.valid</span><span class="PUNC">||</span><span class="PUNC">!</span><span class="NAME">sinceFrame.valid</span><span class="PUNC">)</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">vec3.create</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">sinceHand</span><span class="PUNC">=</span><span class="NAME">sinceFrame.hand</span><span class="PUNC">(</span><span class="NAME">this.id</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">sinceHand.valid</span><span class="PUNC">)</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">vec3.create</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">vec3.normalize</span><span class="PUNC">(</span><span class="NAME">vec3.create</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="PUNC">[</span><span class="NAME">this._rotation</span><span class="PUNC">[</span><span class="NUMB">7</span><span class="PUNC">]</span><span class="PUNC">-</span><span class="NAME">sinceHand._rotation</span><span class="PUNC">[</span><span class="NUMB">5</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">this._rotation</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">-</span><span class="NAME">sinceHand._rotation</span><span class="PUNC">[</span><span class="NUMB">6</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">this._rotation</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">-</span><span class="NAME">sinceHand._rotation</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">Hand.prototype.rotationMatrix</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">sinceFrame</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.valid</span><span class="PUNC">||</span><span class="PUNC">!</span><span class="NAME">sinceFrame.valid</span><span class="PUNC">)</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">mat3.create</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">sinceHand</span><span class="PUNC">=</span><span class="NAME">sinceFrame.hand</span><span class="PUNC">(</span><span class="NAME">this.id</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">sinceHand.valid</span><span class="PUNC">)</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">mat3.create</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">transpose</span><span class="PUNC">=</span><span class="NAME">mat3.transpose</span><span class="PUNC">(</span><span class="NAME">mat3.create</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">this._rotation</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">m</span><span class="PUNC">=</span><span class="NAME">mat3.multiply</span><span class="PUNC">(</span><span class="NAME">mat3.create</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">sinceHand._rotation</span><span class="PUNC">,</span><span class="NAME">transpose</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">m</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">Hand.prototype.scaleFactor</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">sinceFrame</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.valid</span><span class="PUNC">||</span><span class="PUNC">!</span><span class="NAME">sinceFrame.valid</span><span class="PUNC">)</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">sinceHand</span><span class="PUNC">=</span><span class="NAME">sinceFrame.hand</span><span class="PUNC">(</span><span class="NAME">this.id</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">sinceHand.valid</span><span class="PUNC">)</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">Math.exp</span><span class="PUNC">(</span><span class="NAME">this._scaleFactor</span><span class="PUNC">-</span><span class="NAME">sinceHand._scaleFactor</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">Hand.prototype.translation</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">sinceFrame</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.valid</span><span class="PUNC">||</span><span class="PUNC">!</span><span class="NAME">sinceFrame.valid</span><span class="PUNC">)</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">vec3.create</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">sinceHand</span><span class="PUNC">=</span><span class="NAME">sinceFrame.hand</span><span class="PUNC">(</span><span class="NAME">this.id</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">sinceHand.valid</span><span class="PUNC">)</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">vec3.create</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="PUNC">[</span><span class="NAME">this._translation</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">-</span><span class="NAME">sinceHand._translation</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">this._translation</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">-</span><span class="NAME">sinceHand._translation</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">this._translation</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">-</span><span class="NAME">sinceHand._translation</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">Hand.prototype.toString</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="STRN">"Hand [ id: "</span><span class="PUNC">+</span><span class="NAME">this.id</span><span class="PUNC">+</span><span class="STRN">" | palm velocity:"</span><span class="PUNC">+</span><span class="NAME">this.palmVelocity</span><span class="PUNC">+</span><span class="STRN">" | sphere center:"</span><span class="PUNC">+</span><span class="NAME">this.sphereCenter</span><span class="PUNC">+</span><span class="STRN">" ] "</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">Hand.Invalid</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="NAME">valid</span><span class="PUNC">:</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="NAME">fingers</span><span class="PUNC">:</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">tools</span><span class="PUNC">:</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">pointables</span><span class="PUNC">:</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">pointable</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">Pointable.Invalid</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">finger</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">Pointable.Invalid</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">toString</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="STRN">"invalid frame"</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">dump</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.toString</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">rotationAngle</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">rotationMatrix</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">mat3.create</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">rotationAxis</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">vec3.create</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">scaleFactor</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">translation</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">vec3.create</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="STRN">"./pointable"</span><span class="PUNC">:</span><span class="NUMB">11</span><span class="PUNC">,</span><span class="STRN">"gl-matrix"</span><span class="PUNC">:</span><span class="NUMB">19</span><span class="PUNC">,</span><span class="NAME">underscore</span><span class="PUNC">:</span><span class="NUMB">20</span><span class="PUNC">}</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NUMB">8</span><span class="PUNC">:</span><span class="PUNC">[</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">require</span><span class="PUNC">,</span><span class="NAME">module</span><span class="PUNC">,</span><span class="NAME">exports</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="PUNC">!</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">module.exports</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="NAME">Controller</span><span class="PUNC">:</span><span class="NAME">require</span><span class="PUNC">(</span><span class="STRN">"./controller"</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">Frame</span><span class="PUNC">:</span><span class="NAME">require</span><span class="PUNC">(</span><span class="STRN">"./frame"</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">Gesture</span><span class="PUNC">:</span><span class="NAME">require</span><span class="PUNC">(</span><span class="STRN">"./gesture"</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">Hand</span><span class="PUNC">:</span><span class="NAME">require</span><span class="PUNC">(</span><span class="STRN">"./hand"</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">Pointable</span><span class="PUNC">:</span><span class="NAME">require</span><span class="PUNC">(</span><span class="STRN">"./pointable"</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">InteractionBox</span><span class="PUNC">:</span><span class="NAME">require</span><span class="PUNC">(</span><span class="STRN">"./interaction_box"</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">Connection</span><span class="PUNC">:</span><span class="NAME">require</span><span class="PUNC">(</span><span class="STRN">"./connection"</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">CircularBuffer</span><span class="PUNC">:</span><span class="NAME">require</span><span class="PUNC">(</span><span class="STRN">"./circular_buffer"</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">UI</span><span class="PUNC">:</span><span class="NAME">require</span><span class="PUNC">(</span><span class="STRN">"./ui"</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">glMatrix</span><span class="PUNC">:</span><span class="NAME">require</span><span class="PUNC">(</span><span class="STRN">"gl-matrix"</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">mat3</span><span class="PUNC">:</span><span class="NAME">require</span><span class="PUNC">(</span><span class="STRN">"gl-matrix"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">mat3</span><span class="PUNC">,</span><span class="NAME">vec3</span><span class="PUNC">:</span><span class="NAME">require</span><span class="PUNC">(</span><span class="STRN">"gl-matrix"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">vec3</span><span class="PUNC">,</span><span class="NAME">loopController</span><span class="PUNC">:</span><span class="NAME">undefined</span><span class="PUNC">,</span><span class="NAME">loop</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">opts</span><span class="PUNC">,</span><span class="NAME">callback</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">callback</span><span class="PUNC">===</span><span class="NAME">undefined</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">callback</span><span class="PUNC">=</span><span class="NAME">opts</span><span class="PUNC">;</span><span class="NAME">opts</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.loopController</span><span class="PUNC">)</span><span class="NAME">this.loopController</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">this.Controller</span><span class="PUNC">(</span><span class="NAME">opts</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.loopController.loop</span><span class="PUNC">(</span><span class="NAME">callback</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="STRN">"./circular_buffer"</span><span class="PUNC">:</span><span class="NUMB">2</span><span class="PUNC">,</span><span class="STRN">"./connection"</span><span class="PUNC">:</span><span class="NUMB">3</span><span class="PUNC">,</span><span class="STRN">"./controller"</span><span class="PUNC">:</span><span class="NUMB">4</span><span class="PUNC">,</span><span class="STRN">"./frame"</span><span class="PUNC">:</span><span class="NUMB">5</span><span class="PUNC">,</span><span class="STRN">"./gesture"</span><span class="PUNC">:</span><span class="NUMB">6</span><span class="PUNC">,</span><span class="STRN">"./hand"</span><span class="PUNC">:</span><span class="NUMB">7</span><span class="PUNC">,</span><span class="STRN">"./interaction_box"</span><span class="PUNC">:</span><span class="NUMB">9</span><span class="PUNC">,</span><span class="STRN">"./pointable"</span><span class="PUNC">:</span><span class="NUMB">11</span><span class="PUNC">,</span><span class="STRN">"./ui"</span><span class="PUNC">:</span><span class="NUMB">13</span><span class="PUNC">,</span><span class="STRN">"gl-matrix"</span><span class="PUNC">:</span><span class="NUMB">19</span><span class="PUNC">}</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NUMB">9</span><span class="PUNC">:</span><span class="PUNC">[</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">require</span><span class="PUNC">,</span><span class="NAME">module</span><span class="PUNC">,</span><span class="NAME">exports</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">glMatrix</span><span class="PUNC">=</span><span class="NAME">require</span><span class="PUNC">(</span><span class="STRN">"gl-matrix"</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">vec3</span><span class="PUNC">=</span><span class="NAME">glMatrix.vec3</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">InteractionBox</span><span class="PUNC">=</span><span class="NAME">module.exports</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">data</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.valid</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="NAME">this.center</span><span class="PUNC">=</span><span class="NAME">data.center</span><span class="PUNC">;</span><span class="NAME">this.size</span><span class="PUNC">=</span><span class="NAME">data.size</span><span class="PUNC">;</span><span class="NAME">this.width</span><span class="PUNC">=</span><span class="NAME">data.size</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">this.height</span><span class="PUNC">=</span><span class="NAME">data.size</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">this.depth</span><span class="PUNC">=</span><span class="NAME">data.size</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">InteractionBox.prototype.denormalizePoint</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">normalizedPosition</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">vec3.fromValues</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">normalizedPosition</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">-</span><span class="PUNC">.</span><span class="NUMB">5</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="NAME">this.size</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">+</span><span class="NAME">this.center</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="PUNC">(</span><span class="NAME">normalizedPosition</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">-</span><span class="PUNC">.</span><span class="NUMB">5</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="NAME">this.size</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">+</span><span class="NAME">this.center</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="PUNC">(</span><span class="NAME">normalizedPosition</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">-</span><span class="PUNC">.</span><span class="NUMB">5</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="NAME">this.size</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">+</span><span class="NAME">this.center</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">InteractionBox.prototype.normalizePoint</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">position</span><span class="PUNC">,</span><span class="NAME">clamp</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">vec</span><span class="PUNC">=</span><span class="NAME">vec3.fromValues</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">position</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">-</span><span class="NAME">this.center</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">/</span><span class="NAME">this.size</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">+</span><span class="PUNC">.</span><span class="NUMB">5</span><span class="PUNC">,</span><span class="PUNC">(</span><span class="NAME">position</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">-</span><span class="NAME">this.center</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">/</span><span class="NAME">this.size</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">+</span><span class="PUNC">.</span><span class="NUMB">5</span><span class="PUNC">,</span><span class="PUNC">(</span><span class="NAME">position</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">-</span><span class="NAME">this.center</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">/</span><span class="NAME">this.size</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">+</span><span class="PUNC">.</span><span class="NUMB">5</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">clamp</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">vec</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">Math.min</span><span class="PUNC">(</span><span class="NAME">Math.max</span><span class="PUNC">(</span><span class="NAME">vec</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">vec</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">Math.min</span><span class="PUNC">(</span><span class="NAME">Math.max</span><span class="PUNC">(</span><span class="NAME">vec</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">vec</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">Math.min</span><span class="PUNC">(</span><span class="NAME">Math.max</span><span class="PUNC">(</span><span class="NAME">vec</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">vec</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">InteractionBox.prototype.toString</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="STRN">"InteractionBox [ width:"</span><span class="PUNC">+</span><span class="NAME">this.width</span><span class="PUNC">+</span><span class="STRN">" | height:"</span><span class="PUNC">+</span><span class="NAME">this.height</span><span class="PUNC">+</span><span class="STRN">" | depth:"</span><span class="PUNC">+</span><span class="NAME">this.depth</span><span class="PUNC">+</span><span class="STRN">" ]"</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">InteractionBox.Invalid</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="NAME">valid</span><span class="PUNC">:</span><span class="KEYW">false</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="STRN">"gl-matrix"</span><span class="PUNC">:</span><span class="NUMB">19</span><span class="PUNC">}</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NUMB">10</span><span class="PUNC">:</span><span class="PUNC">[</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">require</span><span class="PUNC">,</span><span class="NAME">module</span><span class="PUNC">,</span><span class="NAME">exports</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">Pipeline</span><span class="PUNC">=</span><span class="NAME">module.exports</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.steps</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">Pipeline.prototype.addStep</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">step</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.steps.push</span><span class="PUNC">(</span><span class="NAME">step</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">Pipeline.prototype.run</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">frame</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">stepsLength</span><span class="PUNC">=</span><span class="NAME">this.steps.length</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">!=</span><span class="NAME">stepsLength</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">frame</span><span class="PUNC">)</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="NAME">frame</span><span class="PUNC">=</span><span class="NAME">this.steps</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">(</span><span class="NAME">frame</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">frame</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NUMB">11</span><span class="PUNC">:</span><span class="PUNC">[</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">require</span><span class="PUNC">,</span><span class="NAME">module</span><span class="PUNC">,</span><span class="NAME">exports</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">glMatrix</span><span class="PUNC">=</span><span class="NAME">require</span><span class="PUNC">(</span><span class="STRN">"gl-matrix"</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">vec3</span><span class="PUNC">=</span><span class="NAME">glMatrix.vec3</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">Pointable</span><span class="PUNC">=</span><span class="NAME">module.exports</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">data</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.valid</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="NAME">this.id</span><span class="PUNC">=</span><span class="NAME">data.id</span><span class="PUNC">;</span><span class="NAME">this.handId</span><span class="PUNC">=</span><span class="NAME">data.handId</span><span class="PUNC">;</span><span class="NAME">this.length</span><span class="PUNC">=</span><span class="NAME">data.length</span><span class="PUNC">;</span><span class="NAME">this.tool</span><span class="PUNC">=</span><span class="NAME">data.tool</span><span class="PUNC">;</span><span class="NAME">this.width</span><span class="PUNC">=</span><span class="NAME">data.width</span><span class="PUNC">;</span><span class="NAME">this.direction</span><span class="PUNC">=</span><span class="NAME">data.direction</span><span class="PUNC">;</span><span class="NAME">this.stabilizedTipPosition</span><span class="PUNC">=</span><span class="NAME">data.stabilizedTipPosition</span><span class="PUNC">;</span><span class="NAME">this.tipPosition</span><span class="PUNC">=</span><span class="NAME">data.tipPosition</span><span class="PUNC">;</span><span class="NAME">this.tipVelocity</span><span class="PUNC">=</span><span class="NAME">data.tipVelocity</span><span class="PUNC">;</span><span class="NAME">this.touchZone</span><span class="PUNC">=</span><span class="NAME">data.touchZone</span><span class="PUNC">;</span><span class="NAME">this.touchDistance</span><span class="PUNC">=</span><span class="NAME">data.touchDistance</span><span class="PUNC">;</span><span class="NAME">this.timeVisible</span><span class="PUNC">=</span><span class="NAME">data.timeVisible</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">Pointable.prototype.toString</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.tool</span><span class="PUNC">==</span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="STRN">"Pointable [ id:"</span><span class="PUNC">+</span><span class="NAME">this.id</span><span class="PUNC">+</span><span class="STRN">" "</span><span class="PUNC">+</span><span class="NAME">this.length</span><span class="PUNC">+</span><span class="STRN">"mmx | with:"</span><span class="PUNC">+</span><span class="NAME">this.width</span><span class="PUNC">+</span><span class="STRN">"mm | direction:"</span><span class="PUNC">+</span><span class="NAME">this.direction</span><span class="PUNC">+</span><span class="STRN">" ]"</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="STRN">"Pointable [ id:"</span><span class="PUNC">+</span><span class="NAME">this.id</span><span class="PUNC">+</span><span class="STRN">" "</span><span class="PUNC">+</span><span class="NAME">this.length</span><span class="PUNC">+</span><span class="STRN">"mmx | direction: "</span><span class="PUNC">+</span><span class="NAME">this.direction</span><span class="PUNC">+</span><span class="STRN">" ]"</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">Pointable.Invalid</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="NAME">valid</span><span class="PUNC">:</span><span class="KEYW">false</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="STRN">"gl-matrix"</span><span class="PUNC">:</span><span class="NUMB">19</span><span class="PUNC">}</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NUMB">12</span><span class="PUNC">:</span><span class="PUNC">[</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">require</span><span class="PUNC">,</span><span class="NAME">module</span><span class="PUNC">,</span><span class="NAME">exports</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">Frame</span><span class="PUNC">=</span><span class="NAME">require</span><span class="PUNC">(</span><span class="STRN">"./frame"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">Event</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">data</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.type</span><span class="PUNC">=</span><span class="NAME">data.type</span><span class="PUNC">;</span><span class="NAME">this.state</span><span class="PUNC">=</span><span class="NAME">data.state</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">chooseProtocol</span><span class="PUNC">=</span><span class="NAME">exports.chooseProtocol</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">header</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">protocol</span><span class="PUNC">;</span><span class="KEYW">switch</span><span class="PUNC">(</span><span class="NAME">header.version</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">:</span><span class="NAME">protocol</span><span class="PUNC">=</span><span class="NAME">JSONProtocol</span><span class="PUNC">(</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">data</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Frame</span><span class="PUNC">(</span><span class="NAME">data</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">:</span><span class="NAME">protocol</span><span class="PUNC">=</span><span class="NAME">JSONProtocol</span><span class="PUNC">(</span><span class="NUMB">2</span><span class="PUNC">,</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">data</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Frame</span><span class="PUNC">(</span><span class="NAME">data</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">protocol.sendHeartbeat</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">connection</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">connection.send</span><span class="PUNC">(</span><span class="NAME">protocol.encode</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="NAME">heartbeat</span><span class="PUNC">:</span><span class="KEYW">true</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="NUMB">3</span><span class="PUNC">:</span><span class="NAME">protocol</span><span class="PUNC">=</span><span class="NAME">JSONProtocol</span><span class="PUNC">(</span><span class="NUMB">3</span><span class="PUNC">,</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">data</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">data.event</span><span class="PUNC">?</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Event</span><span class="PUNC">(</span><span class="NAME">data.event</span><span class="PUNC">)</span><span class="PUNC">:</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Frame</span><span class="PUNC">(</span><span class="NAME">data</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">protocol.sendHeartbeat</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">connection</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">connection.send</span><span class="PUNC">(</span><span class="NAME">protocol.encode</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="NAME">heartbeat</span><span class="PUNC">:</span><span class="KEYW">true</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="KEYW">default</span><span class="PUNC">:</span><span class="KEYW">throw</span><span class="STRN">"unrecognized version"</span><span class="PUNC">}</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">protocol</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">JSONProtocol</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">version</span><span class="PUNC">,</span><span class="NAME">cb</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">protocol</span><span class="PUNC">=</span><span class="NAME">cb</span><span class="PUNC">;</span><span class="NAME">protocol.encode</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">message</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">JSON.stringify</span><span class="PUNC">(</span><span class="NAME">message</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">protocol.version</span><span class="PUNC">=</span><span class="NAME">version</span><span class="PUNC">;</span><span class="NAME">protocol.versionLong</span><span class="PUNC">=</span><span class="STRN">"Version "</span><span class="PUNC">+</span><span class="NAME">version</span><span class="PUNC">;</span><span class="NAME">protocol.type</span><span class="PUNC">=</span><span class="STRN">"protocol"</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">protocol</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="STRN">"./frame"</span><span class="PUNC">:</span><span class="NUMB">5</span><span class="PUNC">}</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NUMB">13</span><span class="PUNC">:</span><span class="PUNC">[</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">require</span><span class="PUNC">,</span><span class="NAME">module</span><span class="PUNC">,</span><span class="NAME">exports</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">exports.UI</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="NAME">Region</span><span class="PUNC">:</span><span class="NAME">require</span><span class="PUNC">(</span><span class="STRN">"./ui/region"</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">Cursor</span><span class="PUNC">:</span><span class="NAME">require</span><span class="PUNC">(</span><span class="STRN">"./ui/cursor"</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="STRN">"./ui/cursor"</span><span class="PUNC">:</span><span class="NUMB">14</span><span class="PUNC">,</span><span class="STRN">"./ui/region"</span><span class="PUNC">:</span><span class="NUMB">15</span><span class="PUNC">}</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NUMB">14</span><span class="PUNC">:</span><span class="PUNC">[</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">require</span><span class="PUNC">,</span><span class="NAME">module</span><span class="PUNC">,</span><span class="NAME">exports</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">Cursor</span><span class="PUNC">=</span><span class="NAME">module.exports</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">frame</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">pointable</span><span class="PUNC">=</span><span class="NAME">frame.pointables.sort</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">,</span><span class="NAME">b</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">a.z</span><span class="PUNC">-</span><span class="NAME">b.z</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">pointable</span><span class="PUNC">&&</span><span class="NAME">pointable.valid</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">frame.cursorPosition</span><span class="PUNC">=</span><span class="NAME">pointable.tipPosition</span><span class="PUNC">}</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">frame</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NUMB">15</span><span class="PUNC">:</span><span class="PUNC">[</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">require</span><span class="PUNC">,</span><span class="NAME">module</span><span class="PUNC">,</span><span class="NAME">exports</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">EventEmitter</span><span class="PUNC">=</span><span class="NAME">require</span><span class="PUNC">(</span><span class="STRN">"events"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">EventEmitter</span><span class="PUNC">,</span><span class="NAME">_</span><span class="PUNC">=</span><span class="NAME">require</span><span class="PUNC">(</span><span class="STRN">"underscore"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">Region</span><span class="PUNC">=</span><span class="NAME">module.exports</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">start</span><span class="PUNC">,</span><span class="NAME">end</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.start</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Vector</span><span class="PUNC">(</span><span class="NAME">start</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.end</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Vector</span><span class="PUNC">(</span><span class="NAME">end</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.enteredFrame</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">Region.prototype.hasPointables</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">frame</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">!=</span><span class="NAME">frame.pointables.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">position</span><span class="PUNC">=</span><span class="NAME">frame.pointables</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">tipPosition</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">position.x</span><span class="PUNC">>=</span><span class="NAME">this.start.x</span><span class="PUNC">&&</span><span class="NAME">position.x</span><span class="PUNC">&lt;=</span><span class="NAME">this.end.x</span><span class="PUNC">&&</span><span class="NAME">position.y</span><span class="PUNC">>=</span><span class="NAME">this.start.y</span><span class="PUNC">&&</span><span class="NAME">position.y</span><span class="PUNC">&lt;=</span><span class="NAME">this.end.y</span><span class="PUNC">&&</span><span class="NAME">position.z</span><span class="PUNC">>=</span><span class="NAME">this.start.z</span><span class="PUNC">&&</span><span class="NAME">position.z</span><span class="PUNC">&lt;=</span><span class="NAME">this.end.z</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">Region.prototype.listener</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">opts</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">region</span><span class="PUNC">=</span><span class="KEYW">this</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">opts</span><span class="PUNC">&&</span><span class="NAME">opts.nearThreshold</span><span class="PUNC">)</span><span class="NAME">this.setupNearRegion</span><span class="PUNC">(</span><span class="NAME">opts.nearThreshold</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">frame</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">region.updatePosition</span><span class="PUNC">(</span><span class="NAME">frame</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">Region.prototype.clipper</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">region</span><span class="PUNC">=</span><span class="KEYW">this</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">frame</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">region.updatePosition</span><span class="PUNC">(</span><span class="NAME">frame</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">region.enteredFrame</span><span class="PUNC">?</span><span class="NAME">frame</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">Region.prototype.setupNearRegion</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">distance</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">nearRegion</span><span class="PUNC">=</span><span class="NAME">this.nearRegion</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Region</span><span class="PUNC">(</span><span class="PUNC">[</span><span class="NAME">this.start.x</span><span class="PUNC">-</span><span class="NAME">distance</span><span class="PUNC">,</span><span class="NAME">this.start.y</span><span class="PUNC">-</span><span class="NAME">distance</span><span class="PUNC">,</span><span class="NAME">this.start.z</span><span class="PUNC">-</span><span class="NAME">distance</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="PUNC">[</span><span class="NAME">this.end.x</span><span class="PUNC">+</span><span class="NAME">distance</span><span class="PUNC">,</span><span class="NAME">this.end.y</span><span class="PUNC">+</span><span class="NAME">distance</span><span class="PUNC">,</span><span class="NAME">this.end.z</span><span class="PUNC">+</span><span class="NAME">distance</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">region</span><span class="PUNC">=</span><span class="KEYW">this</span><span class="PUNC">;</span><span class="NAME">nearRegion.on</span><span class="PUNC">(</span><span class="STRN">"enter"</span><span class="PUNC">,</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">frame</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">region.emit</span><span class="PUNC">(</span><span class="STRN">"near"</span><span class="PUNC">,</span><span class="NAME">frame</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">nearRegion.on</span><span class="PUNC">(</span><span class="STRN">"exit"</span><span class="PUNC">,</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">frame</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">region.emit</span><span class="PUNC">(</span><span class="STRN">"far"</span><span class="PUNC">,</span><span class="NAME">frame</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">region.on</span><span class="PUNC">(</span><span class="STRN">"exit"</span><span class="PUNC">,</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">frame</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">region.emit</span><span class="PUNC">(</span><span class="STRN">"near"</span><span class="PUNC">,</span><span class="NAME">frame</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">Region.prototype.updatePosition</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">frame</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.nearRegion</span><span class="PUNC">)</span><span class="NAME">this.nearRegion.updatePosition</span><span class="PUNC">(</span><span class="NAME">frame</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.hasPointables</span><span class="PUNC">(</span><span class="NAME">frame</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="NAME">this.enteredFrame</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.enteredFrame</span><span class="PUNC">=</span><span class="NAME">frame</span><span class="PUNC">;</span><span class="NAME">this.emit</span><span class="PUNC">(</span><span class="STRN">"enter"</span><span class="PUNC">,</span><span class="NAME">this.enteredFrame</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.hasPointables</span><span class="PUNC">(</span><span class="NAME">frame</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="NAME">this.enteredFrame</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.enteredFrame</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="NAME">this.emit</span><span class="PUNC">(</span><span class="STRN">"exit"</span><span class="PUNC">,</span><span class="NAME">this.enteredFrame</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">frame</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">Region.prototype.normalize</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">position</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Vector</span><span class="PUNC">(</span><span class="PUNC">[</span><span class="PUNC">(</span><span class="NAME">position.x</span><span class="PUNC">-</span><span class="NAME">this.start.x</span><span class="PUNC">)</span><span class="PUNC">/</span><span class="PUNC">(</span><span class="NAME">this.end.x</span><span class="PUNC">-</span><span class="NAME">this.start.x</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="PUNC">(</span><span class="NAME">position.y</span><span class="PUNC">-</span><span class="NAME">this.start.y</span><span class="PUNC">)</span><span class="PUNC">/</span><span class="PUNC">(</span><span class="NAME">this.end.y</span><span class="PUNC">-</span><span class="NAME">this.start.y</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="PUNC">(</span><span class="NAME">position.z</span><span class="PUNC">-</span><span class="NAME">this.start.z</span><span class="PUNC">)</span><span class="PUNC">/</span><span class="PUNC">(</span><span class="NAME">this.end.z</span><span class="PUNC">-</span><span class="NAME">this.start.z</span><span class="PUNC">)</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">Region.prototype.mapToXY</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">position</span><span class="PUNC">,</span><span class="NAME">width</span><span class="PUNC">,</span><span class="NAME">height</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">normalized</span><span class="PUNC">=</span><span class="NAME">this.normalize</span><span class="PUNC">(</span><span class="NAME">position</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">x</span><span class="PUNC">=</span><span class="NAME">normalized.x</span><span class="PUNC">,</span><span class="NAME">y</span><span class="PUNC">=</span><span class="NAME">normalized.y</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">x</span><span class="PUNC">></span><span class="NUMB">1</span><span class="PUNC">)</span><span class="NAME">x</span><span class="PUNC">=</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">x</span><span class="PUNC">&lt;</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="NAME">x</span><span class="PUNC">=</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">y</span><span class="PUNC">></span><span class="NUMB">1</span><span class="PUNC">)</span><span class="NAME">y</span><span class="PUNC">=</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">y</span><span class="PUNC">&lt;</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="NAME">y</span><span class="PUNC">=</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="PUNC">[</span><span class="PUNC">(</span><span class="NAME">x</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">/</span><span class="NUMB">2</span><span class="PUNC">*</span><span class="NAME">width</span><span class="PUNC">,</span><span class="PUNC">(</span><span class="NUMB">1</span><span class="PUNC">-</span><span class="NAME">y</span><span class="PUNC">)</span><span class="PUNC">/</span><span class="NUMB">2</span><span class="PUNC">*</span><span class="NAME">height</span><span class="PUNC">,</span><span class="NAME">normalized.z</span><span class="PUNC">]</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">_.extend</span><span class="PUNC">(</span><span class="NAME">Region.prototype</span><span class="PUNC">,</span><span class="NAME">EventEmitter.prototype</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">events</span><span class="PUNC">:</span><span class="NUMB">17</span><span class="PUNC">,</span><span class="NAME">underscore</span><span class="PUNC">:</span><span class="NUMB">20</span><span class="PUNC">}</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NUMB">16</span><span class="PUNC">:</span><span class="PUNC">[</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">require</span><span class="PUNC">,</span><span class="NAME">module</span><span class="PUNC">,</span><span class="NAME">exports</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NUMB">17</span><span class="PUNC">:</span><span class="PUNC">[</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">require</span><span class="PUNC">,</span><span class="NAME">module</span><span class="PUNC">,</span><span class="NAME">exports</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="PUNC">!</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">process</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">process.EventEmitter</span><span class="PUNC">)</span><span class="NAME">process.EventEmitter</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">EventEmitter</span><span class="PUNC">=</span><span class="NAME">exports.EventEmitter</span><span class="PUNC">=</span><span class="NAME">process.EventEmitter</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">isArray</span><span class="PUNC">=</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">Array.isArray</span><span class="PUNC">===</span><span class="STRN">"function"</span><span class="PUNC">?</span><span class="NAME">Array.isArray</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">xs</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">Object.prototype.toString.call</span><span class="PUNC">(</span><span class="NAME">xs</span><span class="PUNC">)</span><span class="PUNC">===</span><span class="STRN">"[object Array]"</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">indexOf</span><span class="PUNC">(</span><span class="NAME">xs</span><span class="PUNC">,</span><span class="NAME">x</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">xs.indexOf</span><span class="PUNC">)</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">xs.indexOf</span><span class="PUNC">(</span><span class="NAME">x</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">xs.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">x</span><span class="PUNC">===</span><span class="NAME">xs</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">}</span><span class="KEYW">return</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">}</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">defaultMaxListeners</span><span class="PUNC">=</span><span class="NUMB">10</span><span class="PUNC">;</span><span class="NAME">EventEmitter.prototype.setMaxListeners</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">n</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this._events</span><span class="PUNC">)</span><span class="NAME">this._events</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">this._events.maxListeners</span><span class="PUNC">=</span><span class="NAME">n</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">EventEmitter.prototype.emit</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">type</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">type</span><span class="PUNC">===</span><span class="STRN">"error"</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this._events</span><span class="PUNC">||</span><span class="PUNC">!</span><span class="NAME">this._events.error</span><span class="PUNC">||</span><span class="NAME">isArray</span><span class="PUNC">(</span><span class="NAME">this._events.error</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="PUNC">!</span><span class="NAME">this._events.error.length</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">arguments</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">Error</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">throw</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="KEYW">throw</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Error</span><span class="PUNC">(</span><span class="STRN">"Uncaught, unspecified 'error' event."</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this._events</span><span class="PUNC">)</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">handler</span><span class="PUNC">=</span><span class="NAME">this._events</span><span class="PUNC">[</span><span class="NAME">type</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">handler</span><span class="PUNC">)</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">handler</span><span class="PUNC">==</span><span class="STRN">"function"</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">switch</span><span class="PUNC">(</span><span class="NAME">arguments.length</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">:</span><span class="NAME">handler.call</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">:</span><span class="NAME">handler.call</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">arguments</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="NUMB">3</span><span class="PUNC">:</span><span class="NAME">handler.call</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">arguments</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">arguments</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="KEYW">default</span><span class="PUNC">:</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">args</span><span class="PUNC">=</span><span class="NAME">Array.prototype.slice.call</span><span class="PUNC">(</span><span class="NAME">arguments</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">handler.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">args</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">isArray</span><span class="PUNC">(</span><span class="NAME">handler</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">args</span><span class="PUNC">=</span><span class="NAME">Array.prototype.slice.call</span><span class="PUNC">(</span><span class="NAME">arguments</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">listeners</span><span class="PUNC">=</span><span class="NAME">handler.slice</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">l</span><span class="PUNC">=</span><span class="NAME">listeners.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">l</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">listeners</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">args</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">EventEmitter.prototype.addListener</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">type</span><span class="PUNC">,</span><span class="NAME">listener</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="STRN">"function"</span><span class="PUNC">!==</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">listener</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">throw</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Error</span><span class="PUNC">(</span><span class="STRN">"addListener only takes instances of Function"</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this._events</span><span class="PUNC">)</span><span class="NAME">this._events</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">this.emit</span><span class="PUNC">(</span><span class="STRN">"newListener"</span><span class="PUNC">,</span><span class="NAME">type</span><span class="PUNC">,</span><span class="NAME">listener</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this._events</span><span class="PUNC">[</span><span class="NAME">type</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this._events</span><span class="PUNC">[</span><span class="NAME">type</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">listener</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">isArray</span><span class="PUNC">(</span><span class="NAME">this._events</span><span class="PUNC">[</span><span class="NAME">type</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this._events</span><span class="PUNC">[</span><span class="NAME">type</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">warned</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">m</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this._events.maxListeners</span><span class="PUNC">!==</span><span class="NAME">undefined</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">m</span><span class="PUNC">=</span><span class="NAME">this._events.maxListeners</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">m</span><span class="PUNC">=</span><span class="NAME">defaultMaxListeners</span><span class="PUNC">}</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">m</span><span class="PUNC">&&</span><span class="NAME">m</span><span class="PUNC">></span><span class="NUMB">0</span><span class="PUNC">&&</span><span class="NAME">this._events</span><span class="PUNC">[</span><span class="NAME">type</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">length</span><span class="PUNC">></span><span class="NAME">m</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this._events</span><span class="PUNC">[</span><span class="NAME">type</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">warned</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="NAME">console.error</span><span class="PUNC">(</span><span class="STRN">"(node) warning: possible EventEmitter memory "</span><span class="PUNC">+</span><span class="STRN">"leak detected. %d listeners added. "</span><span class="PUNC">+</span><span class="STRN">"Use emitter.setMaxListeners() to increase limit."</span><span class="PUNC">,</span><span class="NAME">this._events</span><span class="PUNC">[</span><span class="NAME">type</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">length</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">console.trace</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="NAME">this._events</span><span class="PUNC">[</span><span class="NAME">type</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">push</span><span class="PUNC">(</span><span class="NAME">listener</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">this._events</span><span class="PUNC">[</span><span class="NAME">type</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="NAME">this._events</span><span class="PUNC">[</span><span class="NAME">type</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">listener</span><span class="PUNC">]</span><span class="PUNC">}</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">EventEmitter.prototype.on</span><span class="PUNC">=</span><span class="NAME">EventEmitter.prototype.addListener</span><span class="PUNC">;</span><span class="NAME">EventEmitter.prototype.once</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">type</span><span class="PUNC">,</span><span class="NAME">listener</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">self</span><span class="PUNC">=</span><span class="KEYW">this</span><span class="PUNC">;</span><span class="NAME">self.on</span><span class="PUNC">(</span><span class="NAME">type</span><span class="PUNC">,</span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">g</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">self.removeListener</span><span class="PUNC">(</span><span class="NAME">type</span><span class="PUNC">,</span><span class="NAME">g</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">listener.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">EventEmitter.prototype.removeListener</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">type</span><span class="PUNC">,</span><span class="NAME">listener</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="STRN">"function"</span><span class="PUNC">!==</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">listener</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">throw</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Error</span><span class="PUNC">(</span><span class="STRN">"removeListener only takes instances of Function"</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this._events</span><span class="PUNC">||</span><span class="PUNC">!</span><span class="NAME">this._events</span><span class="PUNC">[</span><span class="NAME">type</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">list</span><span class="PUNC">=</span><span class="NAME">this._events</span><span class="PUNC">[</span><span class="NAME">type</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">isArray</span><span class="PUNC">(</span><span class="NAME">list</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NAME">indexOf</span><span class="PUNC">(</span><span class="NAME">list</span><span class="PUNC">,</span><span class="NAME">listener</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="NAME">list.splice</span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">list.length</span><span class="PUNC">==</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="KEYW">delete</span><span class="WHIT"> </span><span class="NAME">this._events</span><span class="PUNC">[</span><span class="NAME">type</span><span class="PUNC">]</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this._events</span><span class="PUNC">[</span><span class="NAME">type</span><span class="PUNC">]</span><span class="PUNC">===</span><span class="NAME">listener</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">delete</span><span class="WHIT"> </span><span class="NAME">this._events</span><span class="PUNC">[</span><span class="NAME">type</span><span class="PUNC">]</span><span class="PUNC">}</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">EventEmitter.prototype.removeAllListeners</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">type</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">arguments.length</span><span class="PUNC">===</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this._events</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">}</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">type</span><span class="PUNC">&&</span><span class="NAME">this._events</span><span class="PUNC">&&</span><span class="NAME">this._events</span><span class="PUNC">[</span><span class="NAME">type</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="NAME">this._events</span><span class="PUNC">[</span><span class="NAME">type</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">EventEmitter.prototype.listeners</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">type</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this._events</span><span class="PUNC">)</span><span class="NAME">this._events</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this._events</span><span class="PUNC">[</span><span class="NAME">type</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="NAME">this._events</span><span class="PUNC">[</span><span class="NAME">type</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">isArray</span><span class="PUNC">(</span><span class="NAME">this._events</span><span class="PUNC">[</span><span class="NAME">type</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this._events</span><span class="PUNC">[</span><span class="NAME">type</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="NAME">this._events</span><span class="PUNC">[</span><span class="NAME">type</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">}</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this._events</span><span class="PUNC">[</span><span class="NAME">type</span><span class="PUNC">]</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">(</span><span class="NAME">require</span><span class="PUNC">(</span><span class="STRN">"__browserify_process"</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">__browserify_process</span><span class="PUNC">:</span><span class="NUMB">18</span><span class="PUNC">}</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NUMB">18</span><span class="PUNC">:</span><span class="PUNC">[</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">require</span><span class="PUNC">,</span><span class="NAME">module</span><span class="PUNC">,</span><span class="NAME">exports</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">process</span><span class="PUNC">=</span><span class="NAME">module.exports</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">process.nextTick</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">canSetImmediate</span><span class="PUNC">=</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">window</span><span class="PUNC">!==</span><span class="STRN">"undefined"</span><span class="PUNC">&&</span><span class="NAME">window.setImmediate</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">canPost</span><span class="PUNC">=</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">window</span><span class="PUNC">!==</span><span class="STRN">"undefined"</span><span class="PUNC">&&</span><span class="NAME">window.postMessage</span><span class="PUNC">&&</span><span class="NAME">window.addEventListener</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">canSetImmediate</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">f</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">window.setImmediate</span><span class="PUNC">(</span><span class="NAME">f</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">canPost</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">queue</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">window.addEventListener</span><span class="PUNC">(</span><span class="STRN">"message"</span><span class="PUNC">,</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">ev</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">ev.source</span><span class="PUNC">===</span><span class="NAME">window</span><span class="PUNC">&&</span><span class="NAME">ev.data</span><span class="PUNC">===</span><span class="STRN">"process-tick"</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">ev.stopPropagation</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">queue.length</span><span class="PUNC">></span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">fn</span><span class="PUNC">=</span><span class="NAME">queue.shift</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">fn</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">nextTick</span><span class="PUNC">(</span><span class="NAME">fn</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">queue.push</span><span class="PUNC">(</span><span class="NAME">fn</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">window.postMessage</span><span class="PUNC">(</span><span class="STRN">"process-tick"</span><span class="PUNC">,</span><span class="STRN">"*"</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">nextTick</span><span class="PUNC">(</span><span class="NAME">fn</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">setTimeout</span><span class="PUNC">(</span><span class="NAME">fn</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">process.title</span><span class="PUNC">=</span><span class="STRN">"browser"</span><span class="PUNC">;</span><span class="NAME">process.browser</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="NAME">process.env</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">process.argv</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">process.binding</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">name</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">throw</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Error</span><span class="PUNC">(</span><span class="STRN">"process.binding is not supported"</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">process.cwd</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="STRN">"/"</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">process.chdir</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">dir</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">throw</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Error</span><span class="PUNC">(</span><span class="STRN">"process.chdir is not supported"</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NUMB">19</span><span class="PUNC">:</span><span class="PUNC">[</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">require</span><span class="PUNC">,</span><span class="NAME">module</span><span class="PUNC">,</span><span class="NAME">exports</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="PUNC">!</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="PUNC">!</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="STRN">"use strict"</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">shim</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">exports</span><span class="PUNC">===</span><span class="STRN">"undefined"</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">define</span><span class="PUNC">==</span><span class="STRN">"function"</span><span class="PUNC">&&</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">define.amd</span><span class="PUNC">==</span><span class="STRN">"object"</span><span class="PUNC">&&</span><span class="NAME">define.amd</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">shim.exports</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">define</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">shim.exports</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">shim.exports</span><span class="PUNC">=</span><span class="NAME">window</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">shim.exports</span><span class="PUNC">=</span><span class="NAME">exports</span><span class="PUNC">}</span><span class="PUNC">!</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">exports</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">vec2</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">GLMAT_EPSILON</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">GLMAT_EPSILON</span><span class="PUNC">=</span><span class="NUMB">1</span><span class="NAME">e</span><span class="PUNC">-</span><span class="NUMB">6</span><span class="PUNC">}</span><span class="NAME">vec2.create</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Float32Array</span><span class="PUNC">(</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">vec2.clone</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">out</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Float32Array</span><span class="PUNC">(</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">out</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">vec2.fromValues</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">x</span><span class="PUNC">,</span><span class="NAME">y</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">out</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Float32Array</span><span class="PUNC">(</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">x</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">y</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">out</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">vec2.copy</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">out</span><span class="PUNC">,</span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">out</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">vec2.set</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">out</span><span class="PUNC">,</span><span class="NAME">x</span><span class="PUNC">,</span><span class="NAME">y</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">x</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">y</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">out</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">vec2.add</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">out</span><span class="PUNC">,</span><span class="NAME">a</span><span class="PUNC">,</span><span class="NAME">b</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">+</span><span class="NAME">b</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">+</span><span class="NAME">b</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">out</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">vec2.sub</span><span class="PUNC">=</span><span class="NAME">vec2.subtract</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">out</span><span class="PUNC">,</span><span class="NAME">a</span><span class="PUNC">,</span><span class="NAME">b</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">-</span><span class="NAME">b</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">-</span><span class="NAME">b</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">out</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">vec2.mul</span><span class="PUNC">=</span><span class="NAME">vec2.multiply</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">out</span><span class="PUNC">,</span><span class="NAME">a</span><span class="PUNC">,</span><span class="NAME">b</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">*</span><span class="NAME">b</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">*</span><span class="NAME">b</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">out</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">vec2.div</span><span class="PUNC">=</span><span class="NAME">vec2.divide</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">out</span><span class="PUNC">,</span><span class="NAME">a</span><span class="PUNC">,</span><span class="NAME">b</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">/</span><span class="NAME">b</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">/</span><span class="NAME">b</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">out</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">vec2.min</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">out</span><span class="PUNC">,</span><span class="NAME">a</span><span class="PUNC">,</span><span class="NAME">b</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">Math.min</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">b</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>  2</span> </span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">Math.min</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">b</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">out</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">vec2.max</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">out</span><span class="PUNC">,</span><span class="NAME">a</span><span class="PUNC">,</span><span class="NAME">b</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">Math.max</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">b</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">Math.max</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">b</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">out</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">vec2.scale</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">out</span><span class="PUNC">,</span><span class="NAME">a</span><span class="PUNC">,</span><span class="NAME">b</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">*</span><span class="NAME">b</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">*</span><span class="NAME">b</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">out</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">vec2.dist</span><span class="PUNC">=</span><span class="NAME">vec2.distance</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">,</span><span class="NAME">b</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">x</span><span class="PUNC">=</span><span class="NAME">b</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">-</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">y</span><span class="PUNC">=</span><span class="NAME">b</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">-</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">Math.sqrt</span><span class="PUNC">(</span><span class="NAME">x</span><span class="PUNC">*</span><span class="NAME">x</span><span class="PUNC">+</span><span class="NAME">y</span><span class="PUNC">*</span><span class="NAME">y</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">vec2.sqrDist</span><span class="PUNC">=</span><span class="NAME">vec2.squaredDistance</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">,</span><span class="NAME">b</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">x</span><span class="PUNC">=</span><span class="NAME">b</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">-</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">y</span><span class="PUNC">=</span><span class="NAME">b</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">-</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">x</span><span class="PUNC">*</span><span class="NAME">x</span><span class="PUNC">+</span><span class="NAME">y</span><span class="PUNC">*</span><span class="NAME">y</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">vec2.len</span><span class="PUNC">=</span><span class="NAME">vec2.length</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">x</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">y</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">Math.sqrt</span><span class="PUNC">(</span><span class="NAME">x</span><span class="PUNC">*</span><span class="NAME">x</span><span class="PUNC">+</span><span class="NAME">y</span><span class="PUNC">*</span><span class="NAME">y</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">vec2.sqrLen</span><span class="PUNC">=</span><span class="NAME">vec2.squaredLength</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">x</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">y</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">x</span><span class="PUNC">*</span><span class="NAME">x</span><span class="PUNC">+</span><span class="NAME">y</span><span class="PUNC">*</span><span class="NAME">y</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">vec2.negate</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">out</span><span class="PUNC">,</span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="PUNC">-</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="PUNC">-</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">out</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">vec2.normalize</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">out</span><span class="PUNC">,</span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">x</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">y</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">len</span><span class="PUNC">=</span><span class="NAME">x</span><span class="PUNC">*</span><span class="NAME">x</span><span class="PUNC">+</span><span class="NAME">y</span><span class="PUNC">*</span><span class="NAME">y</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">len</span><span class="PUNC">></span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">len</span><span class="PUNC">=</span><span class="NUMB">1</span><span class="PUNC">/</span><span class="NAME">Math.sqrt</span><span class="PUNC">(</span><span class="NAME">len</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">*</span><span class="NAME">len</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">*</span><span class="NAME">len</span><span class="PUNC">}</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">out</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">vec2.dot</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">,</span><span class="NAME">b</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">*</span><span class="NAME">b</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">+</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">*</span><span class="NAME">b</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">vec2.cross</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">out</span><span class="PUNC">,</span><span class="NAME">a</span><span class="PUNC">,</span><span class="NAME">b</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">z</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">*</span><span class="NAME">b</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">-</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">*</span><span class="NAME">b</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">z</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">out</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">vec2.lerp</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">out</span><span class="PUNC">,</span><span class="NAME">a</span><span class="PUNC">,</span><span class="NAME">b</span><span class="PUNC">,</span><span class="NAME">t</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ax</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">ay</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">ax</span><span class="PUNC">+</span><span class="NAME">t</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NAME">b</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">-</span><span class="NAME">ax</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">ay</span><span class="PUNC">+</span><span class="NAME">t</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NAME">b</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">-</span><span class="NAME">ay</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">out</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">vec2.transformMat2</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">out</span><span class="PUNC">,</span><span class="NAME">a</span><span class="PUNC">,</span><span class="NAME">m</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">x</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">y</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">x</span><span class="PUNC">*</span><span class="NAME">m</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">+</span><span class="NAME">y</span><span class="PUNC">*</span><span class="NAME">m</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">x</span><span class="PUNC">*</span><span class="NAME">m</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">+</span><span class="NAME">y</span><span class="PUNC">*</span><span class="NAME">m</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">out</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">vec2.forEach</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">vec</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Float32Array</span><span class="PUNC">(</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">,</span><span class="NAME">stride</span><span class="PUNC">,</span><span class="NAME">offset</span><span class="PUNC">,</span><span class="NAME">count</span><span class="PUNC">,</span><span class="NAME">fn</span><span class="PUNC">,</span><span class="NAME">arg</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">,</span><span class="NAME">l</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">stride</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">stride</span><span class="PUNC">=</span><span class="NUMB">2</span><span class="PUNC">}</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">offset</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">offset</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">}</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">count</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">l</span><span class="PUNC">=</span><span class="NAME">Math.min</span><span class="PUNC">(</span><span class="NAME">count</span><span class="PUNC">*</span><span class="NAME">stride</span><span class="PUNC">+</span><span class="NAME">offset</span><span class="PUNC">,</span><span class="NAME">a.length</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">l</span><span class="PUNC">=</span><span class="NAME">a.length</span><span class="PUNC">}</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">=</span><span class="NAME">offset</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">l</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="NAME">stride</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">vec</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">vec</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">fn</span><span class="PUNC">(</span><span class="NAME">vec</span><span class="PUNC">,</span><span class="NAME">vec</span><span class="PUNC">,</span><span class="NAME">arg</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">vec</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">vec</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">}</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">a</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">vec2.str</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="STRN">"vec2("</span><span class="PUNC">+</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">+</span><span class="STRN">", "</span><span class="PUNC">+</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">+</span><span class="STRN">")"</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">exports</span><span class="PUNC">!==</span><span class="STRN">"undefined"</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">exports.vec2</span><span class="PUNC">=</span><span class="NAME">vec2</span><span class="PUNC">}</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">vec3</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">GLMAT_EPSILON</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">GLMAT_EPSILON</span><span class="PUNC">=</span><span class="NUMB">1</span><span class="NAME">e</span><span class="PUNC">-</span><span class="NUMB">6</span><span class="PUNC">}</span><span class="NAME">vec3.create</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Float32Array</span><span class="PUNC">(</span><span class="NUMB">3</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">vec3.clone</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">out</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Float32Array</span><span class="PUNC">(</span><span class="NUMB">3</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">out</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">vec3.fromValues</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">x</span><span class="PUNC">,</span><span class="NAME">y</span><span class="PUNC">,</span><span class="NAME">z</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">out</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Float32Array</span><span class="PUNC">(</span><span class="NUMB">3</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">x</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">y</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">z</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">out</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">vec3.copy</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">out</span><span class="PUNC">,</span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">out</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">vec3.set</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">out</span><span class="PUNC">,</span><span class="NAME">x</span><span class="PUNC">,</span><span class="NAME">y</span><span class="PUNC">,</span><span class="NAME">z</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">x</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">y</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">z</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">out</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">vec3.add</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">out</span><span class="PUNC">,</span><span class="NAME">a</span><span class="PUNC">,</span><span class="NAME">b</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">+</span><span class="NAME">b</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">+</span><span class="NAME">b</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">+</span><span class="NAME">b</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">out</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">vec3.sub</span><span class="PUNC">=</span><span class="NAME">vec3.subtract</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">out</span><span class="PUNC">,</span><span class="NAME">a</span><span class="PUNC">,</span><span class="NAME">b</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">-</span><span class="NAME">b</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">-</span><span class="NAME">b</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">-</span><span class="NAME">b</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">out</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">vec3.mul</span><span class="PUNC">=</span><span class="NAME">vec3.multiply</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">out</span><span class="PUNC">,</span><span class="NAME">a</span><span class="PUNC">,</span><span class="NAME">b</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">*</span><span class="NAME">b</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">*</span><span class="NAME">b</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">*</span><span class="NAME">b</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">out</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">vec3.div</span><span class="PUNC">=</span><span class="NAME">vec3.divide</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">out</span><span class="PUNC">,</span><span class="NAME">a</span><span class="PUNC">,</span><span class="NAME">b</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">/</span><span class="NAME">b</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">/</span><span class="NAME">b</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">/</span><span class="NAME">b</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">out</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">vec3.min</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">out</span><span class="PUNC">,</span><span class="NAME">a</span><span class="PUNC">,</span><span class="NAME">b</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">Math.min</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">b</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">Math.min</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">b</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">Math.min</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">b</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">out</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">vec3.max</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">out</span><span class="PUNC">,</span><span class="NAME">a</span><span class="PUNC">,</span><span class="NAME">b</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">Math.max</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">b</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">Math.max</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">b</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">Math.max</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">b</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">out</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">vec3.scale</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">out</span><span class="PUNC">,</span><span class="NAME">a</span><span class="PUNC">,</span><span class="NAME">b</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">*</span><span class="NAME">b</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">*</span><span class="NAME">b</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">*</span><span class="NAME">b</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">out</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">vec3.dist</span><span class="PUNC">=</span><span class="NAME">vec3.distance</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">,</span><span class="NAME">b</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">x</span><span class="PUNC">=</span><span class="NAME">b</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">-</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">y</span><span class="PUNC">=</span><span class="NAME">b</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">-</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">z</span><span class="PUNC">=</span><span class="NAME">b</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">-</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">Math.sqrt</span><span class="PUNC">(</span><span class="NAME">x</span><span class="PUNC">*</span><span class="NAME">x</span><span class="PUNC">+</span><span class="NAME">y</span><span class="PUNC">*</span><span class="NAME">y</span><span class="PUNC">+</span><span class="NAME">z</span><span class="PUNC">*</span><span class="NAME">z</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">vec3.sqrDist</span><span class="PUNC">=</span><span class="NAME">vec3.squaredDistance</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">,</span><span class="NAME">b</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">x</span><span class="PUNC">=</span><span class="NAME">b</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">-</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">y</span><span class="PUNC">=</span><span class="NAME">b</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">-</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">z</span><span class="PUNC">=</span><span class="NAME">b</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">-</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">x</span><span class="PUNC">*</span><span class="NAME">x</span><span class="PUNC">+</span><span class="NAME">y</span><span class="PUNC">*</span><span class="NAME">y</span><span class="PUNC">+</span><span class="NAME">z</span><span class="PUNC">*</span><span class="NAME">z</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">vec3.len</span><span class="PUNC">=</span><span class="NAME">vec3.length</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">x</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">y</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">z</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">Math.sqrt</span><span class="PUNC">(</span><span class="NAME">x</span><span class="PUNC">*</span><span class="NAME">x</span><span class="PUNC">+</span><span class="NAME">y</span><span class="PUNC">*</span><span class="NAME">y</span><span class="PUNC">+</span><span class="NAME">z</span><span class="PUNC">*</span><span class="NAME">z</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">vec3.sqrLen</span><span class="PUNC">=</span><span class="NAME">vec3.squaredLength</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">x</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">y</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">z</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">x</span><span class="PUNC">*</span><span class="NAME">x</span><span class="PUNC">+</span><span class="NAME">y</span><span class="PUNC">*</span><span class="NAME">y</span><span class="PUNC">+</span><span class="NAME">z</span><span class="PUNC">*</span><span class="NAME">z</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">vec3.negate</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">out</span><span class="PUNC">,</span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="PUNC">-</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="PUNC">-</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="PUNC">-</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">out</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">vec3.normalize</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">out</span><span class="PUNC">,</span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">x</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">y</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">z</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">len</span><span class="PUNC">=</span><span class="NAME">x</span><span class="PUNC">*</span><span class="NAME">x</span><span class="PUNC">+</span><span class="NAME">y</span><span class="PUNC">*</span><span class="NAME">y</span><span class="PUNC">+</span><span class="NAME">z</span><span class="PUNC">*</span><span class="NAME">z</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">len</span><span class="PUNC">></span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">len</span><span class="PUNC">=</span><span class="NUMB">1</span><span class="PUNC">/</span><span class="NAME">Math.sqrt</span><span class="PUNC">(</span><span class="NAME">len</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">*</span><span class="NAME">len</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">*</span><span class="NAME">len</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">*</span><span class="NAME">len</span><span class="PUNC">}</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">out</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">vec3.dot</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">,</span><span class="NAME">b</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">*</span><span class="NAME">b</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">+</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">*</span><span class="NAME">b</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">+</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">*</span><span class="NAME">b</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">vec3.cross</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">out</span><span class="PUNC">,</span><span class="NAME">a</span><span class="PUNC">,</span><span class="NAME">b</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ax</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">ay</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">az</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">bx</span><span class="PUNC">=</span><span class="NAME">b</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">by</span><span class="PUNC">=</span><span class="NAME">b</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">bz</span><span class="PUNC">=</span><span class="NAME">b</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">ay</span><span class="PUNC">*</span><span class="NAME">bz</span><span class="PUNC">-</span><span class="NAME">az</span><span class="PUNC">*</span><span class="NAME">by</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">az</span><span class="PUNC">*</span><span class="NAME">bx</span><span class="PUNC">-</span><span class="NAME">ax</span><span class="PUNC">*</span><span class="NAME">bz</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">ax</span><span class="PUNC">*</span><span class="NAME">by</span><span class="PUNC">-</span><span class="NAME">ay</span><span class="PUNC">*</span><span class="NAME">bx</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">out</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">vec3.lerp</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">out</span><span class="PUNC">,</span><span class="NAME">a</span><span class="PUNC">,</span><span class="NAME">b</span><span class="PUNC">,</span><span class="NAME">t</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ax</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">ay</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">az</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">ax</span><span class="PUNC">+</span><span class="NAME">t</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NAME">b</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">-</span><span class="NAME">ax</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">ay</span><span class="PUNC">+</span><span class="NAME">t</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NAME">b</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">-</span><span class="NAME">ay</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">az</span><span class="PUNC">+</span><span class="NAME">t</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NAME">b</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">-</span><span class="NAME">az</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">out</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">vec3.transformMat4</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">out</span><span class="PUNC">,</span><span class="NAME">a</span><span class="PUNC">,</span><span class="NAME">m</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">x</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">y</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">z</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">m</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">*</span><span class="NAME">x</span><span class="PUNC">+</span><span class="NAME">m</span><span class="PUNC">[</span><span class="NUMB">4</span><span class="PUNC">]</span><span class="PUNC">*</span><span class="NAME">y</span><span class="PUNC">+</span><span class="NAME">m</span><span class="PUNC">[</span><span class="NUMB">8</span><span class="PUNC">]</span><span class="PUNC">*</span><span class="NAME">z</span><span class="PUNC">+</span><span class="NAME">m</span><span class="PUNC">[</span><span class="NUMB">12</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">m</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">*</span><span class="NAME">x</span><span class="PUNC">+</span><span class="NAME">m</span><span class="PUNC">[</span><span class="NUMB">5</span><span class="PUNC">]</span><span class="PUNC">*</span><span class="NAME">y</span><span class="PUNC">+</span><span class="NAME">m</span><span class="PUNC">[</span><span class="NUMB">9</span><span class="PUNC">]</span><span class="PUNC">*</span><span class="NAME">z</span><span class="PUNC">+</span><span class="NAME">m</span><span class="PUNC">[</span><span class="NUMB">13</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">m</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">*</span><span class="NAME">x</span><span class="PUNC">+</span><span class="NAME">m</span><span class="PUNC">[</span><span class="NUMB">6</span><span class="PUNC">]</span><span class="PUNC">*</span><span class="NAME">y</span><span class="PUNC">+</span><span class="NAME">m</span><span class="PUNC">[</span><span class="NUMB">10</span><span class="PUNC">]</span><span class="PUNC">*</span><span class="NAME">z</span><span class="PUNC">+</span><span class="NAME">m</span><span class="PUNC">[</span><span class="NUMB">14</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">out</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">vec3.transformQuat</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">out</span><span class="PUNC">,</span><span class="NAME">a</span><span class="PUNC">,</span><span class="NAME">q</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">x</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">y</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">z</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">qx</span><span class="PUNC">=</span><span class="NAME">q</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">qy</span><span class="PUNC">=</span><span class="NAME">q</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">qz</span><span class="PUNC">=</span><span class="NAME">q</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">qw</span><span class="PUNC">=</span><span class="NAME">q</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">ix</span><span class="PUNC">=</span><span class="NAME">qw</span><span class="PUNC">*</span><span class="NAME">x</span><span class="PUNC">+</span><span class="NAME">qy</span><span class="PUNC">*</span><span class="NAME">z</span><span class="PUNC">-</span><span class="NAME">qz</span><span class="PUNC">*</span><span class="NAME">y</span><span class="PUNC">,</span><span class="NAME">iy</span><span class="PUNC">=</span><span class="NAME">qw</span><span class="PUNC">*</span><span class="NAME">y</span><span class="PUNC">+</span><span class="NAME">qz</span><span class="PUNC">*</span><span class="NAME">x</span><span class="PUNC">-</span><span class="NAME">qx</span><span class="PUNC">*</span><span class="NAME">z</span><span class="PUNC">,</span><span class="NAME">iz</span><span class="PUNC">=</span><span class="NAME">qw</span><span class="PUNC">*</span><span class="NAME">z</span><span class="PUNC">+</span><span class="NAME">qx</span><span class="PUNC">*</span><span class="NAME">y</span><span class="PUNC">-</span><span class="NAME">qy</span><span class="PUNC">*</span><span class="NAME">x</span><span class="PUNC">,</span><span class="NAME">iw</span><span class="PUNC">=</span><span class="PUNC">-</span><span class="NAME">qx</span><span class="PUNC">*</span><span class="NAME">x</span><span class="PUNC">-</span><span class="NAME">qy</span><span class="PUNC">*</span><span class="NAME">y</span><span class="PUNC">-</span><span class="NAME">qz</span><span class="PUNC">*</span><span class="NAME">z</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">ix</span><span class="PUNC">*</span><span class="NAME">qw</span><span class="PUNC">+</span><span class="NAME">iw</span><span class="PUNC">*</span><span class="PUNC">-</span><span class="NAME">qx</span><span class="PUNC">+</span><span class="NAME">iy</span><span class="PUNC">*</span><span class="PUNC">-</span><span class="NAME">qz</span><span class="PUNC">-</span><span class="NAME">iz</span><span class="PUNC">*</span><span class="PUNC">-</span><span class="NAME">qy</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">iy</span><span class="PUNC">*</span><span class="NAME">qw</span><span class="PUNC">+</span><span class="NAME">iw</span><span class="PUNC">*</span><span class="PUNC">-</span><span class="NAME">qy</span><span class="PUNC">+</span><span class="NAME">iz</span><span class="PUNC">*</span><span class="PUNC">-</span><span class="NAME">qx</span><span class="PUNC">-</span><span class="NAME">ix</span><span class="PUNC">*</span><span class="PUNC">-</span><span class="NAME">qz</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">iz</span><span class="PUNC">*</span><span class="NAME">qw</span><span class="PUNC">+</span><span class="NAME">iw</span><span class="PUNC">*</span><span class="PUNC">-</span><span class="NAME">qz</span><span class="PUNC">+</span><span class="NAME">ix</span><span class="PUNC">*</span><span class="PUNC">-</span><span class="NAME">qy</span><span class="PUNC">-</span><span class="NAME">iy</span><span class="PUNC">*</span><span class="PUNC">-</span><span class="NAME">qx</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">out</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">vec3.forEach</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">vec</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Float32Array</span><span class="PUNC">(</span><span class="NUMB">3</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">,</span><span class="NAME">stride</span><span class="PUNC">,</span><span class="NAME">offset</span><span class="PUNC">,</span><span class="NAME">count</span><span class="PUNC">,</span><span class="NAME">fn</span><span class="PUNC">,</span><span class="NAME">arg</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">,</span><span class="NAME">l</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">stride</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">stride</span><span class="PUNC">=</span><span class="NUMB">3</span><span class="PUNC">}</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">offset</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">offset</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">}</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">count</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">l</span><span class="PUNC">=</span><span class="NAME">Math.min</span><span class="PUNC">(</span><span class="NAME">count</span><span class="PUNC">*</span><span class="NAME">stride</span><span class="PUNC">+</span><span class="NAME">offset</span><span class="PUNC">,</span><span class="NAME">a.length</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">l</span><span class="PUNC">=</span><span class="NAME">a.length</span><span class="PUNC">}</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">=</span><span class="NAME">offset</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">l</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="NAME">stride</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">vec</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">vec</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">vec</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">+</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">fn</span><span class="PUNC">(</span><span class="NAME">vec</span><span class="PUNC">,</span><span class="NAME">vec</span><span class="PUNC">,</span><span class="NAME">arg</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">vec</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">vec</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">+</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">vec</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">}</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">a</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">vec3.str</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="STRN">"vec3("</span><span class="PUNC">+</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">+</span><span class="STRN">", "</span><span class="PUNC">+</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">+</span><span class="STRN">", "</span><span class="PUNC">+</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">+</span><span class="STRN">")"</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">exports</span><span class="PUNC">!==</span><span class="STRN">"undefined"</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">exports.vec3</span><span class="PUNC">=</span><span class="NAME">vec3</span><span class="PUNC">}</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">vec4</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">GLMAT_EPSILON</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">GLMAT_EPSILON</span><span class="PUNC">=</span><span class="NUMB">1</span><span class="NAME">e</span><span class="PUNC">-</span><span class="NUMB">6</span><span class="PUNC">}</span><span class="NAME">vec4.create</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Float32Array</span><span class="PUNC">(</span><span class="NUMB">4</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">vec4.clone</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">out</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Float32Array</span><span class="PUNC">(</span><span class="NUMB">4</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">out</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">vec4.fromValues</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">x</span><span class="PUNC">,</span><span class="NAME">y</span><span class="PUNC">,</span><span class="NAME">z</span><span class="PUNC">,</span><span class="NAME">w</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">out</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Float32Array</span><span class="PUNC">(</span><span class="NUMB">4</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">x</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">y</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">z</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">w</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">out</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">vec4.copy</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">out</span><span class="PUNC">,</span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">out</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">vec4.set</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">out</span><span class="PUNC">,</span><span class="NAME">x</span><span class="PUNC">,</span><span class="NAME">y</span><span class="PUNC">,</span><span class="NAME">z</span><span class="PUNC">,</span><span class="NAME">w</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">x</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">y</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">z</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">w</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">out</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">vec4.add</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">out</span><span class="PUNC">,</span><span class="NAME">a</span><span class="PUNC">,</span><span class="NAME">b</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">+</span><span class="NAME">b</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">+</span><span class="NAME">b</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">+</span><span class="NAME">b</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">+</span><span class="NAME">b</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">out</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">vec4.sub</span><span class="PUNC">=</span><span class="NAME">vec4.subtract</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">out</span><span class="PUNC">,</span><span class="NAME">a</span><span class="PUNC">,</span><span class="NAME">b</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">-</span><span class="NAME">b</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">-</span><span class="NAME">b</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">-</span><span class="NAME">b</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">-</span><span class="NAME">b</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">out</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">vec4.mul</span><span class="PUNC">=</span><span class="NAME">vec4.multiply</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">out</span><span class="PUNC">,</span><span class="NAME">a</span><span class="PUNC">,</span><span class="NAME">b</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">*</span><span class="NAME">b</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">*</span><span class="NAME">b</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">*</span><span class="NAME">b</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">*</span><span class="NAME">b</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">out</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">vec4.div</span><span class="PUNC">=</span><span class="NAME">vec4.divide</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">out</span><span class="PUNC">,</span><span class="NAME">a</span><span class="PUNC">,</span><span class="NAME">b</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">/</span><span class="NAME">b</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">/</span><span class="NAME">b</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">/</span><span class="NAME">b</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">/</span><span class="NAME">b</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">out</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">vec4.min</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">out</span><span class="PUNC">,</span><span class="NAME">a</span><span class="PUNC">,</span><span class="NAME">b</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">Math.min</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">b</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">Math.min</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">b</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">Math.min</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">b</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">Math.min</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">b</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">out</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">vec4.max</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">out</span><span class="PUNC">,</span><span class="NAME">a</span><span class="PUNC">,</span><span class="NAME">b</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">Math.max</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">b</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">Math.max</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">b</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">Math.max</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">b</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">Math.max</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">b</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">out</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">vec4.scale</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">out</span><span class="PUNC">,</span><span class="NAME">a</span><span class="PUNC">,</span><span class="NAME">b</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">*</span><span class="NAME">b</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">*</span><span class="NAME">b</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">*</span><span class="NAME">b</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">*</span><span class="NAME">b</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">out</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">vec4.dist</span><span class="PUNC">=</span><span class="NAME">vec4.distance</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">,</span><span class="NAME">b</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">x</span><span class="PUNC">=</span><span class="NAME">b</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">-</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">y</span><span class="PUNC">=</span><span class="NAME">b</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">-</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">z</span><span class="PUNC">=</span><span class="NAME">b</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">-</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">w</span><span class="PUNC">=</span><span class="NAME">b</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">-</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">Math.sqrt</span><span class="PUNC">(</span><span class="NAME">x</span><span class="PUNC">*</span><span class="NAME">x</span><span class="PUNC">+</span><span class="NAME">y</span><span class="PUNC">*</span><span class="NAME">y</span><span class="PUNC">+</span><span class="NAME">z</span><span class="PUNC">*</span><span class="NAME">z</span><span class="PUNC">+</span><span class="NAME">w</span><span class="PUNC">*</span><span class="NAME">w</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">vec4.sqrDist</span><span class="PUNC">=</span><span class="NAME">vec4.squaredDistance</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">,</span><span class="NAME">b</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">x</span><span class="PUNC">=</span><span class="NAME">b</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">-</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">y</span><span class="PUNC">=</span><span class="NAME">b</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">-</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">z</span><span class="PUNC">=</span><span class="NAME">b</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">-</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">w</span><span class="PUNC">=</span><span class="NAME">b</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">-</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">x</span><span class="PUNC">*</span><span class="NAME">x</span><span class="PUNC">+</span><span class="NAME">y</span><span class="PUNC">*</span><span class="NAME">y</span><span class="PUNC">+</span><span class="NAME">z</span><span class="PUNC">*</span><span class="NAME">z</span><span class="PUNC">+</span><span class="NAME">w</span><span class="PUNC">*</span><span class="NAME">w</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">vec4.len</span><span class="PUNC">=</span><span class="NAME">vec4.length</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">x</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">y</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">z</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">w</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">Math.sqrt</span><span class="PUNC">(</span><span class="NAME">x</span><span class="PUNC">*</span><span class="NAME">x</span><span class="PUNC">+</span><span class="NAME">y</span><span class="PUNC">*</span><span class="NAME">y</span><span class="PUNC">+</span><span class="NAME">z</span><span class="PUNC">*</span><span class="NAME">z</span><span class="PUNC">+</span><span class="NAME">w</span><span class="PUNC">*</span><span class="NAME">w</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">vec4.sqrLen</span><span class="PUNC">=</span><span class="NAME">vec4.squaredLength</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">x</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">y</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">z</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">w</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">x</span><span class="PUNC">*</span><span class="NAME">x</span><span class="PUNC">+</span><span class="NAME">y</span><span class="PUNC">*</span><span class="NAME">y</span><span class="PUNC">+</span><span class="NAME">z</span><span class="PUNC">*</span><span class="NAME">z</span><span class="PUNC">+</span><span class="NAME">w</span><span class="PUNC">*</span><span class="NAME">w</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">vec4.negate</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">out</span><span class="PUNC">,</span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="PUNC">-</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="PUNC">-</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="PUNC">-</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="PUNC">-</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">out</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">vec4.normalize</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">out</span><span class="PUNC">,</span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">x</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">y</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">z</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">w</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">len</span><span class="PUNC">=</span><span class="NAME">x</span><span class="PUNC">*</span><span class="NAME">x</span><span class="PUNC">+</span><span class="NAME">y</span><span class="PUNC">*</span><span class="NAME">y</span><span class="PUNC">+</span><span class="NAME">z</span><span class="PUNC">*</span><span class="NAME">z</span><span class="PUNC">+</span><span class="NAME">w</span><span class="PUNC">*</span><span class="NAME">w</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">len</span><span class="PUNC">></span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">len</span><span class="PUNC">=</span><span class="NUMB">1</span><span class="PUNC">/</span><span class="NAME">Math.sqrt</span><span class="PUNC">(</span><span class="NAME">len</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">*</span><span class="NAME">len</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">*</span><span class="NAME">len</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">*</span><span class="NAME">len</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">*</span><span class="NAME">len</span><span class="PUNC">}</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">out</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">vec4.dot</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">,</span><span class="NAME">b</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">*</span><span class="NAME">b</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">+</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">*</span><span class="NAME">b</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">+</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">*</span><span class="NAME">b</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">+</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">*</span><span class="NAME">b</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">vec4.lerp</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">out</span><span class="PUNC">,</span><span class="NAME">a</span><span class="PUNC">,</span><span class="NAME">b</span><span class="PUNC">,</span><span class="NAME">t</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ax</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">ay</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">az</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">aw</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">ax</span><span class="PUNC">+</span><span class="NAME">t</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NAME">b</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">-</span><span class="NAME">ax</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">ay</span><span class="PUNC">+</span><span class="NAME">t</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NAME">b</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">-</span><span class="NAME">ay</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">az</span><span class="PUNC">+</span><span class="NAME">t</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NAME">b</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">-</span><span class="NAME">az</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">aw</span><span class="PUNC">+</span><span class="NAME">t</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NAME">b</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">-</span><span class="NAME">aw</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">out</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">vec4.transformMat4</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">out</span><span class="PUNC">,</span><span class="NAME">a</span><span class="PUNC">,</span><span class="NAME">m</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">x</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">y</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">z</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">w</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">m</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">*</span><span class="NAME">x</span><span class="PUNC">+</span><span class="NAME">m</span><span class="PUNC">[</span><span class="NUMB">4</span><span class="PUNC">]</span><span class="PUNC">*</span><span class="NAME">y</span><span class="PUNC">+</span><span class="NAME">m</span><span class="PUNC">[</span><span class="NUMB">8</span><span class="PUNC">]</span><span class="PUNC">*</span><span class="NAME">z</span><span class="PUNC">+</span><span class="NAME">m</span><span class="PUNC">[</span><span class="NUMB">12</span><span class="PUNC">]</span><span class="PUNC">*</span><span class="NAME">w</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">m</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">*</span><span class="NAME">x</span><span class="PUNC">+</span><span class="NAME">m</span><span class="PUNC">[</span><span class="NUMB">5</span><span class="PUNC">]</span><span class="PUNC">*</span><span class="NAME">y</span><span class="PUNC">+</span><span class="NAME">m</span><span class="PUNC">[</span><span class="NUMB">9</span><span class="PUNC">]</span><span class="PUNC">*</span><span class="NAME">z</span><span class="PUNC">+</span><span class="NAME">m</span><span class="PUNC">[</span><span class="NUMB">13</span><span class="PUNC">]</span><span class="PUNC">*</span><span class="NAME">w</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">m</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">*</span><span class="NAME">x</span><span class="PUNC">+</span><span class="NAME">m</span><span class="PUNC">[</span><span class="NUMB">6</span><span class="PUNC">]</span><span class="PUNC">*</span><span class="NAME">y</span><span class="PUNC">+</span><span class="NAME">m</span><span class="PUNC">[</span><span class="NUMB">10</span><span class="PUNC">]</span><span class="PUNC">*</span><span class="NAME">z</span><span class="PUNC">+</span><span class="NAME">m</span><span class="PUNC">[</span><span class="NUMB">14</span><span class="PUNC">]</span><span class="PUNC">*</span><span class="NAME">w</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">m</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">*</span><span class="NAME">x</span><span class="PUNC">+</span><span class="NAME">m</span><span class="PUNC">[</span><span class="NUMB">7</span><span class="PUNC">]</span><span class="PUNC">*</span><span class="NAME">y</span><span class="PUNC">+</span><span class="NAME">m</span><span class="PUNC">[</span><span class="NUMB">11</span><span class="PUNC">]</span><span class="PUNC">*</span><span class="NAME">z</span><span class="PUNC">+</span><span class="NAME">m</span><span class="PUNC">[</span><span class="NUMB">15</span><span class="PUNC">]</span><span class="PUNC">*</span><span class="NAME">w</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">out</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">vec4.transformQuat</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">out</span><span class="PUNC">,</span><span class="NAME">a</span><span class="PUNC">,</span><span class="NAME">q</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">x</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">y</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">z</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">qx</span><span class="PUNC">=</span><span class="NAME">q</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">qy</span><span class="PUNC">=</span><span class="NAME">q</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">qz</span><span class="PUNC">=</span><span class="NAME">q</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">qw</span><span class="PUNC">=</span><span class="NAME">q</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">ix</span><span class="PUNC">=</span><span class="NAME">qw</span><span class="PUNC">*</span><span class="NAME">x</span><span class="PUNC">+</span><span class="NAME">qy</span><span class="PUNC">*</span><span class="NAME">z</span><span class="PUNC">-</span><span class="NAME">qz</span><span class="PUNC">*</span><span class="NAME">y</span><span class="PUNC">,</span><span class="NAME">iy</span><span class="PUNC">=</span><span class="NAME">qw</span><span class="PUNC">*</span><span class="NAME">y</span><span class="PUNC">+</span><span class="NAME">qz</span><span class="PUNC">*</span><span class="NAME">x</span><span class="PUNC">-</span><span class="NAME">qx</span><span class="PUNC">*</span><span class="NAME">z</span><span class="PUNC">,</span><span class="NAME">iz</span><span class="PUNC">=</span><span class="NAME">qw</span><span class="PUNC">*</span><span class="NAME">z</span><span class="PUNC">+</span><span class="NAME">qx</span><span class="PUNC">*</span><span class="NAME">y</span><span class="PUNC">-</span><span class="NAME">qy</span><span class="PUNC">*</span><span class="NAME">x</span><span class="PUNC">,</span><span class="NAME">iw</span><span class="PUNC">=</span><span class="PUNC">-</span><span class="NAME">qx</span><span class="PUNC">*</span><span class="NAME">x</span><span class="PUNC">-</span><span class="NAME">qy</span><span class="PUNC">*</span><span class="NAME">y</span><span class="PUNC">-</span><span class="NAME">qz</span><span class="PUNC">*</span><span class="NAME">z</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">ix</span><span class="PUNC">*</span><span class="NAME">qw</span><span class="PUNC">+</span><span class="NAME">iw</span><span class="PUNC">*</span><span class="PUNC">-</span><span class="NAME">qx</span><span class="PUNC">+</span><span class="NAME">iy</span><span class="PUNC">*</span><span class="PUNC">-</span><span class="NAME">qz</span><span class="PUNC">-</span><span class="NAME">iz</span><span class="PUNC">*</span><span class="PUNC">-</span><span class="NAME">qy</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">iy</span><span class="PUNC">*</span><span class="NAME">qw</span><span class="PUNC">+</span><span class="NAME">iw</span><span class="PUNC">*</span><span class="PUNC">-</span><span class="NAME">qy</span><span class="PUNC">+</span><span class="NAME">iz</span><span class="PUNC">*</span><span class="PUNC">-</span><span class="NAME">qx</span><span class="PUNC">-</span><span class="NAME">ix</span><span class="PUNC">*</span><span class="PUNC">-</span><span class="NAME">qz</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">iz</span><span class="PUNC">*</span><span class="NAME">qw</span><span class="PUNC">+</span><span class="NAME">iw</span><span class="PUNC">*</span><span class="PUNC">-</span><span class="NAME">qz</span><span class="PUNC">+</span><span class="NAME">ix</span><span class="PUNC">*</span><span class="PUNC">-</span><span class="NAME">qy</span><span class="PUNC">-</span><span class="NAME">iy</span><span class="PUNC">*</span><span class="PUNC">-</span><span class="NAME">qx</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">out</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">vec4.forEach</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">vec</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Float32Array</span><span class="PUNC">(</span><span class="NUMB">4</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">,</span><span class="NAME">stride</span><span class="PUNC">,</span><span class="NAME">offset</span><span class="PUNC">,</span><span class="NAME">count</span><span class="PUNC">,</span><span class="NAME">fn</span><span class="PUNC">,</span><span class="NAME">arg</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">,</span><span class="NAME">l</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">stride</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">stride</span><span class="PUNC">=</span><span class="NUMB">4</span><span class="PUNC">}</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">offset</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">offset</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">}</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">count</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">l</span><span class="PUNC">=</span><span class="NAME">Math.min</span><span class="PUNC">(</span><span class="NAME">count</span><span class="PUNC">*</span><span class="NAME">stride</span><span class="PUNC">+</span><span class="NAME">offset</span><span class="PUNC">,</span><span class="NAME">a.length</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">l</span><span class="PUNC">=</span><span class="NAME">a.length</span><span class="PUNC">}</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">=</span><span class="NAME">offset</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">l</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="NAME">stride</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">vec</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">vec</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">vec</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">+</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">vec</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">+</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">fn</span><span class="PUNC">(</span><span class="NAME">vec</span><span class="PUNC">,</span><span class="NAME">vec</span><span class="PUNC">,</span><span class="NAME">arg</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">vec</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">vec</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">+</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">vec</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">+</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">vec</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">}</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">a</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">vec4.str</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="STRN">"vec4("</span><span class="PUNC">+</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">+</span><span class="STRN">", "</span><span class="PUNC">+</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">+</span><span class="STRN">", "</span><span class="PUNC">+</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">+</span><span class="STRN">", "</span><span class="PUNC">+</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">+</span><span class="STRN">")"</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">exports</span><span class="PUNC">!==</span><span class="STRN">"undefined"</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">exports.vec4</span><span class="PUNC">=</span><span class="NAME">vec4</span><span class="PUNC">}</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">mat2</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">mat2Identity</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Float32Array</span><span class="PUNC">(</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">GLMAT_EPSILON</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">GLMAT_EPSILON</span><span class="PUNC">=</span><span class="NUMB">1</span><span class="NAME">e</span><span class="PUNC">-</span><span class="NUMB">6</span><span class="PUNC">}</span><span class="NAME">mat2.create</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Float32Array</span><span class="PUNC">(</span><span class="NAME">mat2Identity</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">mat2.clone</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">out</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Float32Array</span><span class="PUNC">(</span><span class="NUMB">4</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">out</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">mat2.copy</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">out</span><span class="PUNC">,</span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">out</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">mat2.identity</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">out</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">out</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">mat2.transpose</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">out</span><span class="PUNC">,</span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">out</span><span class="PUNC">===</span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">a1</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a1</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">}</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">out</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">mat2.invert</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">out</span><span class="PUNC">,</span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">a0</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">a1</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">a2</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">a3</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">det</span><span class="PUNC">=</span><span class="NAME">a0</span><span class="PUNC">*</span><span class="NAME">a3</span><span class="PUNC">-</span><span class="NAME">a2</span><span class="PUNC">*</span><span class="NAME">a1</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">det</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">}</span><span class="NAME">det</span><span class="PUNC">=</span><span class="NUMB">1</span><span class="PUNC">/</span><span class="NAME">det</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a3</span><span class="PUNC">*</span><span class="NAME">det</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="PUNC">-</span><span class="NAME">a1</span><span class="PUNC">*</span><span class="NAME">det</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="PUNC">-</span><span class="NAME">a2</span><span class="PUNC">*</span><span class="NAME">det</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a0</span><span class="PUNC">*</span><span class="NAME">det</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">out</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">mat2.adjoint</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">out</span><span class="PUNC">,</span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">a0</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="PUNC">-</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="PUNC">-</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a0</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">out</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">mat2.determinant</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">*</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">-</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">*</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">mat2.mul</span><span class="PUNC">=</span><span class="NAME">mat2.multiply</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">out</span><span class="PUNC">,</span><span class="NAME">a</span><span class="PUNC">,</span><span class="NAME">b</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">a0</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">a1</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">a2</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">a3</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">b0</span><span class="PUNC">=</span><span class="NAME">b</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">b1</span><span class="PUNC">=</span><span class="NAME">b</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">b2</span><span class="PUNC">=</span><span class="NAME">b</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">b3</span><span class="PUNC">=</span><span class="NAME">b</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a0</span><span class="PUNC">*</span><span class="NAME">b0</span><span class="PUNC">+</span><span class="NAME">a1</span><span class="PUNC">*</span><span class="NAME">b2</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a0</span><span class="PUNC">*</span><span class="NAME">b1</span><span class="PUNC">+</span><span class="NAME">a1</span><span class="PUNC">*</span><span class="NAME">b3</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a2</span><span class="PUNC">*</span><span class="NAME">b0</span><span class="PUNC">+</span><span class="NAME">a3</span><span class="PUNC">*</span><span class="NAME">b2</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a2</span><span class="PUNC">*</span><span class="NAME">b1</span><span class="PUNC">+</span><span class="NAME">a3</span><span class="PUNC">*</span><span class="NAME">b3</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">out</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">mat2.rotate</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">out</span><span class="PUNC">,</span><span class="NAME">a</span><span class="PUNC">,</span><span class="NAME">rad</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">a0</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">a1</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">a2</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">a3</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">s</span><span class="PUNC">=</span><span class="NAME">Math.sin</span><span class="PUNC">(</span><span class="NAME">rad</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">c</span><span class="PUNC">=</span><span class="NAME">Math.cos</span><span class="PUNC">(</span><span class="NAME">rad</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a0</span><span class="PUNC">*</span><span class="NAME">c</span><span class="PUNC">+</span><span class="NAME">a1</span><span class="PUNC">*</span><span class="NAME">s</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a0</span><span class="PUNC">*</span><span class="PUNC">-</span><span class="NAME">s</span><span class="PUNC">+</span><span class="NAME">a1</span><span class="PUNC">*</span><span class="NAME">c</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a2</span><span class="PUNC">*</span><span class="NAME">c</span><span class="PUNC">+</span><span class="NAME">a3</span><span class="PUNC">*</span><span class="NAME">s</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a2</span><span class="PUNC">*</span><span class="PUNC">-</span><span class="NAME">s</span><span class="PUNC">+</span><span class="NAME">a3</span><span class="PUNC">*</span><span class="NAME">c</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">out</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">mat2.scale</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">out</span><span class="PUNC">,</span><span class="NAME">a</span><span class="PUNC">,</span><span class="NAME">v</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">a0</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">a1</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">a2</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">a3</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">v0</span><span class="PUNC">=</span><span class="NAME">v</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">v1</span><span class="PUNC">=</span><span class="NAME">v</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a0</span><span class="PUNC">*</span><span class="NAME">v0</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a1</span><span class="PUNC">*</span><span class="NAME">v1</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a2</span><span class="PUNC">*</span><span class="NAME">v0</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a3</span><span class="PUNC">*</span><span class="NAME">v1</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">out</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">mat2.str</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="STRN">"mat2("</span><span class="PUNC">+</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">+</span><span class="STRN">", "</span><span class="PUNC">+</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">+</span><span class="STRN">", "</span><span class="PUNC">+</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">+</span><span class="STRN">", "</span><span class="PUNC">+</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">+</span><span class="STRN">")"</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">exports</span><span class="PUNC">!==</span><span class="STRN">"undefined"</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">exports.mat2</span><span class="PUNC">=</span><span class="NAME">mat2</span><span class="PUNC">}</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">mat3</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">mat3Identity</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Float32Array</span><span class="PUNC">(</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">GLMAT_EPSILON</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">GLMAT_EPSILON</span><span class="PUNC">=</span><span class="NUMB">1</span><span class="NAME">e</span><span class="PUNC">-</span><span class="NUMB">6</span><span class="PUNC">}</span><span class="NAME">mat3.create</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Float32Array</span><span class="PUNC">(</span><span class="NAME">mat3Identity</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">mat3.clone</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">out</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Float32Array</span><span class="PUNC">(</span><span class="NUMB">9</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">4</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">4</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">5</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">5</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">6</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">6</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">7</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">7</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">8</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">8</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">out</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">mat3.copy</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">out</span><span class="PUNC">,</span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">4</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">4</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">5</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">5</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">6</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">6</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">7</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">7</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">8</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">8</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">out</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">mat3.identity</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">out</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">4</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">5</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">6</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">7</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">8</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">out</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">mat3.transpose</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">out</span><span class="PUNC">,</span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">out</span><span class="PUNC">===</span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">a01</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">a02</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">a12</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">5</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">6</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a01</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">5</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">7</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">6</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a02</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">7</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a12</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">6</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">4</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">4</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">5</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">7</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">6</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">7</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">5</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">8</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">8</span><span class="PUNC">]</span><span class="PUNC">}</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">out</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">mat3.invert</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">out</span><span class="PUNC">,</span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">a00</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">a01</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">a02</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">a10</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">a11</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">4</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">a12</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">5</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">a20</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">6</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">a21</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">7</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">a22</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">8</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">b01</span><span class="PUNC">=</span><span class="NAME">a22</span><span class="PUNC">*</span><span class="NAME">a11</span><span class="PUNC">-</span><span class="NAME">a12</span><span class="PUNC">*</span><span class="NAME">a21</span><span class="PUNC">,</span><span class="NAME">b11</span><span class="PUNC">=</span><span class="PUNC">-</span><span class="NAME">a22</span><span class="PUNC">*</span><span class="NAME">a10</span><span class="PUNC">+</span><span class="NAME">a12</span><span class="PUNC">*</span><span class="NAME">a20</span><span class="PUNC">,</span><span class="NAME">b21</span><span class="PUNC">=</span><span class="NAME">a21</span><span class="PUNC">*</span><span class="NAME">a10</span><span class="PUNC">-</span><span class="NAME">a11</span><span class="PUNC">*</span><span class="NAME">a20</span><span class="PUNC">,</span><span class="NAME">det</span><span class="PUNC">=</span><span class="NAME">a00</span><span class="PUNC">*</span><span class="NAME">b01</span><span class="PUNC">+</span><span class="NAME">a01</span><span class="PUNC">*</span><span class="NAME">b11</span><span class="PUNC">+</span><span class="NAME">a02</span><span class="PUNC">*</span><span class="NAME">b21</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">det</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">}</span><span class="NAME">det</span><span class="PUNC">=</span><span class="NUMB">1</span><span class="PUNC">/</span><span class="NAME">det</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">b01</span><span class="PUNC">*</span><span class="NAME">det</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="PUNC">-</span><span class="NAME">a22</span><span class="PUNC">*</span><span class="NAME">a01</span><span class="PUNC">+</span><span class="NAME">a02</span><span class="PUNC">*</span><span class="NAME">a21</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="NAME">det</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">a12</span><span class="PUNC">*</span><span class="NAME">a01</span><span class="PUNC">-</span><span class="NAME">a02</span><span class="PUNC">*</span><span class="NAME">a11</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="NAME">det</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">b11</span><span class="PUNC">*</span><span class="NAME">det</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">4</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">a22</span><span class="PUNC">*</span><span class="NAME">a00</span><span class="PUNC">-</span><span class="NAME">a02</span><span class="PUNC">*</span><span class="NAME">a20</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="NAME">det</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">5</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="PUNC">-</span><span class="NAME">a12</span><span class="PUNC">*</span><span class="NAME">a00</span><span class="PUNC">+</span><span class="NAME">a02</span><span class="PUNC">*</span><span class="NAME">a10</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="NAME">det</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">6</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">b21</span><span class="PUNC">*</span><span class="NAME">det</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">7</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="PUNC">-</span><span class="NAME">a21</span><span class="PUNC">*</span><span class="NAME">a00</span><span class="PUNC">+</span><span class="NAME">a01</span><span class="PUNC">*</span><span class="NAME">a20</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="NAME">det</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">8</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">a11</span><span class="PUNC">*</span><span class="NAME">a00</span><span class="PUNC">-</span><span class="NAME">a01</span><span class="PUNC">*</span><span class="NAME">a10</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="NAME">det</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">out</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">mat3.adjoint</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">out</span><span class="PUNC">,</span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">a00</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">a01</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">a02</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">a10</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">a11</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">4</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">a12</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">5</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">a20</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">6</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">a21</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">7</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">a22</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">8</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a11</span><span class="PUNC">*</span><span class="NAME">a22</span><span class="PUNC">-</span><span class="NAME">a12</span><span class="PUNC">*</span><span class="NAME">a21</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a02</span><span class="PUNC">*</span><span class="NAME">a21</span><span class="PUNC">-</span><span class="NAME">a01</span><span class="PUNC">*</span><span class="NAME">a22</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a01</span><span class="PUNC">*</span><span class="NAME">a12</span><span class="PUNC">-</span><span class="NAME">a02</span><span class="PUNC">*</span><span class="NAME">a11</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a12</span><span class="PUNC">*</span><span class="NAME">a20</span><span class="PUNC">-</span><span class="NAME">a10</span><span class="PUNC">*</span><span class="NAME">a22</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">4</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a00</span><span class="PUNC">*</span><span class="NAME">a22</span><span class="PUNC">-</span><span class="NAME">a02</span><span class="PUNC">*</span><span class="NAME">a20</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">5</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a02</span><span class="PUNC">*</span><span class="NAME">a10</span><span class="PUNC">-</span><span class="NAME">a00</span><span class="PUNC">*</span><span class="NAME">a12</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">6</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a10</span><span class="PUNC">*</span><span class="NAME">a21</span><span class="PUNC">-</span><span class="NAME">a11</span><span class="PUNC">*</span><span class="NAME">a20</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">7</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a01</span><span class="PUNC">*</span><span class="NAME">a20</span><span class="PUNC">-</span><span class="NAME">a00</span><span class="PUNC">*</span><span class="NAME">a21</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">8</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a00</span><span class="PUNC">*</span><span class="NAME">a11</span><span class="PUNC">-</span><span class="NAME">a01</span><span class="PUNC">*</span><span class="NAME">a10</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">out</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">mat3.determinant</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">a00</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">a01</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">a02</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">a10</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">a11</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">4</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">a12</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">5</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">a20</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">6</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">a21</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">7</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">a22</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">8</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">a00</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NAME">a22</span><span class="PUNC">*</span><span class="NAME">a11</span><span class="PUNC">-</span><span class="NAME">a12</span><span class="PUNC">*</span><span class="NAME">a21</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="NAME">a01</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="PUNC">-</span><span class="NAME">a22</span><span class="PUNC">*</span><span class="NAME">a10</span><span class="PUNC">+</span><span class="NAME">a12</span><span class="PUNC">*</span><span class="NAME">a20</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="NAME">a02</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NAME">a21</span><span class="PUNC">*</span><span class="NAME">a10</span><span class="PUNC">-</span><span class="NAME">a11</span><span class="PUNC">*</span><span class="NAME">a20</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">mat3.mul</span><span class="PUNC">=</span><span class="NAME">mat3.multiply</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">out</span><span class="PUNC">,</span><span class="NAME">a</span><span class="PUNC">,</span><span class="NAME">b</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">a00</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">a01</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">a02</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">a10</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">a11</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">4</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">a12</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">5</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">a20</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">6</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">a21</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">7</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">a22</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">8</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">b00</span><span class="PUNC">=</span><span class="NAME">b</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">b01</span><span class="PUNC">=</span><span class="NAME">b</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">b02</span><span class="PUNC">=</span><span class="NAME">b</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">b10</span><span class="PUNC">=</span><span class="NAME">b</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">b11</span><span class="PUNC">=</span><span class="NAME">b</span><span class="PUNC">[</span><span class="NUMB">4</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">b12</span><span class="PUNC">=</span><span class="NAME">b</span><span class="PUNC">[</span><span class="NUMB">5</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">b20</span><span class="PUNC">=</span><span class="NAME">b</span><span class="PUNC">[</span><span class="NUMB">6</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">b21</span><span class="PUNC">=</span><span class="NAME">b</span><span class="PUNC">[</span><span class="NUMB">7</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">b22</span><span class="PUNC">=</span><span class="NAME">b</span><span class="PUNC">[</span><span class="NUMB">8</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">b00</span><span class="PUNC">*</span><span class="NAME">a00</span><span class="PUNC">+</span><span class="NAME">b01</span><span class="PUNC">*</span><span class="NAME">a10</span><span class="PUNC">+</span><span class="NAME">b02</span><span class="PUNC">*</span><span class="NAME">a20</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">b00</span><span class="PUNC">*</span><span class="NAME">a01</span><span class="PUNC">+</span><span class="NAME">b01</span><span class="PUNC">*</span><span class="NAME">a11</span><span class="PUNC">+</span><span class="NAME">b02</span><span class="PUNC">*</span><span class="NAME">a21</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">b00</span><span class="PUNC">*</span><span class="NAME">a02</span><span class="PUNC">+</span><span class="NAME">b01</span><span class="PUNC">*</span><span class="NAME">a12</span><span class="PUNC">+</span><span class="NAME">b02</span><span class="PUNC">*</span><span class="NAME">a22</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">b10</span><span class="PUNC">*</span><span class="NAME">a00</span><span class="PUNC">+</span><span class="NAME">b11</span><span class="PUNC">*</span><span class="NAME">a10</span><span class="PUNC">+</span><span class="NAME">b12</span><span class="PUNC">*</span><span class="NAME">a20</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">4</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">b10</span><span class="PUNC">*</span><span class="NAME">a01</span><span class="PUNC">+</span><span class="NAME">b11</span><span class="PUNC">*</span><span class="NAME">a11</span><span class="PUNC">+</span><span class="NAME">b12</span><span class="PUNC">*</span><span class="NAME">a21</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">5</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">b10</span><span class="PUNC">*</span><span class="NAME">a02</span><span class="PUNC">+</span><span class="NAME">b11</span><span class="PUNC">*</span><span class="NAME">a12</span><span class="PUNC">+</span><span class="NAME">b12</span><span class="PUNC">*</span><span class="NAME">a22</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">6</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">b20</span><span class="PUNC">*</span><span class="NAME">a00</span><span class="PUNC">+</span><span class="NAME">b21</span><span class="PUNC">*</span><span class="NAME">a10</span><span class="PUNC">+</span><span class="NAME">b22</span><span class="PUNC">*</span><span class="NAME">a20</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">7</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">b20</span><span class="PUNC">*</span><span class="NAME">a01</span><span class="PUNC">+</span><span class="NAME">b21</span><span class="PUNC">*</span><span class="NAME">a11</span><span class="PUNC">+</span><span class="NAME">b22</span><span class="PUNC">*</span><span class="NAME">a21</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">8</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">b20</span><span class="PUNC">*</span><span class="NAME">a02</span><span class="PUNC">+</span><span class="NAME">b21</span><span class="PUNC">*</span><span class="NAME">a12</span><span class="PUNC">+</span><span class="NAME">b22</span><span class="PUNC">*</span><span class="NAME">a22</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">out</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">mat3.str</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="STRN">"mat3("</span><span class="PUNC">+</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">+</span><span class="STRN">", "</span><span class="PUNC">+</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">+</span><span class="STRN">", "</span><span class="PUNC">+</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">+</span><span class="STRN">", "</span><span class="PUNC">+</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">+</span><span class="STRN">", "</span><span class="PUNC">+</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">4</span><span class="PUNC">]</span><span class="PUNC">+</span><span class="STRN">", "</span><span class="PUNC">+</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">5</span><span class="PUNC">]</span><span class="PUNC">+</span><span class="STRN">", "</span><span class="PUNC">+</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">6</span><span class="PUNC">]</span><span class="PUNC">+</span><span class="STRN">", "</span><span class="PUNC">+</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">7</span><span class="PUNC">]</span><span class="PUNC">+</span><span class="STRN">", "</span><span class="PUNC">+</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">8</span><span class="PUNC">]</span><span class="PUNC">+</span><span class="STRN">")"</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">exports</span><span class="PUNC">!==</span><span class="STRN">"undefined"</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">exports.mat3</span><span class="PUNC">=</span><span class="NAME">mat3</span><span class="PUNC">}</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">mat4</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">mat4Identity</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Float32Array</span><span class="PUNC">(</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">GLMAT_EPSILON</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">GLMAT_EPSILON</span><span class="PUNC">=</span><span class="NUMB">1</span><span class="NAME">e</span><span class="PUNC">-</span><span class="NUMB">6</span><span class="PUNC">}</span><span class="NAME">mat4.create</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Float32Array</span><span class="PUNC">(</span><span class="NAME">mat4Identity</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">mat4.clone</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">out</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Float32Array</span><span class="PUNC">(</span><span class="NUMB">16</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">4</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">4</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">5</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">5</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">6</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">6</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">7</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">7</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">8</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">8</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">9</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">9</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">10</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">10</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">11</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">11</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">12</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">12</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">13</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">13</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">14</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">14</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">15</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">15</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">out</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">mat4.copy</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">out</span><span class="PUNC">,</span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">4</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">4</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">5</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">5</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">6</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">6</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">7</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">7</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">8</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">8</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">9</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">9</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">10</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">10</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">11</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">11</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">12</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">12</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">13</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">13</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">14</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">14</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">15</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">15</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">out</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">mat4.identity</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">out</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">4</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">5</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">6</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">7</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">8</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">9</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">10</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">11</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">12</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">13</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">14</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">15</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">out</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">mat4.transpose</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">out</span><span class="PUNC">,</span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">out</span><span class="PUNC">===</span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">a01</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">a02</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">a03</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">a12</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">6</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">a13</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">7</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">a23</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">11</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">4</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">8</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">12</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">4</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a01</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">6</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">9</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">7</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">13</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">8</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a02</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">9</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a12</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">11</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">14</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">12</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a03</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">13</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a13</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">14</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a23</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">4</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">8</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">12</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">4</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">5</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">5</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">6</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">9</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">7</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">13</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">8</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">9</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">6</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">10</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">10</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">11</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">14</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">12</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">13</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">7</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">14</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">11</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">15</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">15</span><span class="PUNC">]</span><span class="PUNC">}</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">out</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">mat4.invert</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">out</span><span class="PUNC">,</span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">a00</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">a01</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">a02</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">a03</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">a10</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">4</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">a11</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">5</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">a12</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">6</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">a13</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">7</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">a20</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">8</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">a21</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">9</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">a22</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">10</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">a23</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">11</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">a30</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">12</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">a31</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">13</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">a32</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">14</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">a33</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">15</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">b00</span><span class="PUNC">=</span><span class="NAME">a00</span><span class="PUNC">*</span><span class="NAME">a11</span><span class="PUNC">-</span><span class="NAME">a01</span><span class="PUNC">*</span><span class="NAME">a10</span><span class="PUNC">,</span><span class="NAME">b01</span><span class="PUNC">=</span><span class="NAME">a00</span><span class="PUNC">*</span><span class="NAME">a12</span><span class="PUNC">-</span><span class="NAME">a02</span><span class="PUNC">*</span><span class="NAME">a10</span><span class="PUNC">,</span><span class="NAME">b02</span><span class="PUNC">=</span><span class="NAME">a00</span><span class="PUNC">*</span><span class="NAME">a13</span><span class="PUNC">-</span><span class="NAME">a03</span><span class="PUNC">*</span><span class="NAME">a10</span><span class="PUNC">,</span><span class="NAME">b03</span><span class="PUNC">=</span><span class="NAME">a01</span><span class="PUNC">*</span><span class="NAME">a12</span><span class="PUNC">-</span><span class="NAME">a02</span><span class="PUNC">*</span><span class="NAME">a11</span><span class="PUNC">,</span><span class="NAME">b04</span><span class="PUNC">=</span><span class="NAME">a01</span><span class="PUNC">*</span><span class="NAME">a13</span><span class="PUNC">-</span><span class="NAME">a03</span><span class="PUNC">*</span><span class="NAME">a11</span><span class="PUNC">,</span><span class="NAME">b05</span><span class="PUNC">=</span><span class="NAME">a02</span><span class="PUNC">*</span><span class="NAME">a13</span><span class="PUNC">-</span><span class="NAME">a03</span><span class="PUNC">*</span><span class="NAME">a12</span><span class="PUNC">,</span><span class="NAME">b06</span><span class="PUNC">=</span><span class="NAME">a20</span><span class="PUNC">*</span><span class="NAME">a31</span><span class="PUNC">-</span><span class="NAME">a21</span><span class="PUNC">*</span><span class="NAME">a30</span><span class="PUNC">,</span><span class="NAME">b07</span><span class="PUNC">=</span><span class="NAME">a20</span><span class="PUNC">*</span><span class="NAME">a32</span><span class="PUNC">-</span><span class="NAME">a22</span><span class="PUNC">*</span><span class="NAME">a30</span><span class="PUNC">,</span><span class="NAME">b08</span><span class="PUNC">=</span><span class="NAME">a20</span><span class="PUNC">*</span><span class="NAME">a33</span><span class="PUNC">-</span><span class="NAME">a23</span><span class="PUNC">*</span><span class="NAME">a30</span><span class="PUNC">,</span><span class="NAME">b09</span><span class="PUNC">=</span><span class="NAME">a21</span><span class="PUNC">*</span><span class="NAME">a32</span><span class="PUNC">-</span><span class="NAME">a22</span><span class="PUNC">*</span><span class="NAME">a31</span><span class="PUNC">,</span><span class="NAME">b10</span><span class="PUNC">=</span><span class="NAME">a21</span><span class="PUNC">*</span><span class="NAME">a33</span><span class="PUNC">-</span><span class="NAME">a23</span><span class="PUNC">*</span><span class="NAME">a31</span><span class="PUNC">,</span><span class="NAME">b11</span><span class="PUNC">=</span><span class="NAME">a22</span><span class="PUNC">*</span><span class="NAME">a33</span><span class="PUNC">-</span><span class="NAME">a23</span><span class="PUNC">*</span><span class="NAME">a32</span><span class="PUNC">,</span><span class="NAME">det</span><span class="PUNC">=</span><span class="NAME">b00</span><span class="PUNC">*</span><span class="NAME">b11</span><span class="PUNC">-</span><span class="NAME">b01</span><span class="PUNC">*</span><span class="NAME">b10</span><span class="PUNC">+</span><span class="NAME">b02</span><span class="PUNC">*</span><span class="NAME">b09</span><span class="PUNC">+</span><span class="NAME">b03</span><span class="PUNC">*</span><span class="NAME">b08</span><span class="PUNC">-</span><span class="NAME">b04</span><span class="PUNC">*</span><span class="NAME">b07</span><span class="PUNC">+</span><span class="NAME">b05</span><span class="PUNC">*</span><span class="NAME">b06</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">det</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">}</span><span class="NAME">det</span><span class="PUNC">=</span><span class="NUMB">1</span><span class="PUNC">/</span><span class="NAME">det</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">a11</span><span class="PUNC">*</span><span class="NAME">b11</span><span class="PUNC">-</span><span class="NAME">a12</span><span class="PUNC">*</span><span class="NAME">b10</span><span class="PUNC">+</span><span class="NAME">a13</span><span class="PUNC">*</span><span class="NAME">b09</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="NAME">det</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">a02</span><span class="PUNC">*</span><span class="NAME">b10</span><span class="PUNC">-</span><span class="NAME">a01</span><span class="PUNC">*</span><span class="NAME">b11</span><span class="PUNC">-</span><span class="NAME">a03</span><span class="PUNC">*</span><span class="NAME">b09</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="NAME">det</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">a31</span><span class="PUNC">*</span><span class="NAME">b05</span><span class="PUNC">-</span><span class="NAME">a32</span><span class="PUNC">*</span><span class="NAME">b04</span><span class="PUNC">+</span><span class="NAME">a33</span><span class="PUNC">*</span><span class="NAME">b03</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="NAME">det</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">a22</span><span class="PUNC">*</span><span class="NAME">b04</span><span class="PUNC">-</span><span class="NAME">a21</span><span class="PUNC">*</span><span class="NAME">b05</span><span class="PUNC">-</span><span class="NAME">a23</span><span class="PUNC">*</span><span class="NAME">b03</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="NAME">det</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">4</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">a12</span><span class="PUNC">*</span><span class="NAME">b08</span><span class="PUNC">-</span><span class="NAME">a10</span><span class="PUNC">*</span><span class="NAME">b11</span><span class="PUNC">-</span><span class="NAME">a13</span><span class="PUNC">*</span><span class="NAME">b07</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="NAME">det</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">5</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">a00</span><span class="PUNC">*</span><span class="NAME">b11</span><span class="PUNC">-</span><span class="NAME">a02</span><span class="PUNC">*</span><span class="NAME">b08</span><span class="PUNC">+</span><span class="NAME">a03</span><span class="PUNC">*</span><span class="NAME">b07</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="NAME">det</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">6</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">a32</span><span class="PUNC">*</span><span class="NAME">b02</span><span class="PUNC">-</span><span class="NAME">a30</span><span class="PUNC">*</span><span class="NAME">b05</span><span class="PUNC">-</span><span class="NAME">a33</span><span class="PUNC">*</span><span class="NAME">b01</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="NAME">det</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">7</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">a20</span><span class="PUNC">*</span><span class="NAME">b05</span><span class="PUNC">-</span><span class="NAME">a22</span><span class="PUNC">*</span><span class="NAME">b02</span><span class="PUNC">+</span><span class="NAME">a23</span><span class="PUNC">*</span><span class="NAME">b01</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="NAME">det</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">8</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">a10</span><span class="PUNC">*</span><span class="NAME">b10</span><span class="PUNC">-</span><span class="NAME">a11</span><span class="PUNC">*</span><span class="NAME">b08</span><span class="PUNC">+</span><span class="NAME">a13</span><span class="PUNC">*</span><span class="NAME">b06</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="NAME">det</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">9</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">a01</span><span class="PUNC">*</span><span class="NAME">b08</span><span class="PUNC">-</span><span class="NAME">a00</span><span class="PUNC">*</span><span class="NAME">b10</span><span class="PUNC">-</span><span class="NAME">a03</span><span class="PUNC">*</span><span class="NAME">b06</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="NAME">det</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">10</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">a30</span><span class="PUNC">*</span><span class="NAME">b04</span><span class="PUNC">-</span><span class="NAME">a31</span><span class="PUNC">*</span><span class="NAME">b02</span><span class="PUNC">+</span><span class="NAME">a33</span><span class="PUNC">*</span><span class="NAME">b00</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="NAME">det</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">11</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">a21</span><span class="PUNC">*</span><span class="NAME">b02</span><span class="PUNC">-</span><span class="NAME">a20</span><span class="PUNC">*</span><span class="NAME">b04</span><span class="PUNC">-</span><span class="NAME">a23</span><span class="PUNC">*</span><span class="NAME">b00</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="NAME">det</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">12</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">a11</span><span class="PUNC">*</span><span class="NAME">b07</span><span class="PUNC">-</span><span class="NAME">a10</span><span class="PUNC">*</span><span class="NAME">b09</span><span class="PUNC">-</span><span class="NAME">a12</span><span class="PUNC">*</span><span class="NAME">b06</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="NAME">det</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">13</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">a00</span><span class="PUNC">*</span><span class="NAME">b09</span><span class="PUNC">-</span><span class="NAME">a01</span><span class="PUNC">*</span><span class="NAME">b07</span><span class="PUNC">+</span><span class="NAME">a02</span><span class="PUNC">*</span><span class="NAME">b06</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="NAME">det</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">14</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">a31</span><span class="PUNC">*</span><span class="NAME">b01</span><span class="PUNC">-</span><span class="NAME">a30</span><span class="PUNC">*</span><span class="NAME">b03</span><span class="PUNC">-</span><span class="NAME">a32</span><span class="PUNC">*</span><span class="NAME">b00</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="NAME">det</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">15</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">a20</span><span class="PUNC">*</span><span class="NAME">b03</span><span class="PUNC">-</span><span class="NAME">a21</span><span class="PUNC">*</span><span class="NAME">b01</span><span class="PUNC">+</span><span class="NAME">a22</span><span class="PUNC">*</span><span class="NAME">b00</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="NAME">det</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">out</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">mat4.adjoint</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">out</span><span class="PUNC">,</span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">a00</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">a01</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">a02</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">a03</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">a10</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">4</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">a11</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">5</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">a12</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">6</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">a13</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">7</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">a20</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">8</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">a21</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">9</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">a22</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">10</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">a23</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">11</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">a30</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">12</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">a31</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">13</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">a32</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">14</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">a33</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">15</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a11</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NAME">a22</span><span class="PUNC">*</span><span class="NAME">a33</span><span class="PUNC">-</span><span class="NAME">a23</span><span class="PUNC">*</span><span class="NAME">a32</span><span class="PUNC">)</span><span class="PUNC">-</span><span class="NAME">a21</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NAME">a12</span><span class="PUNC">*</span><span class="NAME">a33</span><span class="PUNC">-</span><span class="NAME">a13</span><span class="PUNC">*</span><span class="NAME">a32</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="NAME">a31</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NAME">a12</span><span class="PUNC">*</span><span class="NAME">a23</span><span class="PUNC">-</span><span class="NAME">a13</span><span class="PUNC">*</span><span class="NAME">a22</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="PUNC">-</span><span class="PUNC">(</span><span class="NAME">a01</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NAME">a22</span><span class="PUNC">*</span><span class="NAME">a33</span><span class="PUNC">-</span><span class="NAME">a23</span><span class="PUNC">*</span><span class="NAME">a32</span><span class="PUNC">)</span><span class="PUNC">-</span><span class="NAME">a21</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NAME">a02</span><span class="PUNC">*</span><span class="NAME">a33</span><span class="PUNC">-</span><span class="NAME">a03</span><span class="PUNC">*</span><span class="NAME">a32</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="NAME">a31</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NAME">a02</span><span class="PUNC">*</span><span class="NAME">a23</span><span class="PUNC">-</span><span class="NAME">a03</span><span class="PUNC">*</span><span class="NAME">a22</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a01</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NAME">a12</span><span class="PUNC">*</span><span class="NAME">a33</span><span class="PUNC">-</span><span class="NAME">a13</span><span class="PUNC">*</span><span class="NAME">a32</span><span class="PUNC">)</span><span class="PUNC">-</span><span class="NAME">a11</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NAME">a02</span><span class="PUNC">*</span><span class="NAME">a33</span><span class="PUNC">-</span><span class="NAME">a03</span><span class="PUNC">*</span><span class="NAME">a32</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="NAME">a31</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NAME">a02</span><span class="PUNC">*</span><span class="NAME">a13</span><span class="PUNC">-</span><span class="NAME">a03</span><span class="PUNC">*</span><span class="NAME">a12</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="PUNC">-</span><span class="PUNC">(</span><span class="NAME">a01</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NAME">a12</span><span class="PUNC">*</span><span class="NAME">a23</span><span class="PUNC">-</span><span class="NAME">a13</span><span class="PUNC">*</span><span class="NAME">a22</span><span class="PUNC">)</span><span class="PUNC">-</span><span class="NAME">a11</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NAME">a02</span><span class="PUNC">*</span><span class="NAME">a23</span><span class="PUNC">-</span><span class="NAME">a03</span><span class="PUNC">*</span><span class="NAME">a22</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="NAME">a21</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NAME">a02</span><span class="PUNC">*</span><span class="NAME">a13</span><span class="PUNC">-</span><span class="NAME">a03</span><span class="PUNC">*</span><span class="NAME">a12</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">4</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="PUNC">-</span><span class="PUNC">(</span><span class="NAME">a10</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NAME">a22</span><span class="PUNC">*</span><span class="NAME">a33</span><span class="PUNC">-</span><span class="NAME">a23</span><span class="PUNC">*</span><span class="NAME">a32</span><span class="PUNC">)</span><span class="PUNC">-</span><span class="NAME">a20</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NAME">a12</span><span class="PUNC">*</span><span class="NAME">a33</span><span class="PUNC">-</span><span class="NAME">a13</span><span class="PUNC">*</span><span class="NAME">a32</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="NAME">a30</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NAME">a12</span><span class="PUNC">*</span><span class="NAME">a23</span><span class="PUNC">-</span><span class="NAME">a13</span><span class="PUNC">*</span><span class="NAME">a22</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">5</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a00</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NAME">a22</span><span class="PUNC">*</span><span class="NAME">a33</span><span class="PUNC">-</span><span class="NAME">a23</span><span class="PUNC">*</span><span class="NAME">a32</span><span class="PUNC">)</span><span class="PUNC">-</span><span class="NAME">a20</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NAME">a02</span><span class="PUNC">*</span><span class="NAME">a33</span><span class="PUNC">-</span><span class="NAME">a03</span><span class="PUNC">*</span><span class="NAME">a32</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="NAME">a30</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NAME">a02</span><span class="PUNC">*</span><span class="NAME">a23</span><span class="PUNC">-</span><span class="NAME">a03</span><span class="PUNC">*</span><span class="NAME">a22</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">6</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="PUNC">-</span><span class="PUNC">(</span><span class="NAME">a00</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NAME">a12</span><span class="PUNC">*</span><span class="NAME">a33</span><span class="PUNC">-</span><span class="NAME">a13</span><span class="PUNC">*</span><span class="NAME">a32</span><span class="PUNC">)</span><span class="PUNC">-</span><span class="NAME">a10</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NAME">a02</span><span class="PUNC">*</span><span class="NAME">a33</span><span class="PUNC">-</span><span class="NAME">a03</span><span class="PUNC">*</span><span class="NAME">a32</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="NAME">a30</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NAME">a02</span><span class="PUNC">*</span><span class="NAME">a13</span><span class="PUNC">-</span><span class="NAME">a03</span><span class="PUNC">*</span><span class="NAME">a12</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">7</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a00</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NAME">a12</span><span class="PUNC">*</span><span class="NAME">a23</span><span class="PUNC">-</span><span class="NAME">a13</span><span class="PUNC">*</span><span class="NAME">a22</span><span class="PUNC">)</span><span class="PUNC">-</span><span class="NAME">a10</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NAME">a02</span><span class="PUNC">*</span><span class="NAME">a23</span><span class="PUNC">-</span><span class="NAME">a03</span><span class="PUNC">*</span><span class="NAME">a22</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="NAME">a20</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NAME">a02</span><span class="PUNC">*</span><span class="NAME">a13</span><span class="PUNC">-</span><span class="NAME">a03</span><span class="PUNC">*</span><span class="NAME">a12</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">8</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a10</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NAME">a21</span><span class="PUNC">*</span><span class="NAME">a33</span><span class="PUNC">-</span><span class="NAME">a23</span><span class="PUNC">*</span><span class="NAME">a31</span><span class="PUNC">)</span><span class="PUNC">-</span><span class="NAME">a20</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NAME">a11</span><span class="PUNC">*</span><span class="NAME">a33</span><span class="PUNC">-</span><span class="NAME">a13</span><span class="PUNC">*</span><span class="NAME">a31</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="NAME">a30</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NAME">a11</span><span class="PUNC">*</span><span class="NAME">a23</span><span class="PUNC">-</span><span class="NAME">a13</span><span class="PUNC">*</span><span class="NAME">a21</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">9</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="PUNC">-</span><span class="PUNC">(</span><span class="NAME">a00</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NAME">a21</span><span class="PUNC">*</span><span class="NAME">a33</span><span class="PUNC">-</span><span class="NAME">a23</span><span class="PUNC">*</span><span class="NAME">a31</span><span class="PUNC">)</span><span class="PUNC">-</span><span class="NAME">a20</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NAME">a01</span><span class="PUNC">*</span><span class="NAME">a33</span><span class="PUNC">-</span><span class="NAME">a03</span><span class="PUNC">*</span><span class="NAME">a31</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="NAME">a30</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NAME">a01</span><span class="PUNC">*</span><span class="NAME">a23</span><span class="PUNC">-</span><span class="NAME">a03</span><span class="PUNC">*</span><span class="NAME">a21</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">10</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a00</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NAME">a11</span><span class="PUNC">*</span><span class="NAME">a33</span><span class="PUNC">-</span><span class="NAME">a13</span><span class="PUNC">*</span><span class="NAME">a31</span><span class="PUNC">)</span><span class="PUNC">-</span><span class="NAME">a10</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NAME">a01</span><span class="PUNC">*</span><span class="NAME">a33</span><span class="PUNC">-</span><span class="NAME">a03</span><span class="PUNC">*</span><span class="NAME">a31</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="NAME">a30</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NAME">a01</span><span class="PUNC">*</span><span class="NAME">a13</span><span class="PUNC">-</span><span class="NAME">a03</span><span class="PUNC">*</span><span class="NAME">a11</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">11</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="PUNC">-</span><span class="PUNC">(</span><span class="NAME">a00</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NAME">a11</span><span class="PUNC">*</span><span class="NAME">a23</span><span class="PUNC">-</span><span class="NAME">a13</span><span class="PUNC">*</span><span class="NAME">a21</span><span class="PUNC">)</span><span class="PUNC">-</span><span class="NAME">a10</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NAME">a01</span><span class="PUNC">*</span><span class="NAME">a23</span><span class="PUNC">-</span><span class="NAME">a03</span><span class="PUNC">*</span><span class="NAME">a21</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="NAME">a20</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NAME">a01</span><span class="PUNC">*</span><span class="NAME">a13</span><span class="PUNC">-</span><span class="NAME">a03</span><span class="PUNC">*</span><span class="NAME">a11</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">12</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="PUNC">-</span><span class="PUNC">(</span><span class="NAME">a10</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NAME">a21</span><span class="PUNC">*</span><span class="NAME">a32</span><span class="PUNC">-</span><span class="NAME">a22</span><span class="PUNC">*</span><span class="NAME">a31</span><span class="PUNC">)</span><span class="PUNC">-</span><span class="NAME">a20</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NAME">a11</span><span class="PUNC">*</span><span class="NAME">a32</span><span class="PUNC">-</span><span class="NAME">a12</span><span class="PUNC">*</span><span class="NAME">a31</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="NAME">a30</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NAME">a11</span><span class="PUNC">*</span><span class="NAME">a22</span><span class="PUNC">-</span><span class="NAME">a12</span><span class="PUNC">*</span><span class="NAME">a21</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">13</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a00</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NAME">a21</span><span class="PUNC">*</span><span class="NAME">a32</span><span class="PUNC">-</span><span class="NAME">a22</span><span class="PUNC">*</span><span class="NAME">a31</span><span class="PUNC">)</span><span class="PUNC">-</span><span class="NAME">a20</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NAME">a01</span><span class="PUNC">*</span><span class="NAME">a32</span><span class="PUNC">-</span><span class="NAME">a02</span><span class="PUNC">*</span><span class="NAME">a31</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="NAME">a30</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NAME">a01</span><span class="PUNC">*</span><span class="NAME">a22</span><span class="PUNC">-</span><span class="NAME">a02</span><span class="PUNC">*</span><span class="NAME">a21</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">14</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="PUNC">-</span><span class="PUNC">(</span><span class="NAME">a00</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NAME">a11</span><span class="PUNC">*</span><span class="NAME">a32</span><span class="PUNC">-</span><span class="NAME">a12</span><span class="PUNC">*</span><span class="NAME">a31</span><span class="PUNC">)</span><span class="PUNC">-</span><span class="NAME">a10</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NAME">a01</span><span class="PUNC">*</span><span class="NAME">a32</span><span class="PUNC">-</span><span class="NAME">a02</span><span class="PUNC">*</span><span class="NAME">a31</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="NAME">a30</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NAME">a01</span><span class="PUNC">*</span><span class="NAME">a12</span><span class="PUNC">-</span><span class="NAME">a02</span><span class="PUNC">*</span><span class="NAME">a11</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">15</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a00</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NAME">a11</span><span class="PUNC">*</span><span class="NAME">a22</span><span class="PUNC">-</span><span class="NAME">a12</span><span class="PUNC">*</span><span class="NAME">a21</span><span class="PUNC">)</span><span class="PUNC">-</span><span class="NAME">a10</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NAME">a01</span><span class="PUNC">*</span><span class="NAME">a22</span><span class="PUNC">-</span><span class="NAME">a02</span><span class="PUNC">*</span><span class="NAME">a21</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="NAME">a20</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NAME">a01</span><span class="PUNC">*</span><span class="NAME">a12</span><span class="PUNC">-</span><span class="NAME">a02</span><span class="PUNC">*</span><span class="NAME">a11</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">out</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">mat4.determinant</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">a00</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">a01</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">a02</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">a03</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">a10</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">4</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">a11</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">5</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">a12</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">6</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">a13</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">7</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">a20</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">8</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">a21</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">9</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">a22</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">10</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">a23</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">11</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">a30</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">12</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">a31</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">13</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">a32</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">14</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">a33</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">15</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">b00</span><span class="PUNC">=</span><span class="NAME">a00</span><span class="PUNC">*</span><span class="NAME">a11</span><span class="PUNC">-</span><span class="NAME">a01</span><span class="PUNC">*</span><span class="NAME">a10</span><span class="PUNC">,</span><span class="NAME">b01</span><span class="PUNC">=</span><span class="NAME">a00</span><span class="PUNC">*</span><span class="NAME">a12</span><span class="PUNC">-</span><span class="NAME">a02</span><span class="PUNC">*</span><span class="NAME">a10</span><span class="PUNC">,</span><span class="NAME">b02</span><span class="PUNC">=</span><span class="NAME">a00</span><span class="PUNC">*</span><span class="NAME">a13</span><span class="PUNC">-</span><span class="NAME">a03</span><span class="PUNC">*</span><span class="NAME">a10</span><span class="PUNC">,</span><span class="NAME">b03</span><span class="PUNC">=</span><span class="NAME">a01</span><span class="PUNC">*</span><span class="NAME">a12</span><span class="PUNC">-</span><span class="NAME">a02</span><span class="PUNC">*</span><span class="NAME">a11</span><span class="PUNC">,</span><span class="NAME">b04</span><span class="PUNC">=</span><span class="NAME">a01</span><span class="PUNC">*</span><span class="NAME">a13</span><span class="PUNC">-</span><span class="NAME">a03</span><span class="PUNC">*</span><span class="NAME">a11</span><span class="PUNC">,</span><span class="NAME">b05</span><span class="PUNC">=</span><span class="NAME">a02</span><span class="PUNC">*</span><span class="NAME">a13</span><span class="PUNC">-</span><span class="NAME">a03</span><span class="PUNC">*</span><span class="NAME">a12</span><span class="PUNC">,</span><span class="NAME">b06</span><span class="PUNC">=</span><span class="NAME">a20</span><span class="PUNC">*</span><span class="NAME">a31</span><span class="PUNC">-</span><span class="NAME">a21</span><span class="PUNC">*</span><span class="NAME">a30</span><span class="PUNC">,</span><span class="NAME">b07</span><span class="PUNC">=</span><span class="NAME">a20</span><span class="PUNC">*</span><span class="NAME">a32</span><span class="PUNC">-</span><span class="NAME">a22</span><span class="PUNC">*</span><span class="NAME">a30</span><span class="PUNC">,</span><span class="NAME">b08</span><span class="PUNC">=</span><span class="NAME">a20</span><span class="PUNC">*</span><span class="NAME">a33</span><span class="PUNC">-</span><span class="NAME">a23</span><span class="PUNC">*</span><span class="NAME">a30</span><span class="PUNC">,</span><span class="NAME">b09</span><span class="PUNC">=</span><span class="NAME">a21</span><span class="PUNC">*</span><span class="NAME">a32</span><span class="PUNC">-</span><span class="NAME">a22</span><span class="PUNC">*</span><span class="NAME">a31</span><span class="PUNC">,</span><span class="NAME">b10</span><span class="PUNC">=</span><span class="NAME">a21</span><span class="PUNC">*</span><span class="NAME">a33</span><span class="PUNC">-</span><span class="NAME">a23</span><span class="PUNC">*</span><span class="NAME">a31</span><span class="PUNC">,</span><span class="NAME">b11</span><span class="PUNC">=</span><span class="NAME">a22</span><span class="PUNC">*</span><span class="NAME">a33</span><span class="PUNC">-</span><span class="NAME">a23</span><span class="PUNC">*</span><span class="NAME">a32</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">b00</span><span class="PUNC">*</span><span class="NAME">b11</span><span class="PUNC">-</span><span class="NAME">b01</span><span class="PUNC">*</span><span class="NAME">b10</span><span class="PUNC">+</span><span class="NAME">b02</span><span class="PUNC">*</span><span class="NAME">b09</span><span class="PUNC">+</span><span class="NAME">b03</span><span class="PUNC">*</span><span class="NAME">b08</span><span class="PUNC">-</span><span class="NAME">b04</span><span class="PUNC">*</span><span class="NAME">b07</span><span class="PUNC">+</span><span class="NAME">b05</span><span class="PUNC">*</span><span class="NAME">b06</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">mat4.mul</span><span class="PUNC">=</span><span class="NAME">mat4.multiply</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">out</span><span class="PUNC">,</span><span class="NAME">a</span><span class="PUNC">,</span><span class="NAME">b</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">a00</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">a01</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">a02</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">a03</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">a10</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">4</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">a11</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">5</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">a12</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">6</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">a13</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">7</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">a20</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">8</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">a21</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">9</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">a22</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">10</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">a23</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">11</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">a30</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">12</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">a31</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">13</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">a32</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">14</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">a33</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">15</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">b0</span><span class="PUNC">=</span><span class="NAME">b</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">b1</span><span class="PUNC">=</span><span class="NAME">b</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">b2</span><span class="PUNC">=</span><span class="NAME">b</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">b3</span><span class="PUNC">=</span><span class="NAME">b</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">b0</span><span class="PUNC">*</span><span class="NAME">a00</span><span class="PUNC">+</span><span class="NAME">b1</span><span class="PUNC">*</span><span class="NAME">a10</span><span class="PUNC">+</span><span class="NAME">b2</span><span class="PUNC">*</span><span class="NAME">a20</span><span class="PUNC">+</span><span class="NAME">b3</span><span class="PUNC">*</span><span class="NAME">a30</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">b0</span><span class="PUNC">*</span><span class="NAME">a01</span><span class="PUNC">+</span><span class="NAME">b1</span><span class="PUNC">*</span><span class="NAME">a11</span><span class="PUNC">+</span><span class="NAME">b2</span><span class="PUNC">*</span><span class="NAME">a21</span><span class="PUNC">+</span><span class="NAME">b3</span><span class="PUNC">*</span><span class="NAME">a31</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">b0</span><span class="PUNC">*</span><span class="NAME">a02</span><span class="PUNC">+</span><span class="NAME">b1</span><span class="PUNC">*</span><span class="NAME">a12</span><span class="PUNC">+</span><span class="NAME">b2</span><span class="PUNC">*</span><span class="NAME">a22</span><span class="PUNC">+</span><span class="NAME">b3</span><span class="PUNC">*</span><span class="NAME">a32</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">b0</span><span class="PUNC">*</span><span class="NAME">a03</span><span class="PUNC">+</span><span class="NAME">b1</span><span class="PUNC">*</span><span class="NAME">a13</span><span class="PUNC">+</span><span class="NAME">b2</span><span class="PUNC">*</span><span class="NAME">a23</span><span class="PUNC">+</span><span class="NAME">b3</span><span class="PUNC">*</span><span class="NAME">a33</span><span class="PUNC">;</span><span class="NAME">b0</span><span class="PUNC">=</span><span class="NAME">b</span><span class="PUNC">[</span><span class="NUMB">4</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">b1</span><span class="PUNC">=</span><span class="NAME">b</span><span class="PUNC">[</span><span class="NUMB">5</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">b2</span><span class="PUNC">=</span><span class="NAME">b</span><span class="PUNC">[</span><span class="NUMB">6</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">b3</span><span class="PUNC">=</span><span class="NAME">b</span><span class="PUNC">[</span><span class="NUMB">7</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">4</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">b0</span><span class="PUNC">*</span><span class="NAME">a00</span><span class="PUNC">+</span><span class="NAME">b1</span><span class="PUNC">*</span><span class="NAME">a10</span><span class="PUNC">+</span><span class="NAME">b2</span><span class="PUNC">*</span><span class="NAME">a20</span><span class="PUNC">+</span><span class="NAME">b3</span><span class="PUNC">*</span><span class="NAME">a30</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">5</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">b0</span><span class="PUNC">*</span><span class="NAME">a01</span><span class="PUNC">+</span><span class="NAME">b1</span><span class="PUNC">*</span><span class="NAME">a11</span><span class="PUNC">+</span><span class="NAME">b2</span><span class="PUNC">*</span><span class="NAME">a21</span><span class="PUNC">+</span><span class="NAME">b3</span><span class="PUNC">*</span><span class="NAME">a31</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">6</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">b0</span><span class="PUNC">*</span><span class="NAME">a02</span><span class="PUNC">+</span><span class="NAME">b1</span><span class="PUNC">*</span><span class="NAME">a12</span><span class="PUNC">+</span><span class="NAME">b2</span><span class="PUNC">*</span><span class="NAME">a22</span><span class="PUNC">+</span><span class="NAME">b3</span><span class="PUNC">*</span><span class="NAME">a32</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">7</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">b0</span><span class="PUNC">*</span><span class="NAME">a03</span><span class="PUNC">+</span><span class="NAME">b1</span><span class="PUNC">*</span><span class="NAME">a13</span><span class="PUNC">+</span><span class="NAME">b2</span><span class="PUNC">*</span><span class="NAME">a23</span><span class="PUNC">+</span><span class="NAME">b3</span><span class="PUNC">*</span><span class="NAME">a33</span><span class="PUNC">;</span><span class="NAME">b0</span><span class="PUNC">=</span><span class="NAME">b</span><span class="PUNC">[</span><span class="NUMB">8</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">b1</span><span class="PUNC">=</span><span class="NAME">b</span><span class="PUNC">[</span><span class="NUMB">9</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">b2</span><span class="PUNC">=</span><span class="NAME">b</span><span class="PUNC">[</span><span class="NUMB">10</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">b3</span><span class="PUNC">=</span><span class="NAME">b</span><span class="PUNC">[</span><span class="NUMB">11</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">8</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">b0</span><span class="PUNC">*</span><span class="NAME">a00</span><span class="PUNC">+</span><span class="NAME">b1</span><span class="PUNC">*</span><span class="NAME">a10</span><span class="PUNC">+</span><span class="NAME">b2</span><span class="PUNC">*</span><span class="NAME">a20</span><span class="PUNC">+</span><span class="NAME">b3</span><span class="PUNC">*</span><span class="NAME">a30</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">9</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">b0</span><span class="PUNC">*</span><span class="NAME">a01</span><span class="PUNC">+</span><span class="NAME">b1</span><span class="PUNC">*</span><span class="NAME">a11</span><span class="PUNC">+</span><span class="NAME">b2</span><span class="PUNC">*</span><span class="NAME">a21</span><span class="PUNC">+</span><span class="NAME">b3</span><span class="PUNC">*</span><span class="NAME">a31</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">10</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">b0</span><span class="PUNC">*</span><span class="NAME">a02</span><span class="PUNC">+</span><span class="NAME">b1</span><span class="PUNC">*</span><span class="NAME">a12</span><span class="PUNC">+</span><span class="NAME">b2</span><span class="PUNC">*</span><span class="NAME">a22</span><span class="PUNC">+</span><span class="NAME">b3</span><span class="PUNC">*</span><span class="NAME">a32</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">11</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">b0</span><span class="PUNC">*</span><span class="NAME">a03</span><span class="PUNC">+</span><span class="NAME">b1</span><span class="PUNC">*</span><span class="NAME">a13</span><span class="PUNC">+</span><span class="NAME">b2</span><span class="PUNC">*</span><span class="NAME">a23</span><span class="PUNC">+</span><span class="NAME">b3</span><span class="PUNC">*</span><span class="NAME">a33</span><span class="PUNC">;</span><span class="NAME">b0</span><span class="PUNC">=</span><span class="NAME">b</span><span class="PUNC">[</span><span class="NUMB">12</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">b1</span><span class="PUNC">=</span><span class="NAME">b</span><span class="PUNC">[</span><span class="NUMB">13</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">b2</span><span class="PUNC">=</span><span class="NAME">b</span><span class="PUNC">[</span><span class="NUMB">14</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">b3</span><span class="PUNC">=</span><span class="NAME">b</span><span class="PUNC">[</span><span class="NUMB">15</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">12</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">b0</span><span class="PUNC">*</span><span class="NAME">a00</span><span class="PUNC">+</span><span class="NAME">b1</span><span class="PUNC">*</span><span class="NAME">a10</span><span class="PUNC">+</span><span class="NAME">b2</span><span class="PUNC">*</span><span class="NAME">a20</span><span class="PUNC">+</span><span class="NAME">b3</span><span class="PUNC">*</span><span class="NAME">a30</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">13</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">b0</span><span class="PUNC">*</span><span class="NAME">a01</span><span class="PUNC">+</span><span class="NAME">b1</span><span class="PUNC">*</span><span class="NAME">a11</span><span class="PUNC">+</span><span class="NAME">b2</span><span class="PUNC">*</span><span class="NAME">a21</span><span class="PUNC">+</span><span class="NAME">b3</span><span class="PUNC">*</span><span class="NAME">a31</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">14</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">b0</span><span class="PUNC">*</span><span class="NAME">a02</span><span class="PUNC">+</span><span class="NAME">b1</span><span class="PUNC">*</span><span class="NAME">a12</span><span class="PUNC">+</span><span class="NAME">b2</span><span class="PUNC">*</span><span class="NAME">a22</span><span class="PUNC">+</span><span class="NAME">b3</span><span class="PUNC">*</span><span class="NAME">a32</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">15</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">b0</span><span class="PUNC">*</span><span class="NAME">a03</span><span class="PUNC">+</span><span class="NAME">b1</span><span class="PUNC">*</span><span class="NAME">a13</span><span class="PUNC">+</span><span class="NAME">b2</span><span class="PUNC">*</span><span class="NAME">a23</span><span class="PUNC">+</span><span class="NAME">b3</span><span class="PUNC">*</span><span class="NAME">a33</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">out</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">mat4.translate</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">out</span><span class="PUNC">,</span><span class="NAME">a</span><span class="PUNC">,</span><span class="NAME">v</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">x</span><span class="PUNC">=</span><span class="NAME">v</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">y</span><span class="PUNC">=</span><span class="NAME">v</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">z</span><span class="PUNC">=</span><span class="NAME">v</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">a00</span><span class="PUNC">,</span><span class="NAME">a01</span><span class="PUNC">,</span><span class="NAME">a02</span><span class="PUNC">,</span><span class="NAME">a03</span><span class="PUNC">,</span><span class="NAME">a10</span><span class="PUNC">,</span><span class="NAME">a11</span><span class="PUNC">,</span><span class="NAME">a12</span><span class="PUNC">,</span><span class="NAME">a13</span><span class="PUNC">,</span><span class="NAME">a20</span><span class="PUNC">,</span><span class="NAME">a21</span><span class="PUNC">,</span><span class="NAME">a22</span><span class="PUNC">,</span><span class="NAME">a23</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">===</span><span class="NAME">out</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">12</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">*</span><span class="NAME">x</span><span class="PUNC">+</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">4</span><span class="PUNC">]</span><span class="PUNC">*</span><span class="NAME">y</span><span class="PUNC">+</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">8</span><span class="PUNC">]</span><span class="PUNC">*</span><span class="NAME">z</span><span class="PUNC">+</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">12</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">13</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">*</span><span class="NAME">x</span><span class="PUNC">+</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">5</span><span class="PUNC">]</span><span class="PUNC">*</span><span class="NAME">y</span><span class="PUNC">+</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">9</span><span class="PUNC">]</span><span class="PUNC">*</span><span class="NAME">z</span><span class="PUNC">+</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">13</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">14</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">*</span><span class="NAME">x</span><span class="PUNC">+</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">6</span><span class="PUNC">]</span><span class="PUNC">*</span><span class="NAME">y</span><span class="PUNC">+</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">10</span><span class="PUNC">]</span><span class="PUNC">*</span><span class="NAME">z</span><span class="PUNC">+</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">14</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">15</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">*</span><span class="NAME">x</span><span class="PUNC">+</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">7</span><span class="PUNC">]</span><span class="PUNC">*</span><span class="NAME">y</span><span class="PUNC">+</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">11</span><span class="PUNC">]</span><span class="PUNC">*</span><span class="NAME">z</span><span class="PUNC">+</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">15</span><span class="PUNC">]</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">a00</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">a01</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">a02</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">a03</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">a10</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">4</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">a11</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">5</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">a12</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">6</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">a13</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">7</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">a20</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">8</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">a21</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">9</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">a22</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">10</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">a23</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">11</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a00</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a01</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a02</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a03</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">4</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a10</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">5</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a11</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">6</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a12</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">7</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a13</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">8</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a20</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">9</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a21</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">10</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a22</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">11</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a23</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">12</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a00</span><span class="PUNC">*</span><span class="NAME">x</span><span class="PUNC">+</span><span class="NAME">a10</span><span class="PUNC">*</span><span class="NAME">y</span><span class="PUNC">+</span><span class="NAME">a20</span><span class="PUNC">*</span><span class="NAME">z</span><span class="PUNC">+</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">12</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">13</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a01</span><span class="PUNC">*</span><span class="NAME">x</span><span class="PUNC">+</span><span class="NAME">a11</span><span class="PUNC">*</span><span class="NAME">y</span><span class="PUNC">+</span><span class="NAME">a21</span><span class="PUNC">*</span><span class="NAME">z</span><span class="PUNC">+</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">13</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">14</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a02</span><span class="PUNC">*</span><span class="NAME">x</span><span class="PUNC">+</span><span class="NAME">a12</span><span class="PUNC">*</span><span class="NAME">y</span><span class="PUNC">+</span><span class="NAME">a22</span><span class="PUNC">*</span><span class="NAME">z</span><span class="PUNC">+</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">14</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">15</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a03</span><span class="PUNC">*</span><span class="NAME">x</span><span class="PUNC">+</span><span class="NAME">a13</span><span class="PUNC">*</span><span class="NAME">y</span><span class="PUNC">+</span><span class="NAME">a23</span><span class="PUNC">*</span><span class="NAME">z</span><span class="PUNC">+</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">15</span><span class="PUNC">]</span><span class="PUNC">}</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">out</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">mat4.scale</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">out</span><span class="PUNC">,</span><span class="NAME">a</span><span class="PUNC">,</span><span class="NAME">v</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">x</span><span class="PUNC">=</span><span class="NAME">v</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">y</span><span class="PUNC">=</span><span class="NAME">v</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">z</span><span class="PUNC">=</span><span class="NAME">v</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">*</span><span class="NAME">x</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">*</span><span class="NAME">x</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">*</span><span class="NAME">x</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">*</span><span class="NAME">x</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">4</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">4</span><span class="PUNC">]</span><span class="PUNC">*</span><span class="NAME">y</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">5</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">5</span><span class="PUNC">]</span><span class="PUNC">*</span><span class="NAME">y</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">6</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">6</span><span class="PUNC">]</span><span class="PUNC">*</span><span class="NAME">y</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">7</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">7</span><span class="PUNC">]</span><span class="PUNC">*</span><span class="NAME">y</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">8</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">8</span><span class="PUNC">]</span><span class="PUNC">*</span><span class="NAME">z</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">9</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">9</span><span class="PUNC">]</span><span class="PUNC">*</span><span class="NAME">z</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">10</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">10</span><span class="PUNC">]</span><span class="PUNC">*</span><span class="NAME">z</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">11</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">11</span><span class="PUNC">]</span><span class="PUNC">*</span><span class="NAME">z</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">12</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">12</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">13</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">13</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">14</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">14</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">15</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">15</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">out</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">mat4.rotate</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">out</span><span class="PUNC">,</span><span class="NAME">a</span><span class="PUNC">,</span><span class="NAME">rad</span><span class="PUNC">,</span><span class="NAME">axis</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">x</span><span class="PUNC">=</span><span class="NAME">axis</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">y</span><span class="PUNC">=</span><span class="NAME">axis</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">z</span><span class="PUNC">=</span><span class="NAME">axis</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">len</span><span class="PUNC">=</span><span class="NAME">Math.sqrt</span><span class="PUNC">(</span><span class="NAME">x</span><span class="PUNC">*</span><span class="NAME">x</span><span class="PUNC">+</span><span class="NAME">y</span><span class="PUNC">*</span><span class="NAME">y</span><span class="PUNC">+</span><span class="NAME">z</span><span class="PUNC">*</span><span class="NAME">z</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">s</span><span class="PUNC">,</span><span class="NAME">c</span><span class="PUNC">,</span><span class="NAME">t</span><span class="PUNC">,</span><span class="NAME">a00</span><span class="PUNC">,</span><span class="NAME">a01</span><span class="PUNC">,</span><span class="NAME">a02</span><span class="PUNC">,</span><span class="NAME">a03</span><span class="PUNC">,</span><span class="NAME">a10</span><span class="PUNC">,</span><span class="NAME">a11</span><span class="PUNC">,</span><span class="NAME">a12</span><span class="PUNC">,</span><span class="NAME">a13</span><span class="PUNC">,</span><span class="NAME">a20</span><span class="PUNC">,</span><span class="NAME">a21</span><span class="PUNC">,</span><span class="NAME">a22</span><span class="PUNC">,</span><span class="NAME">a23</span><span class="PUNC">,</span><span class="NAME">b00</span><span class="PUNC">,</span><span class="NAME">b01</span><span class="PUNC">,</span><span class="NAME">b02</span><span class="PUNC">,</span><span class="NAME">b10</span><span class="PUNC">,</span><span class="NAME">b11</span><span class="PUNC">,</span><span class="NAME">b12</span><span class="PUNC">,</span><span class="NAME">b20</span><span class="PUNC">,</span><span class="NAME">b21</span><span class="PUNC">,</span><span class="NAME">b22</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">Math.abs</span><span class="PUNC">(</span><span class="NAME">len</span><span class="PUNC">)</span><span class="PUNC">&lt;</span><span class="NAME">GLMAT_EPSILON</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">}</span><span class="NAME">len</span><span class="PUNC">=</span><span class="NUMB">1</span><span class="PUNC">/</span><span class="NAME">len</span><span class="PUNC">;</span><span class="NAME">x</span><span class="PUNC">*</span><span class="PUNC">=</span><span class="NAME">len</span><span class="PUNC">;</span><span class="NAME">y</span><span class="PUNC">*</span><span class="PUNC">=</span><span class="NAME">len</span><span class="PUNC">;</span><span class="NAME">z</span><span class="PUNC">*</span><span class="PUNC">=</span><span class="NAME">len</span><span class="PUNC">;</span><span class="NAME">s</span><span class="PUNC">=</span><span class="NAME">Math.sin</span><span class="PUNC">(</span><span class="NAME">rad</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">c</span><span class="PUNC">=</span><span class="NAME">Math.cos</span><span class="PUNC">(</span><span class="NAME">rad</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">t</span><span class="PUNC">=</span><span class="NUMB">1</span><span class="PUNC">-</span><span class="NAME">c</span><span class="PUNC">;</span><span class="NAME">a00</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">a01</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">a02</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">a03</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">a10</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">4</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">a11</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">5</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">a12</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">6</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">a13</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">7</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">a20</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">8</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">a21</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">9</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">a22</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">10</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">a23</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">11</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">b00</span><span class="PUNC">=</span><span class="NAME">x</span><span class="PUNC">*</span><span class="NAME">x</span><span class="PUNC">*</span><span class="NAME">t</span><span class="PUNC">+</span><span class="NAME">c</span><span class="PUNC">;</span><span class="NAME">b01</span><span class="PUNC">=</span><span class="NAME">y</span><span class="PUNC">*</span><span class="NAME">x</span><span class="PUNC">*</span><span class="NAME">t</span><span class="PUNC">+</span><span class="NAME">z</span><span class="PUNC">*</span><span class="NAME">s</span><span class="PUNC">;</span><span class="NAME">b02</span><span class="PUNC">=</span><span class="NAME">z</span><span class="PUNC">*</span><span class="NAME">x</span><span class="PUNC">*</span><span class="NAME">t</span><span class="PUNC">-</span><span class="NAME">y</span><span class="PUNC">*</span><span class="NAME">s</span><span class="PUNC">;</span><span class="NAME">b10</span><span class="PUNC">=</span><span class="NAME">x</span><span class="PUNC">*</span><span class="NAME">y</span><span class="PUNC">*</span><span class="NAME">t</span><span class="PUNC">-</span><span class="NAME">z</span><span class="PUNC">*</span><span class="NAME">s</span><span class="PUNC">;</span><span class="NAME">b11</span><span class="PUNC">=</span><span class="NAME">y</span><span class="PUNC">*</span><span class="NAME">y</span><span class="PUNC">*</span><span class="NAME">t</span><span class="PUNC">+</span><span class="NAME">c</span><span class="PUNC">;</span><span class="NAME">b12</span><span class="PUNC">=</span><span class="NAME">z</span><span class="PUNC">*</span><span class="NAME">y</span><span class="PUNC">*</span><span class="NAME">t</span><span class="PUNC">+</span><span class="NAME">x</span><span class="PUNC">*</span><span class="NAME">s</span><span class="PUNC">;</span><span class="NAME">b20</span><span class="PUNC">=</span><span class="NAME">x</span><span class="PUNC">*</span><span class="NAME">z</span><span class="PUNC">*</span><span class="NAME">t</span><span class="PUNC">+</span><span class="NAME">y</span><span class="PUNC">*</span><span class="NAME">s</span><span class="PUNC">;</span><span class="NAME">b21</span><span class="PUNC">=</span><span class="NAME">y</span><span class="PUNC">*</span><span class="NAME">z</span><span class="PUNC">*</span><span class="NAME">t</span><span class="PUNC">-</span><span class="NAME">x</span><span class="PUNC">*</span><span class="NAME">s</span><span class="PUNC">;</span><span class="NAME">b22</span><span class="PUNC">=</span><span class="NAME">z</span><span class="PUNC">*</span><span class="NAME">z</span><span class="PUNC">*</span><span class="NAME">t</span><span class="PUNC">+</span><span class="NAME">c</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a00</span><span class="PUNC">*</span><span class="NAME">b00</span><span class="PUNC">+</span><span class="NAME">a10</span><span class="PUNC">*</span><span class="NAME">b01</span><span class="PUNC">+</span><span class="NAME">a20</span><span class="PUNC">*</span><span class="NAME">b02</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a01</span><span class="PUNC">*</span><span class="NAME">b00</span><span class="PUNC">+</span><span class="NAME">a11</span><span class="PUNC">*</span><span class="NAME">b01</span><span class="PUNC">+</span><span class="NAME">a21</span><span class="PUNC">*</span><span class="NAME">b02</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a02</span><span class="PUNC">*</span><span class="NAME">b00</span><span class="PUNC">+</span><span class="NAME">a12</span><span class="PUNC">*</span><span class="NAME">b01</span><span class="PUNC">+</span><span class="NAME">a22</span><span class="PUNC">*</span><span class="NAME">b02</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a03</span><span class="PUNC">*</span><span class="NAME">b00</span><span class="PUNC">+</span><span class="NAME">a13</span><span class="PUNC">*</span><span class="NAME">b01</span><span class="PUNC">+</span><span class="NAME">a23</span><span class="PUNC">*</span><span class="NAME">b02</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">4</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a00</span><span class="PUNC">*</span><span class="NAME">b10</span><span class="PUNC">+</span><span class="NAME">a10</span><span class="PUNC">*</span><span class="NAME">b11</span><span class="PUNC">+</span><span class="NAME">a20</span><span class="PUNC">*</span><span class="NAME">b12</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">5</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a01</span><span class="PUNC">*</span><span class="NAME">b10</span><span class="PUNC">+</span><span class="NAME">a11</span><span class="PUNC">*</span><span class="NAME">b11</span><span class="PUNC">+</span><span class="NAME">a21</span><span class="PUNC">*</span><span class="NAME">b12</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">6</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a02</span><span class="PUNC">*</span><span class="NAME">b10</span><span class="PUNC">+</span><span class="NAME">a12</span><span class="PUNC">*</span><span class="NAME">b11</span><span class="PUNC">+</span><span class="NAME">a22</span><span class="PUNC">*</span><span class="NAME">b12</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">7</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a03</span><span class="PUNC">*</span><span class="NAME">b10</span><span class="PUNC">+</span><span class="NAME">a13</span><span class="PUNC">*</span><span class="NAME">b11</span><span class="PUNC">+</span><span class="NAME">a23</span><span class="PUNC">*</span><span class="NAME">b12</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">8</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a00</span><span class="PUNC">*</span><span class="NAME">b20</span><span class="PUNC">+</span><span class="NAME">a10</span><span class="PUNC">*</span><span class="NAME">b21</span><span class="PUNC">+</span><span class="NAME">a20</span><span class="PUNC">*</span><span class="NAME">b22</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">9</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a01</span><span class="PUNC">*</span><span class="NAME">b20</span><span class="PUNC">+</span><span class="NAME">a11</span><span class="PUNC">*</span><span class="NAME">b21</span><span class="PUNC">+</span><span class="NAME">a21</span><span class="PUNC">*</span><span class="NAME">b22</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">10</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a02</span><span class="PUNC">*</span><span class="NAME">b20</span><span class="PUNC">+</span><span class="NAME">a12</span><span class="PUNC">*</span><span class="NAME">b21</span><span class="PUNC">+</span><span class="NAME">a22</span><span class="PUNC">*</span><span class="NAME">b22</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">11</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a03</span><span class="PUNC">*</span><span class="NAME">b20</span><span class="PUNC">+</span><span class="NAME">a13</span><span class="PUNC">*</span><span class="NAME">b21</span><span class="PUNC">+</span><span class="NAME">a23</span><span class="PUNC">*</span><span class="NAME">b22</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">!==</span><span class="NAME">out</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">12</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">12</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">13</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">13</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">14</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">14</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">15</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">15</span><span class="PUNC">]</span><span class="PUNC">}</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">out</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">mat4.rotateX</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">out</span><span class="PUNC">,</span><span class="NAME">a</span><span class="PUNC">,</span><span class="NAME">rad</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">s</span><span class="PUNC">=</span><span class="NAME">Math.sin</span><span class="PUNC">(</span><span class="NAME">rad</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">c</span><span class="PUNC">=</span><span class="NAME">Math.cos</span><span class="PUNC">(</span><span class="NAME">rad</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">a10</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">4</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">a11</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">5</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">a12</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">6</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">a13</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">7</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">a20</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">8</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">a21</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">9</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">a22</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">10</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">a23</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">11</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">!==</span><span class="NAME">out</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">12</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">12</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">13</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">13</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">14</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">14</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">15</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">15</span><span class="PUNC">]</span><span class="PUNC">}</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">4</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a10</span><span class="PUNC">*</span><span class="NAME">c</span><span class="PUNC">+</span><span class="NAME">a20</span><span class="PUNC">*</span><span class="NAME">s</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">5</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a11</span><span class="PUNC">*</span><span class="NAME">c</span><span class="PUNC">+</span><span class="NAME">a21</span><span class="PUNC">*</span><span class="NAME">s</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">6</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a12</span><span class="PUNC">*</span><span class="NAME">c</span><span class="PUNC">+</span><span class="NAME">a22</span><span class="PUNC">*</span><span class="NAME">s</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">7</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a13</span><span class="PUNC">*</span><span class="NAME">c</span><span class="PUNC">+</span><span class="NAME">a23</span><span class="PUNC">*</span><span class="NAME">s</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">8</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a20</span><span class="PUNC">*</span><span class="NAME">c</span><span class="PUNC">-</span><span class="NAME">a10</span><span class="PUNC">*</span><span class="NAME">s</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">9</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a21</span><span class="PUNC">*</span><span class="NAME">c</span><span class="PUNC">-</span><span class="NAME">a11</span><span class="PUNC">*</span><span class="NAME">s</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">10</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a22</span><span class="PUNC">*</span><span class="NAME">c</span><span class="PUNC">-</span><span class="NAME">a12</span><span class="PUNC">*</span><span class="NAME">s</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">11</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a23</span><span class="PUNC">*</span><span class="NAME">c</span><span class="PUNC">-</span><span class="NAME">a13</span><span class="PUNC">*</span><span class="NAME">s</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">out</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">mat4.rotateY</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">out</span><span class="PUNC">,</span><span class="NAME">a</span><span class="PUNC">,</span><span class="NAME">rad</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">s</span><span class="PUNC">=</span><span class="NAME">Math.sin</span><span class="PUNC">(</span><span class="NAME">rad</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">c</span><span class="PUNC">=</span><span class="NAME">Math.cos</span><span class="PUNC">(</span><span class="NAME">rad</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">a00</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">a01</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">a02</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">a03</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">a20</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">8</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">a21</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">9</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">a22</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">10</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">a23</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">11</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">!==</span><span class="NAME">out</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">4</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">4</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">5</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">5</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">6</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">6</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">7</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">7</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">12</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">12</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">13</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">13</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">14</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">14</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">15</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">15</span><span class="PUNC">]</span><span class="PUNC">}</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a00</span><span class="PUNC">*</span><span class="NAME">c</span><span class="PUNC">-</span><span class="NAME">a20</span><span class="PUNC">*</span><span class="NAME">s</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a01</span><span class="PUNC">*</span><span class="NAME">c</span><span class="PUNC">-</span><span class="NAME">a21</span><span class="PUNC">*</span><span class="NAME">s</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a02</span><span class="PUNC">*</span><span class="NAME">c</span><span class="PUNC">-</span><span class="NAME">a22</span><span class="PUNC">*</span><span class="NAME">s</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a03</span><span class="PUNC">*</span><span class="NAME">c</span><span class="PUNC">-</span><span class="NAME">a23</span><span class="PUNC">*</span><span class="NAME">s</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">8</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a00</span><span class="PUNC">*</span><span class="NAME">s</span><span class="PUNC">+</span><span class="NAME">a20</span><span class="PUNC">*</span><span class="NAME">c</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">9</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a01</span><span class="PUNC">*</span><span class="NAME">s</span><span class="PUNC">+</span><span class="NAME">a21</span><span class="PUNC">*</span><span class="NAME">c</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">10</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a02</span><span class="PUNC">*</span><span class="NAME">s</span><span class="PUNC">+</span><span class="NAME">a22</span><span class="PUNC">*</span><span class="NAME">c</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">11</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a03</span><span class="PUNC">*</span><span class="NAME">s</span><span class="PUNC">+</span><span class="NAME">a23</span><span class="PUNC">*</span><span class="NAME">c</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">out</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">mat4.rotateZ</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">out</span><span class="PUNC">,</span><span class="NAME">a</span><span class="PUNC">,</span><span class="NAME">rad</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">s</span><span class="PUNC">=</span><span class="NAME">Math.sin</span><span class="PUNC">(</span><span class="NAME">rad</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">c</span><span class="PUNC">=</span><span class="NAME">Math.cos</span><span class="PUNC">(</span><span class="NAME">rad</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">a00</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">a01</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">a02</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">a03</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">a10</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">4</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">a11</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">5</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">a12</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">6</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">a13</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">7</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">!==</span><span class="NAME">out</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">8</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">8</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">9</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">9</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">10</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">10</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">11</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">11</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">12</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">12</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">13</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">13</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">14</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">14</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">15</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">15</span><span class="PUNC">]</span><span class="PUNC">}</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a00</span><span class="PUNC">*</span><span class="NAME">c</span><span class="PUNC">+</span><span class="NAME">a10</span><span class="PUNC">*</span><span class="NAME">s</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a01</span><span class="PUNC">*</span><span class="NAME">c</span><span class="PUNC">+</span><span class="NAME">a11</span><span class="PUNC">*</span><span class="NAME">s</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a02</span><span class="PUNC">*</span><span class="NAME">c</span><span class="PUNC">+</span><span class="NAME">a12</span><span class="PUNC">*</span><span class="NAME">s</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a03</span><span class="PUNC">*</span><span class="NAME">c</span><span class="PUNC">+</span><span class="NAME">a13</span><span class="PUNC">*</span><span class="NAME">s</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">4</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a10</span><span class="PUNC">*</span><span class="NAME">c</span><span class="PUNC">-</span><span class="NAME">a00</span><span class="PUNC">*</span><span class="NAME">s</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">5</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a11</span><span class="PUNC">*</span><span class="NAME">c</span><span class="PUNC">-</span><span class="NAME">a01</span><span class="PUNC">*</span><span class="NAME">s</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">6</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a12</span><span class="PUNC">*</span><span class="NAME">c</span><span class="PUNC">-</span><span class="NAME">a02</span><span class="PUNC">*</span><span class="NAME">s</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">7</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a13</span><span class="PUNC">*</span><span class="NAME">c</span><span class="PUNC">-</span><span class="NAME">a03</span><span class="PUNC">*</span><span class="NAME">s</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">out</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">mat4.fromRotationTranslation</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">out</span><span class="PUNC">,</span><span class="NAME">q</span><span class="PUNC">,</span><span class="NAME">v</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">x</span><span class="PUNC">=</span><span class="NAME">q</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">y</span><span class="PUNC">=</span><span class="NAME">q</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">z</span><span class="PUNC">=</span><span class="NAME">q</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">w</span><span class="PUNC">=</span><span class="NAME">q</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">x2</span><span class="PUNC">=</span><span class="NAME">x</span><span class="PUNC">+</span><span class="NAME">x</span><span class="PUNC">,</span><span class="NAME">y2</span><span class="PUNC">=</span><span class="NAME">y</span><span class="PUNC">+</span><span class="NAME">y</span><span class="PUNC">,</span><span class="NAME">z2</span><span class="PUNC">=</span><span class="NAME">z</span><span class="PUNC">+</span><span class="NAME">z</span><span class="PUNC">,</span><span class="NAME">xx</span><span class="PUNC">=</span><span class="NAME">x</span><span class="PUNC">*</span><span class="NAME">x2</span><span class="PUNC">,</span><span class="NAME">xy</span><span class="PUNC">=</span><span class="NAME">x</span><span class="PUNC">*</span><span class="NAME">y2</span><span class="PUNC">,</span><span class="NAME">xz</span><span class="PUNC">=</span><span class="NAME">x</span><span class="PUNC">*</span><span class="NAME">z2</span><span class="PUNC">,</span><span class="NAME">yy</span><span class="PUNC">=</span><span class="NAME">y</span><span class="PUNC">*</span><span class="NAME">y2</span><span class="PUNC">,</span><span class="NAME">yz</span><span class="PUNC">=</span><span class="NAME">y</span><span class="PUNC">*</span><span class="NAME">z2</span><span class="PUNC">,</span><span class="NAME">zz</span><span class="PUNC">=</span><span class="NAME">z</span><span class="PUNC">*</span><span class="NAME">z2</span><span class="PUNC">,</span><span class="NAME">wx</span><span class="PUNC">=</span><span class="NAME">w</span><span class="PUNC">*</span><span class="NAME">x2</span><span class="PUNC">,</span><span class="NAME">wy</span><span class="PUNC">=</span><span class="NAME">w</span><span class="PUNC">*</span><span class="NAME">y2</span><span class="PUNC">,</span><span class="NAME">wz</span><span class="PUNC">=</span><span class="NAME">w</span><span class="PUNC">*</span><span class="NAME">z2</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NUMB">1</span><span class="PUNC">-</span><span class="PUNC">(</span><span class="NAME">yy</span><span class="PUNC">+</span><span class="NAME">zz</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">xy</span><span class="PUNC">+</span><span class="NAME">wz</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">xz</span><span class="PUNC">-</span><span class="NAME">wy</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">4</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">xy</span><span class="PUNC">-</span><span class="NAME">wz</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">5</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NUMB">1</span><span class="PUNC">-</span><span class="PUNC">(</span><span class="NAME">xx</span><span class="PUNC">+</span><span class="NAME">zz</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">6</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">yz</span><span class="PUNC">+</span><span class="NAME">wx</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">7</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">8</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">xz</span><span class="PUNC">+</span><span class="NAME">wy</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">9</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">yz</span><span class="PUNC">-</span><span class="NAME">wx</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">10</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NUMB">1</span><span class="PUNC">-</span><span class="PUNC">(</span><span class="NAME">xx</span><span class="PUNC">+</span><span class="NAME">yy</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">11</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">12</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">v</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">13</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">v</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">14</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">v</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">15</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">out</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">mat4.frustum</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">out</span><span class="PUNC">,</span><span class="NAME">left</span><span class="PUNC">,</span><span class="NAME">right</span><span class="PUNC">,</span><span class="NAME">bottom</span><span class="PUNC">,</span><span class="NAME">top</span><span class="PUNC">,</span><span class="NAME">near</span><span class="PUNC">,</span><span class="NAME">far</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">rl</span><span class="PUNC">=</span><span class="NUMB">1</span><span class="PUNC">/</span><span class="PUNC">(</span><span class="NAME">right</span><span class="PUNC">-</span><span class="NAME">left</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">tb</span><span class="PUNC">=</span><span class="NUMB">1</span><span class="PUNC">/</span><span class="PUNC">(</span><span class="NAME">top</span><span class="PUNC">-</span><span class="NAME">bottom</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">nf</span><span class="PUNC">=</span><span class="NUMB">1</span><span class="PUNC">/</span><span class="PUNC">(</span><span class="NAME">near</span><span class="PUNC">-</span><span class="NAME">far</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">near</span><span class="PUNC">*</span><span class="NUMB">2</span><span class="PUNC">*</span><span class="NAME">rl</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">4</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">5</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">near</span><span class="PUNC">*</span><span class="NUMB">2</span><span class="PUNC">*</span><span class="NAME">tb</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">6</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">7</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">8</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">right</span><span class="PUNC">+</span><span class="NAME">left</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="NAME">rl</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">9</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">top</span><span class="PUNC">+</span><span class="NAME">bottom</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="NAME">tb</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">10</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">far</span><span class="PUNC">+</span><span class="NAME">near</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="NAME">nf</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">11</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">12</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">13</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">14</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">far</span><span class="PUNC">*</span><span class="NAME">near</span><span class="PUNC">*</span><span class="NUMB">2</span><span class="PUNC">*</span><span class="NAME">nf</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">15</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">out</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">mat4.perspective</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">out</span><span class="PUNC">,</span><span class="NAME">fovy</span><span class="PUNC">,</span><span class="NAME">aspect</span><span class="PUNC">,</span><span class="NAME">near</span><span class="PUNC">,</span><span class="NAME">far</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">f</span><span class="PUNC">=</span><span class="NUMB">1</span><span class="PUNC">/</span><span class="NAME">Math.tan</span><span class="PUNC">(</span><span class="NAME">fovy</span><span class="PUNC">/</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">nf</span><span class="PUNC">=</span><span class="NUMB">1</span><span class="PUNC">/</span><span class="PUNC">(</span><span class="NAME">near</span><span class="PUNC">-</span><span class="NAME">far</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">f</span><span class="PUNC">/</span><span class="NAME">aspect</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">4</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">5</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">f</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">6</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">7</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">8</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">9</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">10</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">far</span><span class="PUNC">+</span><span class="NAME">near</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="NAME">nf</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">11</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">12</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">13</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">14</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NUMB">2</span><span class="PUNC">*</span><span class="NAME">far</span><span class="PUNC">*</span><span class="NAME">near</span><span class="PUNC">*</span><span class="NAME">nf</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">15</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">out</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">mat4.ortho</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">out</span><span class="PUNC">,</span><span class="NAME">left</span><span class="PUNC">,</span><span class="NAME">right</span><span class="PUNC">,</span><span class="NAME">bottom</span><span class="PUNC">,</span><span class="NAME">top</span><span class="PUNC">,</span><span class="NAME">near</span><span class="PUNC">,</span><span class="NAME">far</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">lr</span><span class="PUNC">=</span><span class="NUMB">1</span><span class="PUNC">/</span><span class="PUNC">(</span><span class="NAME">left</span><span class="PUNC">-</span><span class="NAME">right</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">bt</span><span class="PUNC">=</span><span class="NUMB">1</span><span class="PUNC">/</span><span class="PUNC">(</span><span class="NAME">bottom</span><span class="PUNC">-</span><span class="NAME">top</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">nf</span><span class="PUNC">=</span><span class="NUMB">1</span><span class="PUNC">/</span><span class="PUNC">(</span><span class="NAME">near</span><span class="PUNC">-</span><span class="NAME">far</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="PUNC">-</span><span class="NUMB">2</span><span class="PUNC">*</span><span class="NAME">lr</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">4</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">5</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="PUNC">-</span><span class="NUMB">2</span><span class="PUNC">*</span><span class="NAME">bt</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">6</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">7</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">8</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">9</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">10</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NUMB">2</span><span class="PUNC">*</span><span class="NAME">nf</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">11</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">12</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">left</span><span class="PUNC">+</span><span class="NAME">right</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="NAME">lr</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">13</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">top</span><span class="PUNC">+</span><span class="NAME">bottom</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="NAME">bt</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">14</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">far</span><span class="PUNC">+</span><span class="NAME">near</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="NAME">nf</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">15</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">out</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">mat4.lookAt</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">out</span><span class="PUNC">,</span><span class="NAME">eye</span><span class="PUNC">,</span><span class="NAME">center</span><span class="PUNC">,</span><span class="NAME">up</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">x0</span><span class="PUNC">,</span><span class="NAME">x1</span><span class="PUNC">,</span><span class="NAME">x2</span><span class="PUNC">,</span><span class="NAME">y0</span><span class="PUNC">,</span><span class="NAME">y1</span><span class="PUNC">,</span><span class="NAME">y2</span><span class="PUNC">,</span><span class="NAME">z0</span><span class="PUNC">,</span><span class="NAME">z1</span><span class="PUNC">,</span><span class="NAME">z2</span><span class="PUNC">,</span><span class="NAME">len</span><span class="PUNC">,</span><span class="NAME">eyex</span><span class="PUNC">=</span><span class="NAME">eye</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">eyey</span><span class="PUNC">=</span><span class="NAME">eye</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">eyez</span><span class="PUNC">=</span><span class="NAME">eye</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">upx</span><span class="PUNC">=</span><span class="NAME">up</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">upy</span><span class="PUNC">=</span><span class="NAME">up</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">upz</span><span class="PUNC">=</span><span class="NAME">up</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">centerx</span><span class="PUNC">=</span><span class="NAME">center</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">centery</span><span class="PUNC">=</span><span class="NAME">center</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">centerz</span><span class="PUNC">=</span><span class="NAME">center</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">Math.abs</span><span class="PUNC">(</span><span class="NAME">eyex</span><span class="PUNC">-</span><span class="NAME">centerx</span><span class="PUNC">)</span><span class="PUNC">&lt;</span><span class="NAME">GLMAT_EPSILON</span><span class="PUNC">&&</span><span class="NAME">Math.abs</span><span class="PUNC">(</span><span class="NAME">eyey</span><span class="PUNC">-</span><span class="NAME">centery</span><span class="PUNC">)</span><span class="PUNC">&lt;</span><span class="NAME">GLMAT_EPSILON</span><span class="PUNC">&&</span><span class="NAME">Math.abs</span><span class="PUNC">(</span><span class="NAME">eyez</span><span class="PUNC">-</span><span class="NAME">centerz</span><span class="PUNC">)</span><span class="PUNC">&lt;</span><span class="NAME">GLMAT_EPSILON</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">mat4.identity</span><span class="PUNC">(</span><span class="NAME">out</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="NAME">z0</span><span class="PUNC">=</span><span class="NAME">eyex</span><span class="PUNC">-</span><span class="NAME">centerx</span><span class="PUNC">;</span><span class="NAME">z1</span><span class="PUNC">=</span><span class="NAME">eyey</span><span class="PUNC">-</span><span class="NAME">centery</span><span class="PUNC">;</span><span class="NAME">z2</span><span class="PUNC">=</span><span class="NAME">eyez</span><span class="PUNC">-</span><span class="NAME">centerz</span><span class="PUNC">;</span><span class="NAME">len</span><span class="PUNC">=</span><span class="NUMB">1</span><span class="PUNC">/</span><span class="NAME">Math.sqrt</span><span class="PUNC">(</span><span class="NAME">z0</span><span class="PUNC">*</span><span class="NAME">z0</span><span class="PUNC">+</span><span class="NAME">z1</span><span class="PUNC">*</span><span class="NAME">z1</span><span class="PUNC">+</span><span class="NAME">z2</span><span class="PUNC">*</span><span class="NAME">z2</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">z0</span><span class="PUNC">*</span><span class="PUNC">=</span><span class="NAME">len</span><span class="PUNC">;</span><span class="NAME">z1</span><span class="PUNC">*</span><span class="PUNC">=</span><span class="NAME">len</span><span class="PUNC">;</span><span class="NAME">z2</span><span class="PUNC">*</span><span class="PUNC">=</span><span class="NAME">len</span><span class="PUNC">;</span><span class="NAME">x0</span><span class="PUNC">=</span><span class="NAME">upy</span><span class="PUNC">*</span><span class="NAME">z2</span><span class="PUNC">-</span><span class="NAME">upz</span><span class="PUNC">*</span><span class="NAME">z1</span><span class="PUNC">;</span><span class="NAME">x1</span><span class="PUNC">=</span><span class="NAME">upz</span><span class="PUNC">*</span><span class="NAME">z0</span><span class="PUNC">-</span><span class="NAME">upx</span><span class="PUNC">*</span><span class="NAME">z2</span><span class="PUNC">;</span><span class="NAME">x2</span><span class="PUNC">=</span><span class="NAME">upx</span><span class="PUNC">*</span><span class="NAME">z1</span><span class="PUNC">-</span><span class="NAME">upy</span><span class="PUNC">*</span><span class="NAME">z0</span><span class="PUNC">;</span><span class="NAME">len</span><span class="PUNC">=</span><span class="NAME">Math.sqrt</span><span class="PUNC">(</span><span class="NAME">x0</span><span class="PUNC">*</span><span class="NAME">x0</span><span class="PUNC">+</span><span class="NAME">x1</span><span class="PUNC">*</span><span class="NAME">x1</span><span class="PUNC">+</span><span class="NAME">x2</span><span class="PUNC">*</span><span class="NAME">x2</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">len</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">x0</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">x1</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">x2</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">len</span><span class="PUNC">=</span><span class="NUMB">1</span><span class="PUNC">/</span><span class="NAME">len</span><span class="PUNC">;</span><span class="NAME">x0</span><span class="PUNC">*</span><span class="PUNC">=</span><span class="NAME">len</span><span class="PUNC">;</span><span class="NAME">x1</span><span class="PUNC">*</span><span class="PUNC">=</span><span class="NAME">len</span><span class="PUNC">;</span><span class="NAME">x2</span><span class="PUNC">*</span><span class="PUNC">=</span><span class="NAME">len</span><span class="PUNC">}</span><span class="NAME">y0</span><span class="PUNC">=</span><span class="NAME">z1</span><span class="PUNC">*</span><span class="NAME">x2</span><span class="PUNC">-</span><span class="NAME">z2</span><span class="PUNC">*</span><span class="NAME">x1</span><span class="PUNC">;</span><span class="NAME">y1</span><span class="PUNC">=</span><span class="NAME">z2</span><span class="PUNC">*</span><span class="NAME">x0</span><span class="PUNC">-</span><span class="NAME">z0</span><span class="PUNC">*</span><span class="NAME">x2</span><span class="PUNC">;</span><span class="NAME">y2</span><span class="PUNC">=</span><span class="NAME">z0</span><span class="PUNC">*</span><span class="NAME">x1</span><span class="PUNC">-</span><span class="NAME">z1</span><span class="PUNC">*</span><span class="NAME">x0</span><span class="PUNC">;</span><span class="NAME">len</span><span class="PUNC">=</span><span class="NAME">Math.sqrt</span><span class="PUNC">(</span><span class="NAME">y0</span><span class="PUNC">*</span><span class="NAME">y0</span><span class="PUNC">+</span><span class="NAME">y1</span><span class="PUNC">*</span><span class="NAME">y1</span><span class="PUNC">+</span><span class="NAME">y2</span><span class="PUNC">*</span><span class="NAME">y2</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">len</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">y0</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">y1</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">y2</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">len</span><span class="PUNC">=</span><span class="NUMB">1</span><span class="PUNC">/</span><span class="NAME">len</span><span class="PUNC">;</span><span class="NAME">y0</span><span class="PUNC">*</span><span class="PUNC">=</span><span class="NAME">len</span><span class="PUNC">;</span><span class="NAME">y1</span><span class="PUNC">*</span><span class="PUNC">=</span><span class="NAME">len</span><span class="PUNC">;</span><span class="NAME">y2</span><span class="PUNC">*</span><span class="PUNC">=</span><span class="NAME">len</span><span class="PUNC">}</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">x0</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">y0</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">z0</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">4</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">x1</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">5</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">y1</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">6</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">z1</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">7</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">8</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">x2</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">9</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">y2</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">10</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">z2</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">11</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">12</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="PUNC">-</span><span class="PUNC">(</span><span class="NAME">x0</span><span class="PUNC">*</span><span class="NAME">eyex</span><span class="PUNC">+</span><span class="NAME">x1</span><span class="PUNC">*</span><span class="NAME">eyey</span><span class="PUNC">+</span><span class="NAME">x2</span><span class="PUNC">*</span><span class="NAME">eyez</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">13</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="PUNC">-</span><span class="PUNC">(</span><span class="NAME">y0</span><span class="PUNC">*</span><span class="NAME">eyex</span><span class="PUNC">+</span><span class="NAME">y1</span><span class="PUNC">*</span><span class="NAME">eyey</span><span class="PUNC">+</span><span class="NAME">y2</span><span class="PUNC">*</span><span class="NAME">eyez</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">14</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="PUNC">-</span><span class="PUNC">(</span><span class="NAME">z0</span><span class="PUNC">*</span><span class="NAME">eyex</span><span class="PUNC">+</span><span class="NAME">z1</span><span class="PUNC">*</span><span class="NAME">eyey</span><span class="PUNC">+</span><span class="NAME">z2</span><span class="PUNC">*</span><span class="NAME">eyez</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">15</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">out</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">mat4.str</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="STRN">"mat4("</span><span class="PUNC">+</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">+</span><span class="STRN">", "</span><span class="PUNC">+</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">+</span><span class="STRN">", "</span><span class="PUNC">+</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">+</span><span class="STRN">", "</span><span class="PUNC">+</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">+</span><span class="STRN">", "</span><span class="PUNC">+</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">4</span><span class="PUNC">]</span><span class="PUNC">+</span><span class="STRN">", "</span><span class="PUNC">+</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">5</span><span class="PUNC">]</span><span class="PUNC">+</span><span class="STRN">", "</span><span class="PUNC">+</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">6</span><span class="PUNC">]</span><span class="PUNC">+</span><span class="STRN">", "</span><span class="PUNC">+</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">7</span><span class="PUNC">]</span><span class="PUNC">+</span><span class="STRN">", "</span><span class="PUNC">+</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">8</span><span class="PUNC">]</span><span class="PUNC">+</span><span class="STRN">", "</span><span class="PUNC">+</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">9</span><span class="PUNC">]</span><span class="PUNC">+</span><span class="STRN">", "</span><span class="PUNC">+</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">10</span><span class="PUNC">]</span><span class="PUNC">+</span><span class="STRN">", "</span><span class="PUNC">+</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">11</span><span class="PUNC">]</span><span class="PUNC">+</span><span class="STRN">", "</span><span class="PUNC">+</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">12</span><span class="PUNC">]</span><span class="PUNC">+</span><span class="STRN">", "</span><span class="PUNC">+</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">13</span><span class="PUNC">]</span><span class="PUNC">+</span><span class="STRN">", "</span><span class="PUNC">+</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">14</span><span class="PUNC">]</span><span class="PUNC">+</span><span class="STRN">", "</span><span class="PUNC">+</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">15</span><span class="PUNC">]</span><span class="PUNC">+</span><span class="STRN">")"</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">exports</span><span class="PUNC">!==</span><span class="STRN">"undefined"</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">exports.mat4</span><span class="PUNC">=</span><span class="NAME">mat4</span><span class="PUNC">}</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">quat</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">quatIdentity</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Float32Array</span><span class="PUNC">(</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">GLMAT_EPSILON</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">GLMAT_EPSILON</span><span class="PUNC">=</span><span class="NUMB">1</span><span class="NAME">e</span><span class="PUNC">-</span><span class="NUMB">6</span><span class="PUNC">}</span><span class="NAME">quat.create</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Float32Array</span><span class="PUNC">(</span><span class="NAME">quatIdentity</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">quat.clone</span><span class="PUNC">=</span><span class="NAME">vec4.clone</span><span class="PUNC">;</span><span class="NAME">quat.fromValues</span><span class="PUNC">=</span><span class="NAME">vec4.fromValues</span><span class="PUNC">;</span><span class="NAME">quat.copy</span><span class="PUNC">=</span><span class="NAME">vec4.copy</span><span class="PUNC">;</span><span class="NAME">quat.set</span><span class="PUNC">=</span><span class="NAME">vec4.set</span><span class="PUNC">;</span><span class="NAME">quat.identity</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">out</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">out</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">quat.setAxisAngle</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">out</span><span class="PUNC">,</span><span class="NAME">axis</span><span class="PUNC">,</span><span class="NAME">rad</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">rad</span><span class="PUNC">=</span><span class="NAME">rad</span><span class="PUNC">*</span><span class="PUNC">.</span><span class="NUMB">5</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">s</span><span class="PUNC">=</span><span class="NAME">Math.sin</span><span class="PUNC">(</span><span class="NAME">rad</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">s</span><span class="PUNC">*</span><span class="NAME">axis</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">s</span><span class="PUNC">*</span><span class="NAME">axis</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">s</span><span class="PUNC">*</span><span class="NAME">axis</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">Math.cos</span><span class="PUNC">(</span><span class="NAME">rad</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">out</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">quat.add</span><span class="PUNC">=</span><span class="NAME">vec4.add</span><span class="PUNC">;</span><span class="NAME">quat.mul</span><span class="PUNC">=</span><span class="NAME">quat.multiply</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">out</span><span class="PUNC">,</span><span class="NAME">a</span><span class="PUNC">,</span><span class="NAME">b</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ax</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">ay</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">az</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">aw</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">bx</span><span class="PUNC">=</span><span class="NAME">b</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">by</span><span class="PUNC">=</span><span class="NAME">b</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">bz</span><span class="PUNC">=</span><span class="NAME">b</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">bw</span><span class="PUNC">=</span><span class="NAME">b</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">ax</span><span class="PUNC">*</span><span class="NAME">bw</span><span class="PUNC">+</span><span class="NAME">aw</span><span class="PUNC">*</span><span class="NAME">bx</span><span class="PUNC">+</span><span class="NAME">ay</span><span class="PUNC">*</span><span class="NAME">bz</span><span class="PUNC">-</span><span class="NAME">az</span><span class="PUNC">*</span><span class="NAME">by</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">ay</span><span class="PUNC">*</span><span class="NAME">bw</span><span class="PUNC">+</span><span class="NAME">aw</span><span class="PUNC">*</span><span class="NAME">by</span><span class="PUNC">+</span><span class="NAME">az</span><span class="PUNC">*</span><span class="NAME">bx</span><span class="PUNC">-</span><span class="NAME">ax</span><span class="PUNC">*</span><span class="NAME">bz</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">az</span><span class="PUNC">*</span><span class="NAME">bw</span><span class="PUNC">+</span><span class="NAME">aw</span><span class="PUNC">*</span><span class="NAME">bz</span><span class="PUNC">+</span><span class="NAME">ax</span><span class="PUNC">*</span><span class="NAME">by</span><span class="PUNC">-</span><span class="NAME">ay</span><span class="PUNC">*</span><span class="NAME">bx</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">aw</span><span class="PUNC">*</span><span class="NAME">bw</span><span class="PUNC">-</span><span class="NAME">ax</span><span class="PUNC">*</span><span class="NAME">bx</span><span class="PUNC">-</span><span class="NAME">ay</span><span class="PUNC">*</span><span class="NAME">by</span><span class="PUNC">-</span><span class="NAME">az</span><span class="PUNC">*</span><span class="NAME">bz</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">out</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">quat.scale</span><span class="PUNC">=</span><span class="NAME">vec4.scale</span><span class="PUNC">;</span><span class="NAME">quat.rotateX</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">out</span><span class="PUNC">,</span><span class="NAME">a</span><span class="PUNC">,</span><span class="NAME">rad</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">rad</span><span class="PUNC">*</span><span class="PUNC">=</span><span class="PUNC">.</span><span class="NUMB">5</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ax</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">ay</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">az</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">aw</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">bx</span><span class="PUNC">=</span><span class="NAME">Math.sin</span><span class="PUNC">(</span><span class="NAME">rad</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">bw</span><span class="PUNC">=</span><span class="NAME">Math.cos</span><span class="PUNC">(</span><span class="NAME">rad</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">ax</span><span class="PUNC">*</span><span class="NAME">bw</span><span class="PUNC">+</span><span class="NAME">aw</span><span class="PUNC">*</span><span class="NAME">bx</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">ay</span><span class="PUNC">*</span><span class="NAME">bw</span><span class="PUNC">+</span><span class="NAME">az</span><span class="PUNC">*</span><span class="NAME">bx</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">az</span><span class="PUNC">*</span><span class="NAME">bw</span><span class="PUNC">-</span><span class="NAME">ay</span><span class="PUNC">*</span><span class="NAME">bx</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">aw</span><span class="PUNC">*</span><span class="NAME">bw</span><span class="PUNC">-</span><span class="NAME">ax</span><span class="PUNC">*</span><span class="NAME">bx</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">out</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">quat.rotateY</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">out</span><span class="PUNC">,</span><span class="NAME">a</span><span class="PUNC">,</span><span class="NAME">rad</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">rad</span><span class="PUNC">*</span><span class="PUNC">=</span><span class="PUNC">.</span><span class="NUMB">5</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ax</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">ay</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">az</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">aw</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">by</span><span class="PUNC">=</span><span class="NAME">Math.sin</span><span class="PUNC">(</span><span class="NAME">rad</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">bw</span><span class="PUNC">=</span><span class="NAME">Math.cos</span><span class="PUNC">(</span><span class="NAME">rad</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">ax</span><span class="PUNC">*</span><span class="NAME">bw</span><span class="PUNC">-</span><span class="NAME">az</span><span class="PUNC">*</span><span class="NAME">by</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">ay</span><span class="PUNC">*</span><span class="NAME">bw</span><span class="PUNC">+</span><span class="NAME">aw</span><span class="PUNC">*</span><span class="NAME">by</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">az</span><span class="PUNC">*</span><span class="NAME">bw</span><span class="PUNC">+</span><span class="NAME">ax</span><span class="PUNC">*</span><span class="NAME">by</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">aw</span><span class="PUNC">*</span><span class="NAME">bw</span><span class="PUNC">-</span><span class="NAME">ay</span><span class="PUNC">*</span><span class="NAME">by</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">out</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">quat.rotateZ</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">out</span><span class="PUNC">,</span><span class="NAME">a</span><span class="PUNC">,</span><span class="NAME">rad</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">rad</span><span class="PUNC">*</span><span class="PUNC">=</span><span class="PUNC">.</span><span class="NUMB">5</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ax</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">ay</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">az</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">aw</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">bz</span><span class="PUNC">=</span><span class="NAME">Math.sin</span><span class="PUNC">(</span><span class="NAME">rad</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">bw</span><span class="PUNC">=</span><span class="NAME">Math.cos</span><span class="PUNC">(</span><span class="NAME">rad</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">ax</span><span class="PUNC">*</span><span class="NAME">bw</span><span class="PUNC">+</span><span class="NAME">ay</span><span class="PUNC">*</span><span class="NAME">bz</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">ay</span><span class="PUNC">*</span><span class="NAME">bw</span><span class="PUNC">-</span><span class="NAME">ax</span><span class="PUNC">*</span><span class="NAME">bz</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">az</span><span class="PUNC">*</span><span class="NAME">bw</span><span class="PUNC">+</span><span class="NAME">aw</span><span class="PUNC">*</span><span class="NAME">bz</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">aw</span><span class="PUNC">*</span><span class="NAME">bw</span><span class="PUNC">-</span><span class="NAME">az</span><span class="PUNC">*</span><span class="NAME">bz</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">out</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">quat.calculateW</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">out</span><span class="PUNC">,</span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">x</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">y</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">z</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">x</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">y</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">z</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="PUNC">-</span><span class="NAME">Math.sqrt</span><span class="PUNC">(</span><span class="NAME">Math.abs</span><span class="PUNC">(</span><span class="NUMB">1</span><span class="PUNC">-</span><span class="NAME">x</span><span class="PUNC">*</span><span class="NAME">x</span><span class="PUNC">-</span><span class="NAME">y</span><span class="PUNC">*</span><span class="NAME">y</span><span class="PUNC">-</span><span class="NAME">z</span><span class="PUNC">*</span><span class="NAME">z</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">out</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">quat.dot</span><span class="PUNC">=</span><span class="NAME">vec4.dot</span><span class="PUNC">;</span><span class="NAME">quat.lerp</span><span class="PUNC">=</span><span class="NAME">vec4.lerp</span><span class="PUNC">;</span><span class="NAME">quat.slerp</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">out</span><span class="PUNC">,</span><span class="NAME">a</span><span class="PUNC">,</span><span class="NAME">b</span><span class="PUNC">,</span><span class="NAME">t</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ax</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">ay</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">az</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">aw</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">bx</span><span class="PUNC">=</span><span class="NAME">b</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">by</span><span class="PUNC">=</span><span class="NAME">b</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">bz</span><span class="PUNC">=</span><span class="NAME">b</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">bw</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">cosHalfTheta</span><span class="PUNC">=</span><span class="NAME">ax</span><span class="PUNC">*</span><span class="NAME">bx</span><span class="PUNC">+</span><span class="NAME">ay</span><span class="PUNC">*</span><span class="NAME">by</span><span class="PUNC">+</span><span class="NAME">az</span><span class="PUNC">*</span><span class="NAME">bz</span><span class="PUNC">+</span><span class="NAME">aw</span><span class="PUNC">*</span><span class="NAME">bw</span><span class="PUNC">,</span><span class="NAME">halfTheta</span><span class="PUNC">,</span><span class="NAME">sinHalfTheta</span><span class="PUNC">,</span><span class="NAME">ratioA</span><span class="PUNC">,</span><span class="NAME">ratioB</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">Math.abs</span><span class="PUNC">(</span><span class="NAME">cosHalfTheta</span><span class="PUNC">)</span><span class="PUNC">>=</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">out</span><span class="PUNC">!==</span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">ax</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">ay</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">az</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">aw</span><span class="PUNC">}</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">out</span><span class="PUNC">}</span><span class="NAME">halfTheta</span><span class="PUNC">=</span><span class="NAME">Math.acos</span><span class="PUNC">(</span><span class="NAME">cosHalfTheta</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">sinHalfTheta</span><span class="PUNC">=</span><span class="NAME">Math.sqrt</span><span class="PUNC">(</span><span class="NUMB">1</span><span class="PUNC">-</span><span class="NAME">cosHalfTheta</span><span class="PUNC">*</span><span class="NAME">cosHalfTheta</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">Math.abs</span><span class="PUNC">(</span><span class="NAME">sinHalfTheta</span><span class="PUNC">)</span><span class="PUNC">&lt;</span><span class="PUNC">.</span><span class="NUMB">001</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">ax</span><span class="PUNC">*</span><span class="PUNC">.</span><span class="NUMB">5</span><span class="PUNC">+</span><span class="NAME">bx</span><span class="PUNC">*</span><span class="PUNC">.</span><span class="NUMB">5</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">ay</span><span class="PUNC">*</span><span class="PUNC">.</span><span class="NUMB">5</span><span class="PUNC">+</span><span class="NAME">by</span><span class="PUNC">*</span><span class="PUNC">.</span><span class="NUMB">5</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">az</span><span class="PUNC">*</span><span class="PUNC">.</span><span class="NUMB">5</span><span class="PUNC">+</span><span class="NAME">bz</span><span class="PUNC">*</span><span class="PUNC">.</span><span class="NUMB">5</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">aw</span><span class="PUNC">*</span><span class="PUNC">.</span><span class="NUMB">5</span><span class="PUNC">+</span><span class="NAME">bw</span><span class="PUNC">*</span><span class="PUNC">.</span><span class="NUMB">5</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">out</span><span class="PUNC">}</span><span class="NAME">ratioA</span><span class="PUNC">=</span><span class="NAME">Math.sin</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NUMB">1</span><span class="PUNC">-</span><span class="NAME">t</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="NAME">halfTheta</span><span class="PUNC">)</span><span class="PUNC">/</span><span class="NAME">sinHalfTheta</span><span class="PUNC">;</span><span class="NAME">ratioB</span><span class="PUNC">=</span><span class="NAME">Math.sin</span><span class="PUNC">(</span><span class="NAME">t</span><span class="PUNC">*</span><span class="NAME">halfTheta</span><span class="PUNC">)</span><span class="PUNC">/</span><span class="NAME">sinHalfTheta</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">ax</span><span class="PUNC">*</span><span class="NAME">ratioA</span><span class="PUNC">+</span><span class="NAME">bx</span><span class="PUNC">*</span><span class="NAME">ratioB</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">ay</span><span class="PUNC">*</span><span class="NAME">ratioA</span><span class="PUNC">+</span><span class="NAME">by</span><span class="PUNC">*</span><span class="NAME">ratioB</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">az</span><span class="PUNC">*</span><span class="NAME">ratioA</span><span class="PUNC">+</span><span class="NAME">bz</span><span class="PUNC">*</span><span class="NAME">ratioB</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">aw</span><span class="PUNC">*</span><span class="NAME">ratioA</span><span class="PUNC">+</span><span class="NAME">bw</span><span class="PUNC">*</span><span class="NAME">ratioB</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">out</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">quat.invert</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">out</span><span class="PUNC">,</span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">a0</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">a1</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">a2</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">a3</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">dot</span><span class="PUNC">=</span><span class="NAME">a0</span><span class="PUNC">*</span><span class="NAME">a0</span><span class="PUNC">+</span><span class="NAME">a1</span><span class="PUNC">*</span><span class="NAME">a1</span><span class="PUNC">+</span><span class="NAME">a2</span><span class="PUNC">*</span><span class="NAME">a2</span><span class="PUNC">+</span><span class="NAME">a3</span><span class="PUNC">*</span><span class="NAME">a3</span><span class="PUNC">,</span><span class="NAME">invDot</span><span class="PUNC">=</span><span class="NAME">dot</span><span class="PUNC">?</span><span class="NUMB">1</span><span class="PUNC">/</span><span class="NAME">dot</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="PUNC">-</span><span class="NAME">a0</span><span class="PUNC">*</span><span class="NAME">invDot</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="PUNC">-</span><span class="NAME">a1</span><span class="PUNC">*</span><span class="NAME">invDot</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="PUNC">-</span><span class="NAME">a2</span><span class="PUNC">*</span><span class="NAME">invDot</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a3</span><span class="PUNC">*</span><span class="NAME">invDot</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">out</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">quat.conjugate</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">out</span><span class="PUNC">,</span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="PUNC">-</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="PUNC">-</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="PUNC">-</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">out</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">quat.len</span><span class="PUNC">=</span><span class="NAME">quat.length</span><span class="PUNC">=</span><span class="NAME">vec4.length</span><span class="PUNC">;</span><span class="NAME">quat.sqrLen</span><span class="PUNC">=</span><span class="NAME">quat.squaredLength</span><span class="PUNC">=</span><span class="NAME">vec4.squaredLength</span><span class="PUNC">;</span><span class="NAME">quat.normalize</span><span class="PUNC">=</span><span class="NAME">vec4.normalize</span><span class="PUNC">;</span><span class="NAME">quat.str</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="STRN">"quat("</span><span class="PUNC">+</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">+</span><span class="STRN">", "</span><span class="PUNC">+</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">+</span><span class="STRN">", "</span><span class="PUNC">+</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">+</span><span class="STRN">", "</span><span class="PUNC">+</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">+</span><span class="STRN">")"</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">exports</span><span class="PUNC">!==</span><span class="STRN">"undefined"</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">exports.quat</span><span class="PUNC">=</span><span class="NAME">quat</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">(</span><span class="NAME">shim.exports</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NUMB">20</span><span class="PUNC">:</span><span class="PUNC">[</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">require</span><span class="PUNC">,</span><span class="NAME">module</span><span class="PUNC">,</span><span class="NAME">exports</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="PUNC">!</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="PUNC">!</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">root</span><span class="PUNC">=</span><span class="KEYW">this</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">previousUnderscore</span><span class="PUNC">=</span><span class="NAME">root._</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">breaker</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ArrayProto</span><span class="PUNC">=</span><span class="NAME">Array.prototype</span><span class="PUNC">,</span><span class="NAME">ObjProto</span><span class="PUNC">=</span><span class="NAME">Object.prototype</span><span class="PUNC">,</span><span class="NAME">FuncProto</span><span class="PUNC">=</span><span class="NAME">Function.prototype</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">push</span><span class="PUNC">=</span><span class="NAME">ArrayProto.push</span><span class="PUNC">,</span><span class="NAME">slice</span><span class="PUNC">=</span><span class="NAME">ArrayProto.slice</span><span class="PUNC">,</span><span class="NAME">concat</span><span class="PUNC">=</span><span class="NAME">ArrayProto.concat</span><span class="PUNC">,</span><span class="NAME">toString</span><span class="PUNC">=</span><span class="NAME">ObjProto.toString</span><span class="PUNC">,</span><span class="NAME">hasOwnProperty</span><span class="PUNC">=</span><span class="NAME">ObjProto.hasOwnProperty</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">nativeForEach</span><span class="PUNC">=</span><span class="NAME">ArrayProto.forEach</span><span class="PUNC">,</span><span class="NAME">nativeMap</span><span class="PUNC">=</span><span class="NAME">ArrayProto.map</span><span class="PUNC">,</span><span class="NAME">nativeReduce</span><span class="PUNC">=</span><span class="NAME">ArrayProto.reduce</span><span class="PUNC">,</span><span class="NAME">nativeReduceRight</span><span class="PUNC">=</span><span class="NAME">ArrayProto.reduceRight</span><span class="PUNC">,</span><span class="NAME">nativeFilter</span><span class="PUNC">=</span><span class="NAME">ArrayProto.filter</span><span class="PUNC">,</span><span class="NAME">nativeEvery</span><span class="PUNC">=</span><span class="NAME">ArrayProto.every</span><span class="PUNC">,</span><span class="NAME">nativeSome</span><span class="PUNC">=</span><span class="NAME">ArrayProto.some</span><span class="PUNC">,</span><span class="NAME">nativeIndexOf</span><span class="PUNC">=</span><span class="NAME">ArrayProto.indexOf</span><span class="PUNC">,</span><span class="NAME">nativeLastIndexOf</span><span class="PUNC">=</span><span class="NAME">ArrayProto.lastIndexOf</span><span class="PUNC">,</span><span class="NAME">nativeIsArray</span><span class="PUNC">=</span><span class="NAME">Array.isArray</span><span class="PUNC">,</span><span class="NAME">nativeKeys</span><span class="PUNC">=</span><span class="NAME">Object.keys</span><span class="PUNC">,</span><span class="NAME">nativeBind</span><span class="PUNC">=</span><span class="NAME">FuncProto.bind</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">_</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">_</span><span class="PUNC">)</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">obj</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">_</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">_</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this._wrapped</span><span class="PUNC">=</span><span class="NAME">obj</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">exports</span><span class="PUNC">!==</span><span class="STRN">"undefined"</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">module</span><span class="PUNC">!==</span><span class="STRN">"undefined"</span><span class="PUNC">&&</span><span class="NAME">module.exports</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">exports</span><span class="PUNC">=</span><span class="NAME">module.exports</span><span class="PUNC">=</span><span class="NAME">_</span><span class="PUNC">}</span><span class="NAME">exports._</span><span class="PUNC">=</span><span class="NAME">_</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">root._</span><span class="PUNC">=</span><span class="NAME">_</span><span class="PUNC">}</span><span class="NAME">_.VERSION</span><span class="PUNC">=</span><span class="STRN">"1.4.4"</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">each</span><span class="PUNC">=</span><span class="NAME">_.each</span><span class="PUNC">=</span><span class="NAME">_.forEach</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="PUNC">,</span><span class="NAME">iterator</span><span class="PUNC">,</span><span class="NAME">context</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="KEYW">return</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">nativeForEach</span><span class="PUNC">&&</span><span class="NAME">obj.forEach</span><span class="PUNC">===</span><span class="NAME">nativeForEach</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">obj.forEach</span><span class="PUNC">(</span><span class="NAME">iterator</span><span class="PUNC">,</span><span class="NAME">context</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">obj.length</span><span class="PUNC">===</span><span class="PUNC">+</span><span class="NAME">obj.length</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">l</span><span class="PUNC">=</span><span class="NAME">obj.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">l</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">iterator.call</span><span class="PUNC">(</span><span class="NAME">context</span><span class="PUNC">,</span><span class="NAME">obj</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">i</span><span class="PUNC">,</span><span class="NAME">obj</span><span class="PUNC">)</span><span class="PUNC">===</span><span class="NAME">breaker</span><span class="PUNC">)</span><span class="KEYW">return</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">key</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">obj</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">_.has</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="PUNC">,</span><span class="NAME">key</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">iterator.call</span><span class="PUNC">(</span><span class="NAME">context</span><span class="PUNC">,</span><span class="NAME">obj</span><span class="PUNC">[</span><span class="NAME">key</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">key</span><span class="PUNC">,</span><span class="NAME">obj</span><span class="PUNC">)</span><span class="PUNC">===</span><span class="NAME">breaker</span><span class="PUNC">)</span><span class="KEYW">return</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">_.map</span><span class="PUNC">=</span><span class="NAME">_.collect</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="PUNC">,</span><span class="NAME">iterator</span><span class="PUNC">,</span><span class="NAME">context</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">results</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">results</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">nativeMap</span><span class="PUNC">&&</span><span class="NAME">obj.map</span><span class="PUNC">===</span><span class="NAME">nativeMap</span><span class="PUNC">)</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">obj.map</span><span class="PUNC">(</span><span class="NAME">iterator</span><span class="PUNC">,</span><span class="NAME">context</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">each</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="PUNC">,</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">value</span><span class="PUNC">,</span><span class="NAME">index</span><span class="PUNC">,</span><span class="NAME">list</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">results</span><span class="PUNC">[</span><span class="NAME">results.length</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">iterator.call</span><span class="PUNC">(</span><span class="NAME">context</span><span class="PUNC">,</span><span class="NAME">value</span><span class="PUNC">,</span><span class="NAME">index</span><span class="PUNC">,</span><span class="NAME">list</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">results</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">reduceError</span><span class="PUNC">=</span><span class="STRN">"Reduce of empty array with no initial value"</span><span class="PUNC">;</span><span class="NAME">_.reduce</span><span class="PUNC">=</span><span class="NAME">_.foldl</span><span class="PUNC">=</span><span class="NAME">_.inject</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="PUNC">,</span><span class="NAME">iterator</span><span class="PUNC">,</span><span class="NAME">memo</span><span class="PUNC">,</span><span class="NAME">context</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">initial</span><span class="PUNC">=</span><span class="NAME">arguments.length</span><span class="PUNC">></span><span class="NUMB">2</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="NAME">obj</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">nativeReduce</span><span class="PUNC">&&</span><span class="NAME">obj.reduce</span><span class="PUNC">===</span><span class="NAME">nativeReduce</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">context</span><span class="PUNC">)</span><span class="NAME">iterator</span><span class="PUNC">=</span><span class="NAME">_.bind</span><span class="PUNC">(</span><span class="NAME">iterator</span><span class="PUNC">,</span><span class="NAME">context</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">initial</span><span class="PUNC">?</span><span class="NAME">obj.reduce</span><span class="PUNC">(</span><span class="NAME">iterator</span><span class="PUNC">,</span><span class="NAME">memo</span><span class="PUNC">)</span><span class="PUNC">:</span><span class="NAME">obj.reduce</span><span class="PUNC">(</span><span class="NAME">iterator</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="NAME">each</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="PUNC">,</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">value</span><span class="PUNC">,</span><span class="NAME">index</span><span class="PUNC">,</span><span class="NAME">list</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">initial</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">memo</span><span class="PUNC">=</span><span class="NAME">value</span><span class="PUNC">;</span><span class="NAME">initial</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">memo</span><span class="PUNC">=</span><span class="NAME">iterator.call</span><span class="PUNC">(</span><span class="NAME">context</span><span class="PUNC">,</span><span class="NAME">memo</span><span class="PUNC">,</span><span class="NAME">value</span><span class="PUNC">,</span><span class="NAME">index</span><span class="PUNC">,</span><span class="NAME">list</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">initial</span><span class="PUNC">)</span><span class="KEYW">throw</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">TypeError</span><span class="PUNC">(</span><span class="NAME">reduceError</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">memo</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">_.reduceRight</span><span class="PUNC">=</span><span class="NAME">_.foldr</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="PUNC">,</span><span class="NAME">iterator</span><span class="PUNC">,</span><span class="NAME">memo</span><span class="PUNC">,</span><span class="NAME">context</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">initial</span><span class="PUNC">=</span><span class="NAME">arguments.length</span><span class="PUNC">></span><span class="NUMB">2</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="NAME">obj</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">nativeReduceRight</span><span class="PUNC">&&</span><span class="NAME">obj.reduceRight</span><span class="PUNC">===</span><span class="NAME">nativeReduceRight</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">context</span><span class="PUNC">)</span><span class="NAME">iterator</span><span class="PUNC">=</span><span class="NAME">_.bind</span><span class="PUNC">(</span><span class="NAME">iterator</span><span class="PUNC">,</span><span class="NAME">context</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">initial</span><span class="PUNC">?</span><span class="NAME">obj.reduceRight</span><span class="PUNC">(</span><span class="NAME">iterator</span><span class="PUNC">,</span><span class="NAME">memo</span><span class="PUNC">)</span><span class="PUNC">:</span><span class="NAME">obj.reduceRight</span><span class="PUNC">(</span><span class="NAME">iterator</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">length</span><span class="PUNC">=</span><span class="NAME">obj.length</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">length</span><span class="PUNC">!==</span><span class="PUNC">+</span><span class="NAME">length</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">keys</span><span class="PUNC">=</span><span class="NAME">_.keys</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">length</span><span class="PUNC">=</span><span class="NAME">keys.length</span><span class="PUNC">}</span><span class="NAME">each</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="PUNC">,</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">value</span><span class="PUNC">,</span><span class="NAME">index</span><span class="PUNC">,</span><span class="NAME">list</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">index</span><span class="PUNC">=</span><span class="NAME">keys</span><span class="PUNC">?</span><span class="NAME">keys</span><span class="PUNC">[</span><span class="PUNC">--</span><span class="NAME">length</span><span class="PUNC">]</span><span class="PUNC">:</span><span class="PUNC">--</span><span class="NAME">length</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">initial</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">memo</span><span class="PUNC">=</span><span class="NAME">obj</span><span class="PUNC">[</span><span class="NAME">index</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">initial</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">memo</span><span class="PUNC">=</span><span class="NAME">iterator.call</span><span class="PUNC">(</span><span class="NAME">context</span><span class="PUNC">,</span><span class="NAME">memo</span><span class="PUNC">,</span><span class="NAME">obj</span><span class="PUNC">[</span><span class="NAME">index</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">index</span><span class="PUNC">,</span><span class="NAME">list</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">initial</span><span class="PUNC">)</span><span class="KEYW">throw</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">TypeError</span><span class="PUNC">(</span><span class="NAME">reduceError</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">memo</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">_.find</span><span class="PUNC">=</span><span class="NAME">_.detect</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="PUNC">,</span><span class="NAME">iterator</span><span class="PUNC">,</span><span class="NAME">context</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">result</span><span class="PUNC">;</span><span class="NAME">any</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="PUNC">,</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">value</span><span class="PUNC">,</span><span class="NAME">index</span><span class="PUNC">,</span><span class="NAME">list</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">iterator.call</span><span class="PUNC">(</span><span class="NAME">context</span><span class="PUNC">,</span><span class="NAME">value</span><span class="PUNC">,</span><span class="NAME">index</span><span class="PUNC">,</span><span class="NAME">list</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">result</span><span class="PUNC">=</span><span class="NAME">value</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">result</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">_.filter</span><span class="PUNC">=</span><span class="NAME">_.select</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="PUNC">,</span><span class="NAME">iterator</span><span class="PUNC">,</span><span class="NAME">context</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">results</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">results</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">nativeFilter</span><span class="PUNC">&&</span><span class="NAME">obj.filter</span><span class="PUNC">===</span><span class="NAME">nativeFilter</span><span class="PUNC">)</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">obj.filter</span><span class="PUNC">(</span><span class="NAME">iterator</span><span class="PUNC">,</span><span class="NAME">context</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">each</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="PUNC">,</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">value</span><span class="PUNC">,</span><span class="NAME">index</span><span class="PUNC">,</span><span class="NAME">list</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">iterator.call</span><span class="PUNC">(</span><span class="NAME">context</span><span class="PUNC">,</span><span class="NAME">value</span><span class="PUNC">,</span><span class="NAME">index</span><span class="PUNC">,</span><span class="NAME">list</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="NAME">results</span><span class="PUNC">[</span><span class="NAME">results.length</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">value</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">results</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">_.reject</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="PUNC">,</span><span class="NAME">iterator</span><span class="PUNC">,</span><span class="NAME">context</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">_.filter</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="PUNC">,</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">value</span><span class="PUNC">,</span><span class="NAME">index</span><span class="PUNC">,</span><span class="NAME">list</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="PUNC">!</span><span class="NAME">iterator.call</span><span class="PUNC">(</span><span class="NAME">context</span><span class="PUNC">,</span><span class="NAME">value</span><span class="PUNC">,</span><span class="NAME">index</span><span class="PUNC">,</span><span class="NAME">list</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">context</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">_.every</span><span class="PUNC">=</span><span class="NAME">_.all</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="PUNC">,</span><span class="NAME">iterator</span><span class="PUNC">,</span><span class="NAME">context</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">iterator</span><span class="PUNC">||</span><span class="PUNC">(</span><span class="NAME">iterator</span><span class="PUNC">=</span><span class="NAME">_.identity</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">result</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">result</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">nativeEvery</span><span class="PUNC">&&</span><span class="NAME">obj.every</span><span class="PUNC">===</span><span class="NAME">nativeEvery</span><span class="PUNC">)</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">obj.every</span><span class="PUNC">(</span><span class="NAME">iterator</span><span class="PUNC">,</span><span class="NAME">context</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">each</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="PUNC">,</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">value</span><span class="PUNC">,</span><span class="NAME">index</span><span class="PUNC">,</span><span class="NAME">list</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="PUNC">(</span><span class="NAME">result</span><span class="PUNC">=</span><span class="NAME">result</span><span class="PUNC">&&</span><span class="NAME">iterator.call</span><span class="PUNC">(</span><span class="NAME">context</span><span class="PUNC">,</span><span class="NAME">value</span><span class="PUNC">,</span><span class="NAME">index</span><span class="PUNC">,</span><span class="NAME">list</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">breaker</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="PUNC">!</span><span class="PUNC">!</span><span class="NAME">result</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">any</span><span class="PUNC">=</span><span class="NAME">_.some</span><span class="PUNC">=</span><span class="NAME">_.any</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="PUNC">,</span><span class="NAME">iterator</span><span class="PUNC">,</span><span class="NAME">context</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">iterator</span><span class="PUNC">||</span><span class="PUNC">(</span><span class="NAME">iterator</span><span class="PUNC">=</span><span class="NAME">_.identity</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">result</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">result</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">nativeSome</span><span class="PUNC">&&</span><span class="NAME">obj.some</span><span class="PUNC">===</span><span class="NAME">nativeSome</span><span class="PUNC">)</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">obj.some</span><span class="PUNC">(</span><span class="NAME">iterator</span><span class="PUNC">,</span><span class="NAME">context</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">each</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="PUNC">,</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">value</span><span class="PUNC">,</span><span class="NAME">index</span><span class="PUNC">,</span><span class="NAME">list</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">result</span><span class="PUNC">||</span><span class="PUNC">(</span><span class="NAME">result</span><span class="PUNC">=</span><span class="NAME">iterator.call</span><span class="PUNC">(</span><span class="NAME">context</span><span class="PUNC">,</span><span class="NAME">value</span><span class="PUNC">,</span><span class="NAME">index</span><span class="PUNC">,</span><span class="NAME">list</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">breaker</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="PUNC">!</span><span class="PUNC">!</span><span class="NAME">result</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">_.contains</span><span class="PUNC">=</span><span class="NAME">_.include</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="PUNC">,</span><span class="NAME">target</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">nativeIndexOf</span><span class="PUNC">&&</span><span class="NAME">obj.indexOf</span><span class="PUNC">===</span><span class="NAME">nativeIndexOf</span><span class="PUNC">)</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">obj.indexOf</span><span class="PUNC">(</span><span class="NAME">target</span><span class="PUNC">)</span><span class="PUNC">!=</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">any</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="PUNC">,</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">value</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">value</span><span class="PUNC">===</span><span class="NAME">target</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">_.invoke</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="PUNC">,</span><span class="NAME">method</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">args</span><span class="PUNC">=</span><span class="NAME">slice.call</span><span class="PUNC">(</span><span class="NAME">arguments</span><span class="PUNC">,</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">isFunc</span><span class="PUNC">=</span><span class="NAME">_.isFunction</span><span class="PUNC">(</span><span class="NAME">method</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">_.map</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="PUNC">,</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">value</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="PUNC">(</span><span class="NAME">isFunc</span><span class="PUNC">?</span><span class="NAME">method</span><span class="PUNC">:</span><span class="NAME">value</span><span class="PUNC">[</span><span class="NAME">method</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">apply</span><span class="PUNC">(</span><span class="NAME">value</span><span class="PUNC">,</span><span class="NAME">args</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">_.pluck</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="PUNC">,</span><span class="NAME">key</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">_.map</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="PUNC">,</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">value</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">value</span><span class="PUNC">[</span><span class="NAME">key</span><span class="PUNC">]</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">_.where</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="PUNC">,</span><span class="NAME">attrs</span><span class="PUNC">,</span><span class="NAME">first</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">_.isEmpty</span><span class="PUNC">(</span><span class="NAME">attrs</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">first</span><span class="PUNC">?</span><span class="KEYW">null</span><span class="PUNC">:</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">_</span><span class="PUNC">[</span><span class="NAME">first</span><span class="PUNC">?</span><span class="STRN">"find"</span><span class="PUNC">:</span><span class="STRN">"filter"</span><span class="PUNC">]</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="PUNC">,</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">value</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">key</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">attrs</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">attrs</span><span class="PUNC">[</span><span class="NAME">key</span><span class="PUNC">]</span><span class="PUNC">!==</span><span class="NAME">value</span><span class="PUNC">[</span><span class="NAME">key</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">}</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">_.findWhere</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="PUNC">,</span><span class="NAME">attrs</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">_.where</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="PUNC">,</span><span class="NAME">attrs</span><span class="PUNC">,</span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">_.max</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="PUNC">,</span><span class="NAME">iterator</span><span class="PUNC">,</span><span class="NAME">context</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">iterator</span><span class="PUNC">&&</span><span class="NAME">_.isArray</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="NAME">obj</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">===</span><span class="PUNC">+</span><span class="NAME">obj</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">&&</span><span class="NAME">obj.length</span><span class="PUNC">&lt;</span><span class="NUMB">65535</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">Math.max.apply</span><span class="PUNC">(</span><span class="NAME">Math</span><span class="PUNC">,</span><span class="NAME">obj</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">iterator</span><span class="PUNC">&&</span><span class="NAME">_.isEmpty</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="KEYW">return</span><span class="PUNC">-</span><span class="NAME">Infinity</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">result</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="NAME">computed</span><span class="PUNC">:</span><span class="PUNC">-</span><span class="NAME">Infinity</span><span class="PUNC">,</span><span class="NAME">value</span><span class="PUNC">:</span><span class="PUNC">-</span><span class="NAME">Infinity</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">each</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="PUNC">,</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">value</span><span class="PUNC">,</span><span class="NAME">index</span><span class="PUNC">,</span><span class="NAME">list</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">computed</span><span class="PUNC">=</span><span class="NAME">iterator</span><span class="PUNC">?</span><span class="NAME">iterator.call</span><span class="PUNC">(</span><span class="NAME">context</span><span class="PUNC">,</span><span class="NAME">value</span><span class="PUNC">,</span><span class="NAME">index</span><span class="PUNC">,</span><span class="NAME">list</span><span class="PUNC">)</span><span class="PUNC">:</span><span class="NAME">value</span><span class="PUNC">;</span><span class="NAME">computed</span><span class="PUNC">>=</span><span class="NAME">result.computed</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="NAME">result</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="NAME">value</span><span class="PUNC">:</span><span class="NAME">value</span><span class="PUNC">,</span><span class="NAME">computed</span><span class="PUNC">:</span><span class="NAME">computed</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">result.value</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">_.min</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="PUNC">,</span><span class="NAME">iterator</span><span class="PUNC">,</span><span class="NAME">context</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">iterator</span><span class="PUNC">&&</span><span class="NAME">_.isArray</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="NAME">obj</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">===</span><span class="PUNC">+</span><span class="NAME">obj</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">&&</span><span class="NAME">obj.length</span><span class="PUNC">&lt;</span><span class="NUMB">65535</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">Math.min.apply</span><span class="PUNC">(</span><span class="NAME">Math</span><span class="PUNC">,</span><span class="NAME">obj</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">iterator</span><span class="PUNC">&&</span><span class="NAME">_.isEmpty</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">Infinity</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">result</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="NAME">computed</span><span class="PUNC">:</span><span class="NAME">Infinity</span><span class="PUNC">,</span><span class="NAME">value</span><span class="PUNC">:</span><span class="NAME">Infinity</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">each</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="PUNC">,</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">value</span><span class="PUNC">,</span><span class="NAME">index</span><span class="PUNC">,</span><span class="NAME">list</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">computed</span><span class="PUNC">=</span><span class="NAME">iterator</span><span class="PUNC">?</span><span class="NAME">iterator.call</span><span class="PUNC">(</span><span class="NAME">context</span><span class="PUNC">,</span><span class="NAME">value</span><span class="PUNC">,</span><span class="NAME">index</span><span class="PUNC">,</span><span class="NAME">list</span><span class="PUNC">)</span><span class="PUNC">:</span><span class="NAME">value</span><span class="PUNC">;</span><span class="NAME">computed</span><span class="PUNC">&lt;</span><span class="NAME">result.computed</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="NAME">result</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="NAME">value</span><span class="PUNC">:</span><span class="NAME">value</span><span class="PUNC">,</span><span class="NAME">computed</span><span class="PUNC">:</span><span class="NAME">computed</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">result.value</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">_.shuffle</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">rand</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">index</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">shuffled</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">each</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="PUNC">,</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">value</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">rand</span><span class="PUNC">=</span><span class="NAME">_.random</span><span class="PUNC">(</span><span class="NAME">index</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">shuffled</span><span class="PUNC">[</span><span class="NAME">index</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">shuffled</span><span class="PUNC">[</span><span class="NAME">rand</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">shuffled</span><span class="PUNC">[</span><span class="NAME">rand</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">value</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">shuffled</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">lookupIterator</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">value</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">_.isFunction</span><span class="PUNC">(</span><span class="NAME">value</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="NAME">value</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">obj</span><span class="PUNC">[</span><span class="NAME">value</span><span class="PUNC">]</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">_.sortBy</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="PUNC">,</span><span class="NAME">value</span><span class="PUNC">,</span><span class="NAME">context</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">iterator</span><span class="PUNC">=</span><span class="NAME">lookupIterator</span><span class="PUNC">(</span><span class="NAME">value</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">_.pluck</span><span class="PUNC">(</span><span class="NAME">_.map</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="PUNC">,</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">value</span><span class="PUNC">,</span><span class="NAME">index</span><span class="PUNC">,</span><span class="NAME">list</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="PUNC">{</span><span class="NAME">value</span><span class="PUNC">:</span><span class="NAME">value</span><span class="PUNC">,</span><span class="NAME">index</span><span class="PUNC">:</span><span class="NAME">index</span><span class="PUNC">,</span><span class="NAME">criteria</span><span class="PUNC">:</span><span class="NAME">iterator.call</span><span class="PUNC">(</span><span class="NAME">context</span><span class="PUNC">,</span><span class="NAME">value</span><span class="PUNC">,</span><span class="NAME">index</span><span class="PUNC">,</span><span class="NAME">list</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">sort</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">left</span><span class="PUNC">,</span><span class="NAME">right</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">a</span><span class="PUNC">=</span><span class="NAME">left.criteria</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>  3</span> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">b</span><span class="PUNC">=</span><span class="NAME">right.criteria</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">!==</span><span class="NAME">b</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">></span><span class="NAME">b</span><span class="PUNC">||</span><span class="NAME">a</span><span class="PUNC">===</span><span class="KEYW">void</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">&lt;</span><span class="NAME">b</span><span class="PUNC">||</span><span class="NAME">b</span><span class="PUNC">===</span><span class="KEYW">void</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="KEYW">return</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">}</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">left.index</span><span class="PUNC">&lt;</span><span class="NAME">right.index</span><span class="PUNC">?</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">:</span><span class="NUMB">1</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="STRN">"value"</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">group</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="PUNC">,</span><span class="NAME">value</span><span class="PUNC">,</span><span class="NAME">context</span><span class="PUNC">,</span><span class="NAME">behavior</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">result</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">iterator</span><span class="PUNC">=</span><span class="NAME">lookupIterator</span><span class="PUNC">(</span><span class="NAME">value</span><span class="PUNC">||</span><span class="NAME">_.identity</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">each</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="PUNC">,</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">value</span><span class="PUNC">,</span><span class="NAME">index</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">key</span><span class="PUNC">=</span><span class="NAME">iterator.call</span><span class="PUNC">(</span><span class="NAME">context</span><span class="PUNC">,</span><span class="NAME">value</span><span class="PUNC">,</span><span class="NAME">index</span><span class="PUNC">,</span><span class="NAME">obj</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">behavior</span><span class="PUNC">(</span><span class="NAME">result</span><span class="PUNC">,</span><span class="NAME">key</span><span class="PUNC">,</span><span class="NAME">value</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">result</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">_.groupBy</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="PUNC">,</span><span class="NAME">value</span><span class="PUNC">,</span><span class="NAME">context</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">group</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="PUNC">,</span><span class="NAME">value</span><span class="PUNC">,</span><span class="NAME">context</span><span class="PUNC">,</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">result</span><span class="PUNC">,</span><span class="NAME">key</span><span class="PUNC">,</span><span class="NAME">value</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="PUNC">(</span><span class="NAME">_.has</span><span class="PUNC">(</span><span class="NAME">result</span><span class="PUNC">,</span><span class="NAME">key</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="NAME">result</span><span class="PUNC">[</span><span class="NAME">key</span><span class="PUNC">]</span><span class="PUNC">:</span><span class="NAME">result</span><span class="PUNC">[</span><span class="NAME">key</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">push</span><span class="PUNC">(</span><span class="NAME">value</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">_.countBy</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="PUNC">,</span><span class="NAME">value</span><span class="PUNC">,</span><span class="NAME">context</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">group</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="PUNC">,</span><span class="NAME">value</span><span class="PUNC">,</span><span class="NAME">context</span><span class="PUNC">,</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">result</span><span class="PUNC">,</span><span class="NAME">key</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">_.has</span><span class="PUNC">(</span><span class="NAME">result</span><span class="PUNC">,</span><span class="NAME">key</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="NAME">result</span><span class="PUNC">[</span><span class="NAME">key</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">result</span><span class="PUNC">[</span><span class="NAME">key</span><span class="PUNC">]</span><span class="PUNC">++</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">_.sortedIndex</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">array</span><span class="PUNC">,</span><span class="NAME">obj</span><span class="PUNC">,</span><span class="NAME">iterator</span><span class="PUNC">,</span><span class="NAME">context</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">iterator</span><span class="PUNC">=</span><span class="NAME">iterator</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">?</span><span class="NAME">_.identity</span><span class="PUNC">:</span><span class="NAME">lookupIterator</span><span class="PUNC">(</span><span class="NAME">iterator</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">value</span><span class="PUNC">=</span><span class="NAME">iterator.call</span><span class="PUNC">(</span><span class="NAME">context</span><span class="PUNC">,</span><span class="NAME">obj</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">low</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">high</span><span class="PUNC">=</span><span class="NAME">array.length</span><span class="PUNC">;</span><span class="KEYW">while</span><span class="PUNC">(</span><span class="NAME">low</span><span class="PUNC">&lt;</span><span class="NAME">high</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">mid</span><span class="PUNC">=</span><span class="NAME">low</span><span class="PUNC">+</span><span class="NAME">high</span><span class="PUNC">>>></span><span class="NUMB">1</span><span class="PUNC">;</span><span class="NAME">iterator.call</span><span class="PUNC">(</span><span class="NAME">context</span><span class="PUNC">,</span><span class="NAME">array</span><span class="PUNC">[</span><span class="NAME">mid</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">&lt;</span><span class="NAME">value</span><span class="PUNC">?</span><span class="NAME">low</span><span class="PUNC">=</span><span class="NAME">mid</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">:</span><span class="NAME">high</span><span class="PUNC">=</span><span class="NAME">mid</span><span class="PUNC">}</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">low</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">_.toArray</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">obj</span><span class="PUNC">)</span><span class="KEYW">return</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">_.isArray</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">slice.call</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">obj.length</span><span class="PUNC">===</span><span class="PUNC">+</span><span class="NAME">obj.length</span><span class="PUNC">)</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">_.map</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="PUNC">,</span><span class="NAME">_.identity</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">_.values</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">_.size</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">obj.length</span><span class="PUNC">===</span><span class="PUNC">+</span><span class="NAME">obj.length</span><span class="PUNC">?</span><span class="NAME">obj.length</span><span class="PUNC">:</span><span class="NAME">_.keys</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">length</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">_.first</span><span class="PUNC">=</span><span class="NAME">_.head</span><span class="PUNC">=</span><span class="NAME">_.take</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">array</span><span class="PUNC">,</span><span class="NAME">n</span><span class="PUNC">,</span><span class="NAME">guard</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">array</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">void</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">n</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">&&</span><span class="PUNC">!</span><span class="NAME">guard</span><span class="PUNC">?</span><span class="NAME">slice.call</span><span class="PUNC">(</span><span class="NAME">array</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">n</span><span class="PUNC">)</span><span class="PUNC">:</span><span class="NAME">array</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">_.initial</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">array</span><span class="PUNC">,</span><span class="NAME">n</span><span class="PUNC">,</span><span class="NAME">guard</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">slice.call</span><span class="PUNC">(</span><span class="NAME">array</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">array.length</span><span class="PUNC">-</span><span class="PUNC">(</span><span class="NAME">n</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">||</span><span class="NAME">guard</span><span class="PUNC">?</span><span class="NUMB">1</span><span class="PUNC">:</span><span class="NAME">n</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">_.last</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">array</span><span class="PUNC">,</span><span class="NAME">n</span><span class="PUNC">,</span><span class="NAME">guard</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">array</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">void</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">n</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">&&</span><span class="PUNC">!</span><span class="NAME">guard</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">slice.call</span><span class="PUNC">(</span><span class="NAME">array</span><span class="PUNC">,</span><span class="NAME">Math.max</span><span class="PUNC">(</span><span class="NAME">array.length</span><span class="PUNC">-</span><span class="NAME">n</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">array</span><span class="PUNC">[</span><span class="NAME">array.length</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">_.rest</span><span class="PUNC">=</span><span class="NAME">_.tail</span><span class="PUNC">=</span><span class="NAME">_.drop</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">array</span><span class="PUNC">,</span><span class="NAME">n</span><span class="PUNC">,</span><span class="NAME">guard</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">slice.call</span><span class="PUNC">(</span><span class="NAME">array</span><span class="PUNC">,</span><span class="NAME">n</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">||</span><span class="NAME">guard</span><span class="PUNC">?</span><span class="NUMB">1</span><span class="PUNC">:</span><span class="NAME">n</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">_.compact</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">array</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">_.filter</span><span class="PUNC">(</span><span class="NAME">array</span><span class="PUNC">,</span><span class="NAME">_.identity</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">flatten</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">input</span><span class="PUNC">,</span><span class="NAME">shallow</span><span class="PUNC">,</span><span class="NAME">output</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">each</span><span class="PUNC">(</span><span class="NAME">input</span><span class="PUNC">,</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">value</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">_.isArray</span><span class="PUNC">(</span><span class="NAME">value</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">shallow</span><span class="PUNC">?</span><span class="NAME">push.apply</span><span class="PUNC">(</span><span class="NAME">output</span><span class="PUNC">,</span><span class="NAME">value</span><span class="PUNC">)</span><span class="PUNC">:</span><span class="NAME">flatten</span><span class="PUNC">(</span><span class="NAME">value</span><span class="PUNC">,</span><span class="NAME">shallow</span><span class="PUNC">,</span><span class="NAME">output</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">output.push</span><span class="PUNC">(</span><span class="NAME">value</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">output</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">_.flatten</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">array</span><span class="PUNC">,</span><span class="NAME">shallow</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">flatten</span><span class="PUNC">(</span><span class="NAME">array</span><span class="PUNC">,</span><span class="NAME">shallow</span><span class="PUNC">,</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">_.without</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">array</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">_.difference</span><span class="PUNC">(</span><span class="NAME">array</span><span class="PUNC">,</span><span class="NAME">slice.call</span><span class="PUNC">(</span><span class="NAME">arguments</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">_.uniq</span><span class="PUNC">=</span><span class="NAME">_.unique</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">array</span><span class="PUNC">,</span><span class="NAME">isSorted</span><span class="PUNC">,</span><span class="NAME">iterator</span><span class="PUNC">,</span><span class="NAME">context</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">_.isFunction</span><span class="PUNC">(</span><span class="NAME">isSorted</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">context</span><span class="PUNC">=</span><span class="NAME">iterator</span><span class="PUNC">;</span><span class="NAME">iterator</span><span class="PUNC">=</span><span class="NAME">isSorted</span><span class="PUNC">;</span><span class="NAME">isSorted</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">}</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">initial</span><span class="PUNC">=</span><span class="NAME">iterator</span><span class="PUNC">?</span><span class="NAME">_.map</span><span class="PUNC">(</span><span class="NAME">array</span><span class="PUNC">,</span><span class="NAME">iterator</span><span class="PUNC">,</span><span class="NAME">context</span><span class="PUNC">)</span><span class="PUNC">:</span><span class="NAME">array</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">results</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">seen</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">each</span><span class="PUNC">(</span><span class="NAME">initial</span><span class="PUNC">,</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">value</span><span class="PUNC">,</span><span class="NAME">index</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">isSorted</span><span class="PUNC">?</span><span class="PUNC">!</span><span class="NAME">index</span><span class="PUNC">||</span><span class="NAME">seen</span><span class="PUNC">[</span><span class="NAME">seen.length</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">!==</span><span class="NAME">value</span><span class="PUNC">:</span><span class="PUNC">!</span><span class="NAME">_.contains</span><span class="PUNC">(</span><span class="NAME">seen</span><span class="PUNC">,</span><span class="NAME">value</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">seen.push</span><span class="PUNC">(</span><span class="NAME">value</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">results.push</span><span class="PUNC">(</span><span class="NAME">array</span><span class="PUNC">[</span><span class="NAME">index</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">results</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">_.union</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">_.uniq</span><span class="PUNC">(</span><span class="NAME">concat.apply</span><span class="PUNC">(</span><span class="NAME">ArrayProto</span><span class="PUNC">,</span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">_.intersection</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">array</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">rest</span><span class="PUNC">=</span><span class="NAME">slice.call</span><span class="PUNC">(</span><span class="NAME">arguments</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">_.filter</span><span class="PUNC">(</span><span class="NAME">_.uniq</span><span class="PUNC">(</span><span class="NAME">array</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">item</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">_.every</span><span class="PUNC">(</span><span class="NAME">rest</span><span class="PUNC">,</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">other</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">_.indexOf</span><span class="PUNC">(</span><span class="NAME">other</span><span class="PUNC">,</span><span class="NAME">item</span><span class="PUNC">)</span><span class="PUNC">>=</span><span class="NUMB">0</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">_.difference</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">array</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">rest</span><span class="PUNC">=</span><span class="NAME">concat.apply</span><span class="PUNC">(</span><span class="NAME">ArrayProto</span><span class="PUNC">,</span><span class="NAME">slice.call</span><span class="PUNC">(</span><span class="NAME">arguments</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">_.filter</span><span class="PUNC">(</span><span class="NAME">array</span><span class="PUNC">,</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">value</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="PUNC">!</span><span class="NAME">_.contains</span><span class="PUNC">(</span><span class="NAME">rest</span><span class="PUNC">,</span><span class="NAME">value</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">_.zip</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">args</span><span class="PUNC">=</span><span class="NAME">slice.call</span><span class="PUNC">(</span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">length</span><span class="PUNC">=</span><span class="NAME">_.max</span><span class="PUNC">(</span><span class="NAME">_.pluck</span><span class="PUNC">(</span><span class="NAME">args</span><span class="PUNC">,</span><span class="STRN">"length"</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">results</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">(</span><span class="NAME">length</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">results</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">_.pluck</span><span class="PUNC">(</span><span class="NAME">args</span><span class="PUNC">,</span><span class="STRN">""</span><span class="PUNC">+</span><span class="NAME">i</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">results</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">_.object</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">list</span><span class="PUNC">,</span><span class="NAME">values</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">list</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="KEYW">return</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">result</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">l</span><span class="PUNC">=</span><span class="NAME">list.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">l</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">values</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">result</span><span class="PUNC">[</span><span class="NAME">list</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">values</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">result</span><span class="PUNC">[</span><span class="NAME">list</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">list</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">result</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">_.indexOf</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">array</span><span class="PUNC">,</span><span class="NAME">item</span><span class="PUNC">,</span><span class="NAME">isSorted</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">array</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="KEYW">return</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">l</span><span class="PUNC">=</span><span class="NAME">array.length</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">isSorted</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">isSorted</span><span class="PUNC">==</span><span class="STRN">"number"</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">i</span><span class="PUNC">=</span><span class="NAME">isSorted</span><span class="PUNC">&lt;</span><span class="NUMB">0</span><span class="PUNC">?</span><span class="NAME">Math.max</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">l</span><span class="PUNC">+</span><span class="NAME">isSorted</span><span class="PUNC">)</span><span class="PUNC">:</span><span class="NAME">isSorted</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">i</span><span class="PUNC">=</span><span class="NAME">_.sortedIndex</span><span class="PUNC">(</span><span class="NAME">array</span><span class="PUNC">,</span><span class="NAME">item</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">array</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">===</span><span class="NAME">item</span><span class="PUNC">?</span><span class="NAME">i</span><span class="PUNC">:</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">nativeIndexOf</span><span class="PUNC">&&</span><span class="NAME">array.indexOf</span><span class="PUNC">===</span><span class="NAME">nativeIndexOf</span><span class="PUNC">)</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">array.indexOf</span><span class="PUNC">(</span><span class="NAME">item</span><span class="PUNC">,</span><span class="NAME">isSorted</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">l</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">array</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">===</span><span class="NAME">item</span><span class="PUNC">)</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">_.lastIndexOf</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">array</span><span class="PUNC">,</span><span class="NAME">item</span><span class="PUNC">,</span><span class="NAME">from</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">array</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="KEYW">return</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">hasIndex</span><span class="PUNC">=</span><span class="NAME">from</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">nativeLastIndexOf</span><span class="PUNC">&&</span><span class="NAME">array.lastIndexOf</span><span class="PUNC">===</span><span class="NAME">nativeLastIndexOf</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">hasIndex</span><span class="PUNC">?</span><span class="NAME">array.lastIndexOf</span><span class="PUNC">(</span><span class="NAME">item</span><span class="PUNC">,</span><span class="NAME">from</span><span class="PUNC">)</span><span class="PUNC">:</span><span class="NAME">array.lastIndexOf</span><span class="PUNC">(</span><span class="NAME">item</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NAME">hasIndex</span><span class="PUNC">?</span><span class="NAME">from</span><span class="PUNC">:</span><span class="NAME">array.length</span><span class="PUNC">;</span><span class="KEYW">while</span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">--</span><span class="PUNC">)</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">array</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">===</span><span class="NAME">item</span><span class="PUNC">)</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">_.range</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">start</span><span class="PUNC">,</span><span class="NAME">stop</span><span class="PUNC">,</span><span class="NAME">step</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">arguments.length</span><span class="PUNC">&lt;=</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">stop</span><span class="PUNC">=</span><span class="NAME">start</span><span class="PUNC">||</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">start</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">}</span><span class="NAME">step</span><span class="PUNC">=</span><span class="NAME">arguments</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">||</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">len</span><span class="PUNC">=</span><span class="NAME">Math.max</span><span class="PUNC">(</span><span class="NAME">Math.ceil</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">stop</span><span class="PUNC">-</span><span class="NAME">start</span><span class="PUNC">)</span><span class="PUNC">/</span><span class="NAME">step</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">range</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">(</span><span class="NAME">len</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">while</span><span class="PUNC">(</span><span class="NAME">idx</span><span class="PUNC">&lt;</span><span class="NAME">len</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">range</span><span class="PUNC">[</span><span class="NAME">idx</span><span class="PUNC">++</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">start</span><span class="PUNC">;</span><span class="NAME">start</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="NAME">step</span><span class="PUNC">}</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">range</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">_.bind</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">func</span><span class="PUNC">,</span><span class="NAME">context</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">func.bind</span><span class="PUNC">===</span><span class="NAME">nativeBind</span><span class="PUNC">&&</span><span class="NAME">nativeBind</span><span class="PUNC">)</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">nativeBind.apply</span><span class="PUNC">(</span><span class="NAME">func</span><span class="PUNC">,</span><span class="NAME">slice.call</span><span class="PUNC">(</span><span class="NAME">arguments</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">args</span><span class="PUNC">=</span><span class="NAME">slice.call</span><span class="PUNC">(</span><span class="NAME">arguments</span><span class="PUNC">,</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">func.apply</span><span class="PUNC">(</span><span class="NAME">context</span><span class="PUNC">,</span><span class="NAME">args.concat</span><span class="PUNC">(</span><span class="NAME">slice.call</span><span class="PUNC">(</span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">_.partial</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">func</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">args</span><span class="PUNC">=</span><span class="NAME">slice.call</span><span class="PUNC">(</span><span class="NAME">arguments</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">func.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">args.concat</span><span class="PUNC">(</span><span class="NAME">slice.call</span><span class="PUNC">(</span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">_.bindAll</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">funcs</span><span class="PUNC">=</span><span class="NAME">slice.call</span><span class="PUNC">(</span><span class="NAME">arguments</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">funcs.length</span><span class="PUNC">===</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="NAME">funcs</span><span class="PUNC">=</span><span class="NAME">_.functions</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">each</span><span class="PUNC">(</span><span class="NAME">funcs</span><span class="PUNC">,</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">f</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">obj</span><span class="PUNC">[</span><span class="NAME">f</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">_.bind</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="PUNC">[</span><span class="NAME">f</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">obj</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">obj</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">_.memoize</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">func</span><span class="PUNC">,</span><span class="NAME">hasher</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">memo</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">hasher</span><span class="PUNC">||</span><span class="PUNC">(</span><span class="NAME">hasher</span><span class="PUNC">=</span><span class="NAME">_.identity</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">key</span><span class="PUNC">=</span><span class="NAME">hasher.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">_.has</span><span class="PUNC">(</span><span class="NAME">memo</span><span class="PUNC">,</span><span class="NAME">key</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="NAME">memo</span><span class="PUNC">[</span><span class="NAME">key</span><span class="PUNC">]</span><span class="PUNC">:</span><span class="NAME">memo</span><span class="PUNC">[</span><span class="NAME">key</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">func.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">_.delay</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">func</span><span class="PUNC">,</span><span class="NAME">wait</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">args</span><span class="PUNC">=</span><span class="NAME">slice.call</span><span class="PUNC">(</span><span class="NAME">arguments</span><span class="PUNC">,</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">setTimeout</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">func.apply</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">args</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">wait</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">_.defer</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">func</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">_.delay.apply</span><span class="PUNC">(</span><span class="NAME">_</span><span class="PUNC">,</span><span class="PUNC">[</span><span class="NAME">func</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">concat</span><span class="PUNC">(</span><span class="NAME">slice.call</span><span class="PUNC">(</span><span class="NAME">arguments</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">_.throttle</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">func</span><span class="PUNC">,</span><span class="NAME">wait</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">context</span><span class="PUNC">,</span><span class="NAME">args</span><span class="PUNC">,</span><span class="NAME">timeout</span><span class="PUNC">,</span><span class="NAME">result</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">previous</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">later</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">previous</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Date</span><span class="PUNC">;</span><span class="NAME">timeout</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="NAME">result</span><span class="PUNC">=</span><span class="NAME">func.apply</span><span class="PUNC">(</span><span class="NAME">context</span><span class="PUNC">,</span><span class="NAME">args</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">now</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Date</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">remaining</span><span class="PUNC">=</span><span class="NAME">wait</span><span class="PUNC">-</span><span class="PUNC">(</span><span class="NAME">now</span><span class="PUNC">-</span><span class="NAME">previous</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">context</span><span class="PUNC">=</span><span class="KEYW">this</span><span class="PUNC">;</span><span class="NAME">args</span><span class="PUNC">=</span><span class="NAME">arguments</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">remaining</span><span class="PUNC">&lt;=</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">clearTimeout</span><span class="PUNC">(</span><span class="NAME">timeout</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">timeout</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="NAME">previous</span><span class="PUNC">=</span><span class="NAME">now</span><span class="PUNC">;</span><span class="NAME">result</span><span class="PUNC">=</span><span class="NAME">func.apply</span><span class="PUNC">(</span><span class="NAME">context</span><span class="PUNC">,</span><span class="NAME">args</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">timeout</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">timeout</span><span class="PUNC">=</span><span class="NAME">setTimeout</span><span class="PUNC">(</span><span class="NAME">later</span><span class="PUNC">,</span><span class="NAME">remaining</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">result</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">_.debounce</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">func</span><span class="PUNC">,</span><span class="NAME">wait</span><span class="PUNC">,</span><span class="NAME">immediate</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">timeout</span><span class="PUNC">,</span><span class="NAME">result</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">context</span><span class="PUNC">=</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">args</span><span class="PUNC">=</span><span class="NAME">arguments</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">later</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">timeout</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">immediate</span><span class="PUNC">)</span><span class="NAME">result</span><span class="PUNC">=</span><span class="NAME">func.apply</span><span class="PUNC">(</span><span class="NAME">context</span><span class="PUNC">,</span><span class="NAME">args</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">callNow</span><span class="PUNC">=</span><span class="NAME">immediate</span><span class="PUNC">&&</span><span class="PUNC">!</span><span class="NAME">timeout</span><span class="PUNC">;</span><span class="NAME">clearTimeout</span><span class="PUNC">(</span><span class="NAME">timeout</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">timeout</span><span class="PUNC">=</span><span class="NAME">setTimeout</span><span class="PUNC">(</span><span class="NAME">later</span><span class="PUNC">,</span><span class="NAME">wait</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">callNow</span><span class="PUNC">)</span><span class="NAME">result</span><span class="PUNC">=</span><span class="NAME">func.apply</span><span class="PUNC">(</span><span class="NAME">context</span><span class="PUNC">,</span><span class="NAME">args</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">result</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">_.once</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">func</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ran</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="NAME">memo</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">ran</span><span class="PUNC">)</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">memo</span><span class="PUNC">;</span><span class="NAME">ran</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="NAME">memo</span><span class="PUNC">=</span><span class="NAME">func.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">func</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">memo</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">_.wrap</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">func</span><span class="PUNC">,</span><span class="NAME">wrapper</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">args</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="NAME">func</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">push.apply</span><span class="PUNC">(</span><span class="NAME">args</span><span class="PUNC">,</span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">wrapper.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">args</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">_.compose</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">funcs</span><span class="PUNC">=</span><span class="NAME">arguments</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">args</span><span class="PUNC">=</span><span class="NAME">arguments</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NAME">funcs.length</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">>=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">--</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">args</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="NAME">funcs</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">args</span><span class="PUNC">)</span><span class="PUNC">]</span><span class="PUNC">}</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">args</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">_.after</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">times</span><span class="PUNC">,</span><span class="NAME">func</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">times</span><span class="PUNC">&lt;=</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">func</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">--</span><span class="NAME">times</span><span class="PUNC">&lt;</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">func.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">_.keys</span><span class="PUNC">=</span><span class="NAME">nativeKeys</span><span class="PUNC">||</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="PUNC">!==</span><span class="NAME">Object</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="KEYW">throw</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">TypeError</span><span class="PUNC">(</span><span class="STRN">"Invalid object"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">keys</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">key</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">obj</span><span class="PUNC">)</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">_.has</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="PUNC">,</span><span class="NAME">key</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="NAME">keys</span><span class="PUNC">[</span><span class="NAME">keys.length</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">key</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">keys</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">_.values</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">values</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">key</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">obj</span><span class="PUNC">)</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">_.has</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="PUNC">,</span><span class="NAME">key</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="NAME">values.push</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="PUNC">[</span><span class="NAME">key</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">values</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">_.pairs</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">pairs</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">key</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">obj</span><span class="PUNC">)</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">_.has</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="PUNC">,</span><span class="NAME">key</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="NAME">pairs.push</span><span class="PUNC">(</span><span class="PUNC">[</span><span class="NAME">key</span><span class="PUNC">,</span><span class="NAME">obj</span><span class="PUNC">[</span><span class="NAME">key</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">pairs</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">_.invert</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">result</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">key</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">obj</span><span class="PUNC">)</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">_.has</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="PUNC">,</span><span class="NAME">key</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="NAME">result</span><span class="PUNC">[</span><span class="NAME">obj</span><span class="PUNC">[</span><span class="NAME">key</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">key</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">result</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">_.functions</span><span class="PUNC">=</span><span class="NAME">_.methods</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">names</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">key</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">obj</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">_.isFunction</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="PUNC">[</span><span class="NAME">key</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="NAME">names.push</span><span class="PUNC">(</span><span class="NAME">key</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">names.sort</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">_.extend</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">each</span><span class="PUNC">(</span><span class="NAME">slice.call</span><span class="PUNC">(</span><span class="NAME">arguments</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">source</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">source</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">prop</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">source</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">obj</span><span class="PUNC">[</span><span class="NAME">prop</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">source</span><span class="PUNC">[</span><span class="NAME">prop</span><span class="PUNC">]</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">obj</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">_.pick</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">copy</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">keys</span><span class="PUNC">=</span><span class="NAME">concat.apply</span><span class="PUNC">(</span><span class="NAME">ArrayProto</span><span class="PUNC">,</span><span class="NAME">slice.call</span><span class="PUNC">(</span><span class="NAME">arguments</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">each</span><span class="PUNC">(</span><span class="NAME">keys</span><span class="PUNC">,</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">key</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">key</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">obj</span><span class="PUNC">)</span><span class="NAME">copy</span><span class="PUNC">[</span><span class="NAME">key</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">obj</span><span class="PUNC">[</span><span class="NAME">key</span><span class="PUNC">]</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">copy</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">_.omit</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">copy</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">keys</span><span class="PUNC">=</span><span class="NAME">concat.apply</span><span class="PUNC">(</span><span class="NAME">ArrayProto</span><span class="PUNC">,</span><span class="NAME">slice.call</span><span class="PUNC">(</span><span class="NAME">arguments</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">key</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">obj</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">_.contains</span><span class="PUNC">(</span><span class="NAME">keys</span><span class="PUNC">,</span><span class="NAME">key</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="NAME">copy</span><span class="PUNC">[</span><span class="NAME">key</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">obj</span><span class="PUNC">[</span><span class="NAME">key</span><span class="PUNC">]</span><span class="PUNC">}</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">copy</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">_.defaults</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">each</span><span class="PUNC">(</span><span class="NAME">slice.call</span><span class="PUNC">(</span><span class="NAME">arguments</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">source</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">source</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">prop</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">source</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="PUNC">[</span><span class="NAME">prop</span><span class="PUNC">]</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="NAME">obj</span><span class="PUNC">[</span><span class="NAME">prop</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">source</span><span class="PUNC">[</span><span class="NAME">prop</span><span class="PUNC">]</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">obj</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">_.clone</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">_.isObject</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">obj</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">_.isArray</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="NAME">obj.slice</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">:</span><span class="NAME">_.extend</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">obj</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">_.tap</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="PUNC">,</span><span class="NAME">interceptor</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">interceptor</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">obj</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">eq</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">,</span><span class="NAME">b</span><span class="PUNC">,</span><span class="NAME">aStack</span><span class="PUNC">,</span><span class="NAME">bStack</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">===</span><span class="NAME">b</span><span class="PUNC">)</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">a</span><span class="PUNC">!==</span><span class="NUMB">0</span><span class="PUNC">||</span><span class="NUMB">1</span><span class="PUNC">/</span><span class="NAME">a</span><span class="PUNC">==</span><span class="NUMB">1</span><span class="PUNC">/</span><span class="NAME">b</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">||</span><span class="NAME">b</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">a</span><span class="PUNC">===</span><span class="NAME">b</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">a</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">_</span><span class="PUNC">)</span><span class="NAME">a</span><span class="PUNC">=</span><span class="NAME">a._wrapped</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">b</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">_</span><span class="PUNC">)</span><span class="NAME">b</span><span class="PUNC">=</span><span class="NAME">b._wrapped</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">className</span><span class="PUNC">=</span><span class="NAME">toString.call</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">className</span><span class="PUNC">!=</span><span class="NAME">toString.call</span><span class="PUNC">(</span><span class="NAME">b</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="KEYW">switch</span><span class="PUNC">(</span><span class="NAME">className</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">case</span><span class="STRN">"[object String]"</span><span class="PUNC">:</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">a</span><span class="PUNC">==</span><span class="NAME">String</span><span class="PUNC">(</span><span class="NAME">b</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">case</span><span class="STRN">"[object Number]"</span><span class="PUNC">:</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">a</span><span class="PUNC">!=</span><span class="PUNC">+</span><span class="NAME">a</span><span class="PUNC">?</span><span class="NAME">b</span><span class="PUNC">!=</span><span class="PUNC">+</span><span class="NAME">b</span><span class="PUNC">:</span><span class="NAME">a</span><span class="PUNC">==</span><span class="NUMB">0</span><span class="PUNC">?</span><span class="NUMB">1</span><span class="PUNC">/</span><span class="NAME">a</span><span class="PUNC">==</span><span class="NUMB">1</span><span class="PUNC">/</span><span class="NAME">b</span><span class="PUNC">:</span><span class="NAME">a</span><span class="PUNC">==</span><span class="PUNC">+</span><span class="NAME">b</span><span class="PUNC">;</span><span class="KEYW">case</span><span class="STRN">"[object Date]"</span><span class="PUNC">:</span><span class="KEYW">case</span><span class="STRN">"[object Boolean]"</span><span class="PUNC">:</span><span class="KEYW">return</span><span class="PUNC">+</span><span class="NAME">a</span><span class="PUNC">==</span><span class="PUNC">+</span><span class="NAME">b</span><span class="PUNC">;</span><span class="KEYW">case</span><span class="STRN">"[object RegExp]"</span><span class="PUNC">:</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">a.source</span><span class="PUNC">==</span><span class="NAME">b.source</span><span class="PUNC">&&</span><span class="NAME">a.global</span><span class="PUNC">==</span><span class="NAME">b.global</span><span class="PUNC">&&</span><span class="NAME">a.multiline</span><span class="PUNC">==</span><span class="NAME">b.multiline</span><span class="PUNC">&&</span><span class="NAME">a.ignoreCase</span><span class="PUNC">==</span><span class="NAME">b.ignoreCase</span><span class="PUNC">}</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">a</span><span class="PUNC">!=</span><span class="STRN">"object"</span><span class="PUNC">||</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">b</span><span class="PUNC">!=</span><span class="STRN">"object"</span><span class="PUNC">)</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">length</span><span class="PUNC">=</span><span class="NAME">aStack.length</span><span class="PUNC">;</span><span class="KEYW">while</span><span class="PUNC">(</span><span class="NAME">length</span><span class="PUNC">--</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">aStack</span><span class="PUNC">[</span><span class="NAME">length</span><span class="PUNC">]</span><span class="PUNC">==</span><span class="NAME">a</span><span class="PUNC">)</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">bStack</span><span class="PUNC">[</span><span class="NAME">length</span><span class="PUNC">]</span><span class="PUNC">==</span><span class="NAME">b</span><span class="PUNC">}</span><span class="NAME">aStack.push</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">bStack.push</span><span class="PUNC">(</span><span class="NAME">b</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">size</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">result</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">className</span><span class="PUNC">==</span><span class="STRN">"[object Array]"</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">size</span><span class="PUNC">=</span><span class="NAME">a.length</span><span class="PUNC">;</span><span class="NAME">result</span><span class="PUNC">=</span><span class="NAME">size</span><span class="PUNC">==</span><span class="NAME">b.length</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">result</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">while</span><span class="PUNC">(</span><span class="NAME">size</span><span class="PUNC">--</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="PUNC">(</span><span class="NAME">result</span><span class="PUNC">=</span><span class="NAME">eq</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NAME">size</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">b</span><span class="PUNC">[</span><span class="NAME">size</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">aStack</span><span class="PUNC">,</span><span class="NAME">bStack</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="KEYW">break</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">aCtor</span><span class="PUNC">=</span><span class="NAME">a.constructor</span><span class="PUNC">,</span><span class="NAME">bCtor</span><span class="PUNC">=</span><span class="NAME">b.constructor</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">aCtor</span><span class="PUNC">!==</span><span class="NAME">bCtor</span><span class="PUNC">&&</span><span class="PUNC">!</span><span class="PUNC">(</span><span class="NAME">_.isFunction</span><span class="PUNC">(</span><span class="NAME">aCtor</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="NAME">aCtor</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">aCtor</span><span class="PUNC">&&</span><span class="NAME">_.isFunction</span><span class="PUNC">(</span><span class="NAME">bCtor</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="NAME">bCtor</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">bCtor</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">}</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">key</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">_.has</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">,</span><span class="NAME">key</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">size</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="PUNC">(</span><span class="NAME">result</span><span class="PUNC">=</span><span class="NAME">_.has</span><span class="PUNC">(</span><span class="NAME">b</span><span class="PUNC">,</span><span class="NAME">key</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="NAME">eq</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NAME">key</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">b</span><span class="PUNC">[</span><span class="NAME">key</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">aStack</span><span class="PUNC">,</span><span class="NAME">bStack</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="KEYW">break</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">result</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="NAME">key</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">b</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">_.has</span><span class="PUNC">(</span><span class="NAME">b</span><span class="PUNC">,</span><span class="NAME">key</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="PUNC">!</span><span class="NAME">size</span><span class="PUNC">--</span><span class="PUNC">)</span><span class="KEYW">break</span><span class="PUNC">}</span><span class="NAME">result</span><span class="PUNC">=</span><span class="PUNC">!</span><span class="NAME">size</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="NAME">aStack.pop</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">bStack.pop</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">result</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">_.isEqual</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">,</span><span class="NAME">b</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">eq</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">,</span><span class="NAME">b</span><span class="PUNC">,</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">_.isEmpty</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">_.isArray</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="PUNC">)</span><span class="PUNC">||</span><span class="NAME">_.isString</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">obj.length</span><span class="PUNC">===</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">key</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">obj</span><span class="PUNC">)</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">_.has</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="PUNC">,</span><span class="NAME">key</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">_.isElement</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="PUNC">!</span><span class="PUNC">!</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="PUNC">&&</span><span class="NAME">obj.nodeType</span><span class="PUNC">===</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">_.isArray</span><span class="PUNC">=</span><span class="NAME">nativeIsArray</span><span class="PUNC">||</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">toString.call</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="PUNC">)</span><span class="PUNC">==</span><span class="STRN">"[object Array]"</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">_.isObject</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">obj</span><span class="PUNC">===</span><span class="NAME">Object</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">each</span><span class="PUNC">(</span><span class="PUNC">[</span><span class="STRN">"Arguments"</span><span class="PUNC">,</span><span class="STRN">"Function"</span><span class="PUNC">,</span><span class="STRN">"String"</span><span class="PUNC">,</span><span class="STRN">"Number"</span><span class="PUNC">,</span><span class="STRN">"Date"</span><span class="PUNC">,</span><span class="STRN">"RegExp"</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">name</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">_</span><span class="PUNC">[</span><span class="STRN">"is"</span><span class="PUNC">+</span><span class="NAME">name</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">toString.call</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="PUNC">)</span><span class="PUNC">==</span><span class="STRN">"[object "</span><span class="PUNC">+</span><span class="NAME">name</span><span class="PUNC">+</span><span class="STRN">"]"</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">_.isArguments</span><span class="PUNC">(</span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">_.isArguments</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="PUNC">!</span><span class="PUNC">!</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="PUNC">&&</span><span class="NAME">_.has</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="PUNC">,</span><span class="STRN">"callee"</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="REGX">/./</span><span class="PUNC">!==</span><span class="STRN">"function"</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">_.isFunction</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">obj</span><span class="PUNC">===</span><span class="STRN">"function"</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="NAME">_.isFinite</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">isFinite</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="PUNC">!</span><span class="NAME">isNaN</span><span class="PUNC">(</span><span class="NAME">parseFloat</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">_.isNaN</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">_.isNumber</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="NAME">obj</span><span class="PUNC">!=</span><span class="PUNC">+</span><span class="NAME">obj</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">_.isBoolean</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">obj</span><span class="PUNC">===</span><span class="KEYW">true</span><span class="PUNC">||</span><span class="NAME">obj</span><span class="PUNC">===</span><span class="KEYW">false</span><span class="PUNC">||</span><span class="NAME">toString.call</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="PUNC">)</span><span class="PUNC">==</span><span class="STRN">"[object Boolean]"</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">_.isNull</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">obj</span><span class="PUNC">===</span><span class="KEYW">null</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">_.isUndefined</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">obj</span><span class="PUNC">===</span><span class="KEYW">void</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">_.has</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="PUNC">,</span><span class="NAME">key</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">hasOwnProperty.call</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="PUNC">,</span><span class="NAME">key</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">_.noConflict</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">root._</span><span class="PUNC">=</span><span class="NAME">previousUnderscore</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">_.identity</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">value</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">value</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">_.times</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">n</span><span class="PUNC">,</span><span class="NAME">iterator</span><span class="PUNC">,</span><span class="NAME">context</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">accum</span><span class="PUNC">=</span><span class="NAME">Array</span><span class="PUNC">(</span><span class="NAME">n</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">n</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="NAME">accum</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">iterator.call</span><span class="PUNC">(</span><span class="NAME">context</span><span class="PUNC">,</span><span class="NAME">i</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">accum</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">_.random</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">min</span><span class="PUNC">,</span><span class="NAME">max</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">max</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">max</span><span class="PUNC">=</span><span class="NAME">min</span><span class="PUNC">;</span><span class="NAME">min</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">}</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">min</span><span class="PUNC">+</span><span class="NAME">Math.floor</span><span class="PUNC">(</span><span class="NAME">Math.random</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NAME">max</span><span class="PUNC">-</span><span class="NAME">min</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">entityMap</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="NAME">escape</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="STRN">"&"</span><span class="PUNC">:</span><span class="STRN">"&amp;"</span><span class="PUNC">,</span><span class="STRN">"&lt;"</span><span class="PUNC">:</span><span class="STRN">"&lt;"</span><span class="PUNC">,</span><span class="STRN">">"</span><span class="PUNC">:</span><span class="STRN">"&gt;"</span><span class="PUNC">,</span><span class="STRN">'"'</span><span class="PUNC">:</span><span class="STRN">"&quot;"</span><span class="PUNC">,</span><span class="STRN">"'"</span><span class="PUNC">:</span><span class="STRN">"&#x27;"</span><span class="PUNC">,</span><span class="STRN">"/"</span><span class="PUNC">:</span><span class="STRN">"&#x2F;"</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">entityMap.unescape</span><span class="PUNC">=</span><span class="NAME">_.invert</span><span class="PUNC">(</span><span class="NAME">entityMap.escape</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">entityRegexes</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="NAME">escape</span><span class="PUNC">:</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">RegExp</span><span class="PUNC">(</span><span class="STRN">"["</span><span class="PUNC">+</span><span class="NAME">_.keys</span><span class="PUNC">(</span><span class="NAME">entityMap.escape</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">join</span><span class="PUNC">(</span><span class="STRN">""</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="STRN">"]"</span><span class="PUNC">,</span><span class="STRN">"g"</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">unescape</span><span class="PUNC">:</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">RegExp</span><span class="PUNC">(</span><span class="STRN">"("</span><span class="PUNC">+</span><span class="NAME">_.keys</span><span class="PUNC">(</span><span class="NAME">entityMap.unescape</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">join</span><span class="PUNC">(</span><span class="STRN">"|"</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="STRN">")"</span><span class="PUNC">,</span><span class="STRN">"g"</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">_.each</span><span class="PUNC">(</span><span class="PUNC">[</span><span class="STRN">"escape"</span><span class="PUNC">,</span><span class="STRN">"unescape"</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">method</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">_</span><span class="PUNC">[</span><span class="NAME">method</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">string</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">string</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="KEYW">return</span><span class="STRN">""</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="PUNC">(</span><span class="STRN">""</span><span class="PUNC">+</span><span class="NAME">string</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">replace</span><span class="PUNC">(</span><span class="NAME">entityRegexes</span><span class="PUNC">[</span><span class="NAME">method</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">match</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">entityMap</span><span class="PUNC">[</span><span class="NAME">method</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">match</span><span class="PUNC">]</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">_.result</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">object</span><span class="PUNC">,</span><span class="NAME">property</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">object</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">value</span><span class="PUNC">=</span><span class="NAME">object</span><span class="PUNC">[</span><span class="NAME">property</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">_.isFunction</span><span class="PUNC">(</span><span class="NAME">value</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="NAME">value.call</span><span class="PUNC">(</span><span class="NAME">object</span><span class="PUNC">)</span><span class="PUNC">:</span><span class="NAME">value</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">_.mixin</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">each</span><span class="PUNC">(</span><span class="NAME">_.functions</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">name</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">func</span><span class="PUNC">=</span><span class="NAME">_</span><span class="PUNC">[</span><span class="NAME">name</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">obj</span><span class="PUNC">[</span><span class="NAME">name</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">_.prototype</span><span class="PUNC">[</span><span class="NAME">name</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">args</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="NAME">this._wrapped</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">push.apply</span><span class="PUNC">(</span><span class="NAME">args</span><span class="PUNC">,</span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">result.call</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">func.apply</span><span class="PUNC">(</span><span class="NAME">_</span><span class="PUNC">,</span><span class="NAME">args</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">idCounter</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">_.uniqueId</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">prefix</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">id</span><span class="PUNC">=</span><span class="PUNC">++</span><span class="NAME">idCounter</span><span class="PUNC">+</span><span class="STRN">""</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">prefix</span><span class="PUNC">?</span><span class="NAME">prefix</span><span class="PUNC">+</span><span class="NAME">id</span><span class="PUNC">:</span><span class="NAME">id</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">_.templateSettings</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="NAME">evaluate</span><span class="PUNC">:</span><span class="REGX">/&lt;%([\s\S]+?)%>/g</span><span class="PUNC">,</span><span class="NAME">interpolate</span><span class="PUNC">:</span><span class="REGX">/&lt;%=([\s\S]+?)%>/g</span><span class="PUNC">,</span><span class="NAME">escape</span><span class="PUNC">:</span><span class="REGX">/&lt;%-([\s\S]+?)%>/g</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">noMatch</span><span class="PUNC">=</span><span class="REGX">/(.)^/</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">escapes</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="STRN">"'"</span><span class="PUNC">:</span><span class="STRN">"'"</span><span class="PUNC">,</span><span class="STRN">"\\"</span><span class="PUNC">:</span><span class="STRN">"\\"</span><span class="PUNC">,</span><span class="STRN">"\r"</span><span class="PUNC">:</span><span class="STRN">"r"</span><span class="PUNC">,</span><span class="STRN">"\n"</span><span class="PUNC">:</span><span class="STRN">"n"</span><span class="PUNC">,</span><span class="STRN">"	"</span><span class="PUNC">:</span><span class="STRN">"t"</span><span class="PUNC">,</span><span class="STRN">"\u2028"</span><span class="PUNC">:</span><span class="STRN">"u2028"</span><span class="PUNC">,</span><span class="STRN">"\u2029"</span><span class="PUNC">:</span><span class="STRN">"u2029"</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">escaper</span><span class="PUNC">=</span><span class="REGX">/\\|'|\r|\n|\t|\u2028|\u2029/g</span><span class="PUNC">;</span><span class="NAME">_.template</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">text</span><span class="PUNC">,</span><span class="NAME">data</span><span class="PUNC">,</span><span class="NAME">settings</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">render</span><span class="PUNC">;</span><span class="NAME">settings</span><span class="PUNC">=</span><span class="NAME">_.defaults</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">settings</span><span class="PUNC">,</span><span class="NAME">_.templateSettings</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">matcher</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">RegExp</span><span class="PUNC">(</span><span class="PUNC">[</span><span class="PUNC">(</span><span class="NAME">settings.escape</span><span class="PUNC">||</span><span class="NAME">noMatch</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">source</span><span class="PUNC">,</span><span class="PUNC">(</span><span class="NAME">settings.interpolate</span><span class="PUNC">||</span><span class="NAME">noMatch</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">source</span><span class="PUNC">,</span><span class="PUNC">(</span><span class="NAME">settings.evaluate</span><span class="PUNC">||</span><span class="NAME">noMatch</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">source</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">join</span><span class="PUNC">(</span><span class="STRN">"|"</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="STRN">"|$"</span><span class="PUNC">,</span><span class="STRN">"g"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">index</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">source</span><span class="PUNC">=</span><span class="STRN">"__p+='"</span><span class="PUNC">;</span><span class="NAME">text.replace</span><span class="PUNC">(</span><span class="NAME">matcher</span><span class="PUNC">,</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">match</span><span class="PUNC">,</span><span class="NAME">escape</span><span class="PUNC">,</span><span class="NAME">interpolate</span><span class="PUNC">,</span><span class="NAME">evaluate</span><span class="PUNC">,</span><span class="NAME">offset</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">source</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="NAME">text.slice</span><span class="PUNC">(</span><span class="NAME">index</span><span class="PUNC">,</span><span class="NAME">offset</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">replace</span><span class="PUNC">(</span><span class="NAME">escaper</span><span class="PUNC">,</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">match</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="STRN">"\\"</span><span class="PUNC">+</span><span class="NAME">escapes</span><span class="PUNC">[</span><span class="NAME">match</span><span class="PUNC">]</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">escape</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">source</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="STRN">"'+\n((__t=("</span><span class="PUNC">+</span><span class="NAME">escape</span><span class="PUNC">+</span><span class="STRN">"))==null?'':_.escape(__t))+\n'"</span><span class="PUNC">}</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">interpolate</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">source</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="STRN">"'+\n((__t=("</span><span class="PUNC">+</span><span class="NAME">interpolate</span><span class="PUNC">+</span><span class="STRN">"))==null?'':__t)+\n'"</span><span class="PUNC">}</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">evaluate</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">source</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="STRN">"';\n"</span><span class="PUNC">+</span><span class="NAME">evaluate</span><span class="PUNC">+</span><span class="STRN">"\n__p+='"</span><span class="PUNC">}</span><span class="NAME">index</span><span class="PUNC">=</span><span class="NAME">offset</span><span class="PUNC">+</span><span class="NAME">match.length</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">match</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">source</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="STRN">"';\n"</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">settings.variable</span><span class="PUNC">)</span><span class="NAME">source</span><span class="PUNC">=</span><span class="STRN">"with(obj||{}){\n"</span><span class="PUNC">+</span><span class="NAME">source</span><span class="PUNC">+</span><span class="STRN">"}\n"</span><span class="PUNC">;</span><span class="NAME">source</span><span class="PUNC">=</span><span class="STRN">"var __t,__p='',__j=Array.prototype.join,"</span><span class="PUNC">+</span><span class="STRN">"print=function(){__p+=__j.call(arguments,'');};\n"</span><span class="PUNC">+</span><span class="NAME">source</span><span class="PUNC">+</span><span class="STRN">"return __p;\n"</span><span class="PUNC">;</span><span class="KEYW">try</span><span class="PUNC">{</span><span class="NAME">render</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Function</span><span class="PUNC">(</span><span class="NAME">settings.variable</span><span class="PUNC">||</span><span class="STRN">"obj"</span><span class="PUNC">,</span><span class="STRN">"_"</span><span class="PUNC">,</span><span class="NAME">source</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="KEYW">catch</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">e.source</span><span class="PUNC">=</span><span class="NAME">source</span><span class="PUNC">;</span><span class="KEYW">throw</span><span class="WHIT"> </span><span class="NAME">e</span><span class="PUNC">}</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">data</span><span class="PUNC">)</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">render</span><span class="PUNC">(</span><span class="NAME">data</span><span class="PUNC">,</span><span class="NAME">_</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">template</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">data</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">render.call</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">data</span><span class="PUNC">,</span><span class="NAME">_</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">template.source</span><span class="PUNC">=</span><span class="STRN">"function("</span><span class="PUNC">+</span><span class="PUNC">(</span><span class="NAME">settings.variable</span><span class="PUNC">||</span><span class="STRN">"obj"</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="STRN">"){\n"</span><span class="PUNC">+</span><span class="NAME">source</span><span class="PUNC">+</span><span class="STRN">"}"</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">template</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">_.chain</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">_</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">chain</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">result</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this._chain</span><span class="PUNC">?</span><span class="NAME">_</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">chain</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">:</span><span class="NAME">obj</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">_.mixin</span><span class="PUNC">(</span><span class="NAME">_</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">each</span><span class="PUNC">(</span><span class="PUNC">[</span><span class="STRN">"pop"</span><span class="PUNC">,</span><span class="STRN">"push"</span><span class="PUNC">,</span><span class="STRN">"reverse"</span><span class="PUNC">,</span><span class="STRN">"shift"</span><span class="PUNC">,</span><span class="STRN">"sort"</span><span class="PUNC">,</span><span class="STRN">"splice"</span><span class="PUNC">,</span><span class="STRN">"unshift"</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">name</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">method</span><span class="PUNC">=</span><span class="NAME">ArrayProto</span><span class="PUNC">[</span><span class="NAME">name</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">_.prototype</span><span class="PUNC">[</span><span class="NAME">name</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">obj</span><span class="PUNC">=</span><span class="NAME">this._wrapped</span><span class="PUNC">;</span><span class="NAME">method.apply</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="PUNC">,</span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">name</span><span class="PUNC">==</span><span class="STRN">"shift"</span><span class="PUNC">||</span><span class="NAME">name</span><span class="PUNC">==</span><span class="STRN">"splice"</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="NAME">obj.length</span><span class="PUNC">===</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="KEYW">delete</span><span class="WHIT"> </span><span class="NAME">obj</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">result.call</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">obj</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">each</span><span class="PUNC">(</span><span class="PUNC">[</span><span class="STRN">"concat"</span><span class="PUNC">,</span><span class="STRN">"join"</span><span class="PUNC">,</span><span class="STRN">"slice"</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">name</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">method</span><span class="PUNC">=</span><span class="NAME">ArrayProto</span><span class="PUNC">[</span><span class="NAME">name</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">_.prototype</span><span class="PUNC">[</span><span class="NAME">name</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">result.call</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">method.apply</span><span class="PUNC">(</span><span class="NAME">this._wrapped</span><span class="PUNC">,</span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">_.extend</span><span class="PUNC">(</span><span class="NAME">_.prototype</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">chain</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this._chain</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">value</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this._wrapped</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">.</span><span class="NAME">call</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NUMB">21</span><span class="PUNC">:</span><span class="PUNC">[</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">require</span><span class="PUNC">,</span><span class="NAME">module</span><span class="PUNC">,</span><span class="NAME">exports</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">window.requestAnimFrame</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">window.requestAnimationFrame</span><span class="PUNC">||</span><span class="NAME">window.webkitRequestAnimationFrame</span><span class="PUNC">||</span><span class="NAME">window.mozRequestAnimationFrame</span><span class="PUNC">||</span><span class="NAME">window.oRequestAnimationFrame</span><span class="PUNC">||</span><span class="NAME">window.msRequestAnimationFrame</span><span class="PUNC">||</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">callback</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">window.setTimeout</span><span class="PUNC">(</span><span class="NAME">callback</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="NAME">e3</span><span class="PUNC">/</span><span class="NUMB">60</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">Leap</span><span class="PUNC">=</span><span class="NAME">require</span><span class="PUNC">(</span><span class="STRN">"../lib/index"</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="STRN">"../lib/index"</span><span class="PUNC">:</span><span class="NUMB">8</span><span class="PUNC">}</span><span class="PUNC">]</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="PUNC">[</span><span class="NUMB">21</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span></pre></body></html>